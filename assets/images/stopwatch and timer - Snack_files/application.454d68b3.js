"use strict";function uint8ArrayToString(uint8Arr){for(var length=uint8Arr.length,result="",i=0;length>i;i+=65535){var addition=65535;i+65535>length&&(addition=length-i),result+=String.fromCharCode.apply(null,uint8Arr.subarray(i,i+addition))}return result}function getFormattedDate(){var date=new Date,str=date.getFullYear()+"-"+("0"+(date.getMonth()+1)).slice(-2)+"-"+("0"+date.getDate()).slice(-2)+" "+("0"+date.getHours()).slice(-2)+"-"+("0"+date.getMinutes()).slice(-2)+"-"+("0"+date.getSeconds()).slice(-2);return str}var pageDescriptions={home:"Online web based iOS Simulators and Android Emulators. Run iPhone, iPad, Mobile Safari, APK, mobile apps in your browser with HTML5 and Javascript. For mobile app customer support, training, app previews, testing, and much more.",upload:"Upload an iOS app or Android APK to stream instantly using online web based iOS Simulators and Android Emulators.",demo:"Demo Appetize.io's online web based iOS Simulators and Android Emulators directly in your browser.",docs:"Easily request an API token to gain programmatic access to Appetize.io online web based iOS Simulators and Android Emulators.",moreInfo:"Pricing, terms, service level agreement, and other information regarding Appetize.io's online web based iOS Simulators and Android Emulators.",login:"Sign in to your Appetize.io account to update app settings, upload new builds, setup billing, and more.",reset:"Reset your Appetize.io account password.",signup:"Sign up for your Appetize.io account to update app settings, upload new builds, setup billing, and more.",terms:"Terms and policies regarding Appetize.ios online web based iOS Simulators and Android Emulators.",standalone:"Run Appetize.io as a barebones iOS Simulator or Android Emulator"};angular.module("appetizeApp",["duScroll","ngCookies","ngResource","ngSanitize","ngRoute","ui.bootstrap.accordion","angularFileUpload","ui.bootstrap","perfect_scrollbar","luegg.directives","mgcrea.ngStrap.affix","mgcrea.ngStrap.scrollspy","mgcrea.ngStrap.helpers.debounce","mgcrea.ngStrap.helpers.dimensions","ng-currency","ngclipboard","ngOrderObjectBy","anguFixedHeaderTable","hljs"]).config(["$routeProvider","$locationProvider","$httpProvider","$compileProvider",function($routeProvider,$locationProvider,$httpProvider,$compileProvider){var requiresAuthCheck=["$q","$http","$location","$rootScope",function($q,$http,$location,$rootScope){var deferred=$q.defer();return $rootScope.user?deferred.resolve():$rootScope.isOnprem&&!$rootScope.isOnprem.protectLaunchPage&&0==$location.path().indexOf("/launch-page")?deferred.resolve():$http.get("/api/user").then(function(response){var user=response.data;user&&user.username?($rootScope.user=user,$rootScope.loggedIn=!0,deferred.resolve()):($rootScope.loggedIn=!1,deferred.reject(),$rootScope.isOnprem&&$rootScope.isOnprem.protectLaunchPage&&0==$location.path().indexOf("/launch-page")?$location.url("/login?reason=launch"):$rootScope.isOnprem?$location.url("/login"):0==$location.path().indexOf("/manage/")?$location.url("/login?reason=manage&next="+$location.path()):0==$location.path().indexOf("/debug/")?$location.url("/login?reason=debug&next="+$location.path()):0==$location.path().indexOf("/standalone")?$location.url("/login?reason=standalone&next="+$location.path()):$location.url("/login?next="+$location.path()))}),deferred.promise}],requiresAdminCheck=["$q","$http","$location","$rootScope",function($q,$http,$location,$rootScope){var deferred=$q.defer();return $rootScope.user&&$rootScope.user.roles.indexOf("admin")>-1?deferred.resolve():$http.get("/api/user").then(function(response){var user=response.data;user&&user.username&&user.roles.indexOf("admin")>-1?($rootScope.user=user,$rootScope.loggedIn=!0,deferred.resolve()):user&&user.username?($rootScope.loggedIn=!0,deferred.reject(),$location.url("/unauthorized?roleRequired=admin")):($rootScope.loggedIn=!1,deferred.reject(),$location.url("/login?reason=admin&next="+$location.path()))}),deferred.promise}],requiresDeveloperCheck=["$q","$http","$location","$rootScope",function($q,$http,$location,$rootScope){var deferred=$q.defer();return $rootScope.user&&$rootScope.user.roles.indexOf("developer")>-1?deferred.resolve():$http.get("/api/user").then(function(response){var user=response.data;user&&user.username&&user.roles.indexOf("developer")>-1?($rootScope.user=user,$rootScope.loggedIn=!0,deferred.resolve()):user&&user.username?($rootScope.loggedIn=!0,deferred.reject(),$location.url("/unauthorized?roleRequired=developer")):($rootScope.loggedIn=!1,deferred.reject(),$location.url("/login?reason=developer&next="+$location.path()))}),deferred.promise}],requiresSystemAdminCheck=["$q","$http","$location","$rootScope",function($q,$http,$location,$rootScope){var deferred=$q.defer();return $rootScope.user&&$rootScope.user.isSystemAdmin?deferred.resolve():$http.get("/api/user").then(function(response){var user=response.data;user&&user.username&&user.isSystemAdmin?($rootScope.user=user,$rootScope.loggedIn=!0,deferred.resolve()):user&&user.username?($rootScope.loggedIn=!0,deferred.reject(),$location.url("/unauthorized")):($rootScope.loggedIn=!1,deferred.reject(),$location.url("/login?reason=systemadmin&next="+$location.path()))}),deferred.promise}];$compileProvider.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|file|tel|appetize\.io):/),$routeProvider.when("/library",{pageTitle:"Embed",templateUrl:"views/library.html",pageDescription:pageDescriptions.home,pageCanonical:"https://appetize.io/embed",controller:"LibraryCtrl"}).when("/docs",{templateUrl:"views/docs.html",pageTitle:"Docs",pageDescription:pageDescriptions.docs,pageCanonical:"https://appetize.io/docs",controller:"MainCtrl"}).when("/login",{templateUrl:"views/login.html",pageTitle:"Sign in",pageDescription:pageDescriptions.login,pageCanonical:"https://appetize.io/login",controller:"MainCtrl"}).when("/app/:publicKey",{templateUrl:"views/app.html",pageTitle:"App",pageDescription:pageDescriptions.home,pageCanonical:"https://appetize.io/",controller:"CanvasCtrl",reloadOnSearch:!1}).when("/standalone",{templateUrl:"views/standalone.html",pageTitle:"Standalone",pageDescription:pageDescriptions.standalone,pageCanonical:"https://appetize.io/",controller:"CanvasCtrl",reloadOnSearch:!1,resolve:{auth:requiresAuthCheck}}).when("/admin-prewarm",{templateUrl:"views/admin_prewarm.html",pageTitle:"Prewarm",controller:"MainCtrl",reloadOnSearch:!1,resolve:{auth:requiresSystemAdminCheck}}).when("/debug/:privateKey",{templateUrl:"views/debug.html",pageTitle:"Debug",pageDescription:pageDescriptions.home,pageCanonical:"https://appetize.io/",controller:"CanvasCtrl",reloadOnSearch:!1,resolve:{auth:requiresAuthCheck}}).when("/manage/:privateKey",{templateUrl:"views/manage.html",pageTitle:"Manage",pageDescription:pageDescriptions.home,pageCanonical:"https://appetize.io/",controller:"ManageCtrl",resolve:{auth:requiresDeveloperCheck}}).when("/embed/:publicKey",{templateUrl:"views/app.html",pageTitle:"Embed",pageDescription:pageDescriptions.home,pageCanonical:"https://appetize.io/embed",controller:"CanvasCtrl",reloadOnSearch:!1}).when("/reset",{templateUrl:"views/reset.html",pageTitle:"Reset your password",pageDescription:pageDescriptions.reset,pageCanonical:"https://appetize.io/reset",controller:"ResetCtrl"}).when("/unauthorized",{templateUrl:"views/unauthorized.html",pageTitle:"Unauthorized",pageDescription:pageDescriptions.home,pageCanonical:"https://appetize.io/unauthorized",controller:"MainCtrl",resolve:{auth:requiresAuthCheck}}).when("/account",{templateUrl:"views/account.html",pageTitle:"Account",pageDescription:pageDescriptions.home,pageCanonical:"https://appetize.io/",controller:"MainCtrl",resolve:{auth:requiresAdminCheck}}).when("/register",{templateUrl:"views/register.html",pageTitle:"Register",pageDescription:pageDescriptions.signup,pageCanonical:"https://appetize.io/register",controller:"MainCtrl"}).when("/invite",{templateUrl:"views/invite.html",pageTitle:"Invite",pageDescription:pageDescriptions.home,pageCanonical:"https://appetize.io/",controller:"MainCtrl"}),window.isOnprem?$routeProvider.when("/",{templateUrl:"views/dashboard.html",pageTitle:"Dashboard",pageDescription:pageDescriptions.home,pageCanonical:"https://appetize.io/",controller:"DashboardCtrl",resolve:{auth:requiresAuthCheck}}).when("/upload",{templateUrl:"views/upload.html",pageTitle:"Upload",pageDescription:pageDescriptions.upload,pageCanonical:"https://appetize.io/upload",controller:"UploadCtrl",resolve:{auth:requiresAuthCheck}}).when("/demo",{templateUrl:"views/demo.html",pageTitle:"Demo",pageDescription:pageDescriptions.demo,pageCanonical:"https://appetize.io/demo",controller:"CanvasCtrl",reloadOnSearch:!1,resolve:{auth:requiresAuthCheck}}).when("/launch-page",{templateUrl:"views/launch_page.html",pageTitle:"Launch page",pageDescription:pageDescriptions.home,pageCanonical:"https://appetize.io/launch-page",controller:"LaunchCtrl",reloadOnSearch:!1,resolve:{auth:requiresAuthCheck}}).otherwise({pageTitle:"Appetize.io - Run native mobile apps in your browser",pageDescription:pageDescriptions.home,pageCanonical:"https://appetize.io/",redirectTo:"/"}):$routeProvider.when("/",{templateUrl:"views/main.html",pageTitle:"Appetize.io - Run native mobile apps in your browser",pageDescription:pageDescriptions.home,pageCanonical:"https://appetize.io/",controller:"MainCtrl"}).when("/upload",{templateUrl:"views/upload.html",pageTitle:"Upload",pageDescription:pageDescriptions.upload,pageCanonical:"https://appetize.io/upload",controller:"UploadCtrl"}).when("/connect",{templateUrl:"views/connect.html",pageTitle:"ADB Connect",pageDescription:pageDescriptions.moreInfo,pageCanonical:"https://appetize.io/connect",controller:"MainCtrl"}).when("/demo",{templateUrl:"views/demo.html",pageTitle:"Demo",pageDescription:pageDescriptions.demo,pageCanonical:"https://appetize.io/demo",controller:"CanvasCtrl",reloadOnSearch:!1}).when("/pricing",{templateUrl:"views/pricing.html",pageTitle:"Pricing",pageDescription:pageDescriptions.moreInfo,pageCanonical:"https://appetize.io/pricing",controller:"MainCtrl"}).when("/signup",{templateUrl:"views/signup.html",pageTitle:"Sign up",pageDescription:pageDescriptions.signup,pageCanonical:"https://appetize.io/signup",controller:"MainCtrl"}).when("/terms-and-policies",{templateUrl:"views/terms-and-policies.html",pageTitle:"Terms and policies",pageDescription:pageDescriptions.terms,pageCanonical:"https://appetize.io/terms-and-policies",controller:"MainCtrl"}).when("/payer-code",{templateUrl:"views/payer-code.html",pageTitle:"Payer code",pageDescription:pageDescriptions.home,pageCanonical:"https://appetize.io/payer-code",controller:"PayerCodeCtrl",resolve:{auth:requiresAdminCheck}}).when("/dashboard",{templateUrl:"views/dashboard.html",pageTitle:"Dashboard",pageDescription:pageDescriptions.home,pageCanonical:"https://appetize.io/",controller:"DashboardCtrl",resolve:{auth:requiresAuthCheck}}).when("/success",{templateUrl:"views/success.html",pageTitle:"Success",pageDescription:pageDescriptions.home,pageCanonical:"https://appetize.io/",controller:"MainCtrl"}).when("/x",{pageTitle:"Exclude",templateUrl:"/views/exclude.html"}).otherwise({pageTitle:"Appetize.io",pageDescription:pageDescriptions.home,pageCanonical:"https://appetize.io/",redirectTo:"/"}),$locationProvider.html5Mode(!0),$locationProvider.hashPrefix("!"),$httpProvider.interceptors.push(["$q","$location","$rootScope",function($q,$location,$rootScope){return{responseError:function(rejection){if(401===rejection.status&&"/login"!==$location.path()){var loginUrl=$rootScope.user?$rootScope.user.loginUrl:null;$rootScope.loggedIn=!1,$rootScope.user=null,console.log("Login required, redirecting to login page"),window.isOnprem?$location.url("/login?next="+$location.path()):loginUrl?window.location.href=loginUrl+"?next="+$location.path():$location.url("/login?reason=unauthorized&next="+$location.path())}return $q.reject(rejection)}}}])}]).directive("preloadResource",["$rootScope",function($rootScope){return{link:function(rootScope,element,attrs){$rootScope.loggedIn=JSON.parse(attrs.preloadResource),element.remove()}}}]).directive("preloadDeviceconfig",["$rootScope",function($rootScope){return{link:function(rootScope,element,attrs){$rootScope.deviceConfig=JSON.parse(attrs.preloadDeviceconfig),element.remove()}}}]).directive("preloadAppconfig",["$rootScope",function($rootScope){return{link:function(rootScope,element,attrs){$rootScope.appConfig=JSON.parse(attrs.preloadAppconfig),element.remove()}}}]).directive("preloadIsonprem",["$rootScope",function($rootScope){return{link:function(rootScope,element,attrs){$rootScope.isOnprem=JSON.parse(attrs.preloadIsonprem),element.remove()}}}]).run(["navigation",function(navigation){navigation.handleRouteChange()}]),angular.module("appetizeApp").controller("MainCtrl",["$scope","$routeParams","$rootScope","$modal","$location","$anchorScroll","AuthService",function($scope,$routeParams,$rootScope,$modal,$location,$anchorScroll,AuthService){console.log("MainCtrl loaded"),toastr.options.timeOut=1e4,toastr.options.positionClass="toast-bottom-full-width",("admin"==$routeParams.roleRequired||"developer"==$routeParams.roleRequired)&&($scope.roleRequired=$routeParams.roleRequired),$anchorScroll()}]),angular.module("appetizeApp").controller("DocsCtrl",["$scope","$rootScope","$window","$modal","$http","$location","$anchorScroll","$timeout","appConstants",function($scope,$rootScope,$window,$modal,$http,$location,$anchorScroll,$timeout,appConstants){function getWidth(){return $scope.screenOnly?"portrait"==$scope.orientation?Math.ceil(appConstants.screenDimensions[$scope.device].width*$scope.scale/100):Math.ceil(appConstants.screenDimensions[$scope.device].height*$scope.scale/100):"portrait"==$scope.orientation?Math.ceil(appConstants.deviceDimensions[$scope.device].width*$scope.scale/100):Math.ceil(appConstants.deviceDimensions[$scope.device].height*$scope.scale/100)}function getHeight(){return $scope.screenOnly?"portrait"==$scope.orientation?Math.ceil(appConstants.screenDimensions[$scope.device].height*$scope.scale/100):Math.ceil(appConstants.screenDimensions[$scope.device].width*$scope.scale/100):"portrait"==$scope.orientation?Math.ceil(appConstants.deviceDimensions[$scope.device].height*$scope.scale/100):Math.ceil(appConstants.deviceDimensions[$scope.device].width*$scope.scale/100)}console.log("DocsCtrl loaded"),$window.location.href="https://docs.appetize.io",$scope.apiBaseDomain=$rootScope.isOnprem?$location.$$host:"api.appetize.io",$scope.error={},$scope.device="iphone8",$scope.deviceColor="black",$scope.autoplay=!1,$scope.screenOnly=!1,$scope.xdocMsg=!1,$scope.scale=100,$scope.orientation="portrait",$scope.width=378,$scope.height=800,$scope.$watch("device",function(newValue,oldValue){newValue!==oldValue&&($scope.width=getWidth(),$scope.height=getHeight())},!1),$scope.$watch("orientation",function(newValue,oldValue){newValue!==oldValue&&($scope.width=getWidth(),$scope.height=getHeight())},!1),$scope.$watch("scale",function(newValue,oldValue){newValue!==oldValue&&($scope.width=getWidth(),$scope.height=getHeight())},!1),$scope.$watch("screenOnly",function(newValue,oldValue){newValue!==oldValue&&($scope.width=getWidth(),$scope.height=getHeight())},!1),$scope.$watch("paramsInput",function(newValue,oldValue){if(newValue!==oldValue)if(newValue)try{var temp=JSON.parse(newValue);"object"==typeof temp?($scope.paramsError=!1,$scope.params=encodeURIComponent(newValue)):($scope.params=null,$scope.paramsError=!0)}catch(err){$scope.params=null,$scope.paramsError=!0}else $scope.params=null,$scope.paramsError=!1},!1),$scope.setLanguage=function(language){$scope.language=language},$scope.status={isopen:!1},$scope.languages=["de","en","fr","it","ja","ko","pt","ru"],$scope.scrollToId=function(id){$location.hash(id),$anchorScroll()},$scope.removeHash=function(){$location.hash(null)},$timeout($anchorScroll,20)}]),angular.module("appetizeApp").controller("TermsCtrl",["$scope","$anchorScroll","$location",function($scope,$anchorScroll,$location){console.log("TermsCtrl loaded"),$scope.scrollToId=function(id){$location.hash(id),$anchorScroll()},$scope.removeHash=function(){$location.hash(null)},$anchorScroll()}]),angular.module("appetizeApp").controller("DemoCtrl",function(){console.log("DemoCtrl loaded")}),angular.module("appetizeApp").controller("ManageCtrl",["$scope","$rootScope","$routeParams","$timeout","$upload","$parse","$http","$modal","$location","$anchorScroll","$window","appConstants",function($scope,$rootScope,$routeParams,$timeout,$upload,$parse,$http,$modal,$location,$anchorScroll,$window,appConstants){function getAccount(){$http.get("/api/account").then(function(res){$scope.account=res.data})}function setDefaults(){$rootScope.app&&($rootScope.app.disableHome||($rootScope.app.disableHome=!1),$rootScope.app.disabled||($rootScope.app.disabled=!1),$rootScope.app.protectedByAccount||($rootScope.app.protectedByAccount=!1),$rootScope.app.timeout||($rootScope.app.timeout=$scope.account.timeout||120),$rootScope.app.useLastFrame||($rootScope.app.useLastFrame=!1),$rootScope.app.preLaunchButtonTextColor||($rootScope.app.preLaunchButtonTextColor="#ffffff"),$rootScope.app.preLaunchButtonBackgroundColor||($rootScope.app.preLaunchButtonBackgroundColor="#009ddc"),$rootScope.app.preLaunchButtonBackgroundOpacity||($rootScope.app.preLaunchButtonBackgroundOpacity=.5),$rootScope.app.postSessionButtonTextColor||($rootScope.app.postSessionButtonTextColor="#ffffff"),$rootScope.app.postSessionButtonBackgroundColor||($rootScope.app.postSessionButtonBackgroundColor="#009ddc"),$rootScope.app.postSessionButtonBackgroundOpacity||($rootScope.app.postSessionButtonBackgroundOpacity=.5)),$timeout(function(){jscolor.bind(),updateJsColor()},500)}console.log("ManageCtrl loaded"),toastr.options.timeOut=1e4,toastr.options.positionClass="toast-bottom-full-width";var x2js=new X2JS;$scope.appConstants=appConstants,$scope.account,getAccount(),$scope.disabled={},$scope.pageConfig={},$scope.fieldChanged={},$scope.fieldChangeSuccess={},$routeParams.privateKey&&$http.get("/api/app/"+$routeParams.privateKey+"/manage").then(function(response){$rootScope.app=response.data,setDefaults(),$scope.logMonths=[];for(var today=new Date,monthIterator=new Date(today.getFullYear(),today.getMonth(),1);monthIterator>new Date($rootScope.app.created);)$scope.logMonths.push(new Date(monthIterator)),monthIterator.setMonth(monthIterator.getMonth()-1);$scope.logMonths.push(new Date(monthIterator)),$scope.logMonth=$scope.logMonths[0],$scope.$watch("app.buttonText",function(newValue,oldValue){newValue!==oldValue&&($scope.fieldChangeSuccess.buttonText=!1,$scope.fieldChanged.buttonText=!0)},!1),$scope.$watch("app.preLaunchButtonTextColor",function(newValue,oldValue){newValue!==oldValue&&($scope.fieldChangeSuccess.preLaunchButtonTextColor=!1,$scope.fieldChanged.preLaunchButtonTextColor=!0)},!1),$scope.$watch("app.preLaunchButtonBackgroundColor",function(newValue,oldValue){newValue!==oldValue&&($scope.fieldChangeSuccess.preLaunchButtonBackgroundColor=!1,$scope.fieldChanged.preLaunchButtonBackgroundColor=!0)},!1),$scope.$watch("app.preLaunchButtonBackgroundOpacity",function(newValue,oldValue){newValue!==oldValue&&($scope.fieldChangeSuccess.preLaunchButtonBackgroundOpacity=!1,$scope.fieldChanged.preLaunchButtonBackgroundOpacity=!0)},!1),$scope.$watch("app.postSessionButtonText",function(newValue,oldValue){newValue!==oldValue&&($scope.fieldChangeSuccess.postSessionButtonText=!1,$scope.fieldChanged.postSessionButtonText=!0)},!1),$scope.$watch("app.postSessionButtonTextColor",function(newValue,oldValue){newValue!==oldValue&&($scope.fieldChangeSuccess.postSessionButtonTextColor=!1,$scope.fieldChanged.postSessionButtonTextColor=!0)},!1),$scope.$watch("app.postSessionButtonBackgroundColor",function(newValue,oldValue){newValue!==oldValue&&($scope.fieldChangeSuccess.postSessionButtonBackgroundColor=!1,$scope.fieldChanged.postSessionButtonBackgroundColor=!0)},!1),$scope.$watch("app.postSessionButtonBackgroundOpacity",function(newValue,oldValue){newValue!==oldValue&&($scope.fieldChangeSuccess.postSessionButtonBackgroundOpacity=!1,$scope.fieldChanged.postSessionButtonBackgroundOpacity=!0)},!1),$scope.$watch("app.launchUrl",function(newValue,oldValue){newValue!==oldValue&&($scope.fieldChangeSuccess.launchUrl=!1,$scope.fieldChanged.launchUrl=!0)},!1)},function(errorResponse){$scope.error=!0}),$scope.timeout=function(){$scope.disabled.timeout=!0,$http.post("/api/app/"+$rootScope.app.privateKey+"/update",{privateKey:$rootScope.app.privateKey,timeout:$rootScope.app.timeout}).then(function(response){$rootScope.app=response.data,setDefaults(),$scope.disabled.timeout=!1},function(errorResponse){console.log(errorResponse.data),$scope.disabled.timeout=!1})},$scope.disable=function(disabled){$scope.disabled.disabled=!0,$http.post("/api/app/"+$rootScope.app.privateKey+"/update",{privateKey:$rootScope.app.privateKey,disabled:disabled}).then(function(response){$rootScope.app=response.data,$scope.disabledConfirm=null,$scope.showDisabledButton=!1,setDefaults(),$scope.disabled.disabled=!1},function(errorResponse){console.log(errorResponse.data),$scope.disabledConfirm=null,$scope.showDisabledButton=!1,$scope.disabled.disabled=!1})},$scope.protectedByAccount=function(protectedByAccount){$scope.disabled.protectedByAccount=!0,$http.post("/api/app/"+$rootScope.app.privateKey+"/update",{privateKey:$rootScope.app.privateKey,protectedByAccount:protectedByAccount}).then(function(response){$rootScope.app=response.data,$scope.accessConfirm=null,$scope.showAccessButton=!1,setDefaults(),$scope.disabled.protectedByAccount=!1},function(errorResponse){console.log(errorResponse.data),$scope.accessConfirm=null,$scope.showAccessButton=!1,$scope.disabled.protectedByAccount=!1})},$scope.disableHome=function(){$scope.disabled.disableHome=!0,$http.post("/api/app/"+$rootScope.app.privateKey+"/update",{privateKey:$rootScope.app.privateKey,disableHome:$rootScope.app.disableHome}).then(function(response){$rootScope.app=response.data,setDefaults(),$scope.disabled.disableHome=!1},function(errorResponse){console.log(errorResponse.data),$scope.disabled.disableHome=!1})},$scope.updateFieldWithChange=function(field){$scope.fieldChangeSuccess[field]=!1,$scope.disabled[field]=!0;var postData={};postData[field]=$rootScope.app[field]||null,$http.post("/api/app/"+$rootScope.app.privateKey+"/update",postData).then(function(response){$rootScope.app=response.data,setDefaults(),$scope.disabled[field]=!1,$scope.fieldChangeSuccess[field]=!0,$scope.fieldChanged[field]=!1},function(errorResponse){console.log(errorResponse.data),$scope.disabled[field]=!1})},$scope.updateFieldWithValue=function(field,value){var fieldsToUpdate={};fieldsToUpdate[field]=value,("authenticated"!==value||confirm("Restrict this action to signed in users only?"))&&$http.post("/api/app/"+$rootScope.app.privateKey+"/update",fieldsToUpdate).then(function(response){$rootScope.app=response.data,setDefaults()},function(errorResponse){console.log(errorResponse.data)})};var apiBaseUrl="https://api.appetize.io";"localhost"==$location.$$host&&(apiBaseUrl="http://localhost:9081"),$scope.downloadUsage=function(){$window.location.href="/api/app/"+$rootScope.app.publicKey+"/usageReport"},$scope.downloadLogs=function(){var monthString=$scope.logMonth.getFullYear()+"-"+("0"+($scope.logMonth.getMonth()+1)).slice(-2);$window.location.href="/api/app/"+$rootScope.app.publicKey+"/sessionLogs/?month="+monthString},$scope.deleteGraphic=function(key,array,field){if(array&&array[key]){$scope.disabled.uploadGraphic=!0,delete array[key];var postData={};postData[field]={},postData[field][key]=null,$http.post("/api/app/"+$rootScope.app.privateKey+"/update",postData).then(function(response){$rootScope.app=response.data,setDefaults(),$scope.disabled.uploadGraphic=!1},function(errorResponse){console.log(errorResponse.data),$scope.disabled.uploadGraphic=!1})}},$scope.onGraphicSelect=function($files,field,device){var file=$files[0];return file.size>5242880?void toastr.error("Your proposed upload exceeds the maximum allowed size of 5MB"):($scope.disabled.uploadGraphic=!0,void $http({method:"GET",url:"/api/files/signedStaticUpload",params:{type:file.type}}).then(function(response){var uploadCredential=response.data;if($scope.fileUploadProgress=0,"s3"===uploadCredential.storageType)$scope.fileUpload=$upload.upload({url:uploadCredential.url,method:"POST",data:{key:uploadCredential.key,acl:"public-read",AWSAccessKeyId:uploadCredential.AWSAccessKeyId,"Content-Type":uploadCredential.mimetype,success_action_status:"201",Policy:uploadCredential.s3Policy,Signature:uploadCredential.s3Signature},file:file});else{if("local"!==uploadCredential.storageType)return;$scope.fileUpload=$upload.http({url:uploadCredential.url,headers:{"Content-Type":file.type},data:file})}$scope.fileUpload.then(function(response){if($scope.fileUploadProgress=!1,201===response.status){var data;"s3"===uploadCredential.storageType?data=x2js.xml_str2json(response.data):"local"===uploadCredential.storageType&&(data=response.data);var postData={};postData[field]={},postData[field][device]=decodeURIComponent(data.PostResponse.Location),$http.post("/api/app/"+$rootScope.app.privateKey+"/update",postData).then(function(response){$rootScope.app=response.data,setDefaults(),$scope.disabled.uploadGraphic=!1},function(errorResponse){console.log(errorResponse.data),$scope.disabled.uploadGraphic=!1})}else toastr.error("Error uploading file"),$scope.disabled.uploadGraphic=!1},function(failure){var data=x2js.xml_str2json(failure.data);"EntityTooLarge"==data.Error.Code?toastr.error("Your proposed upload exceeds the maximum allowed size of 5MB"):toastr.error("Error uploading file"),$scope.disabled.uploadGraphic=!1},function(evt){$scope.fileUploadProgress=parseInt(100*evt.loaded/evt.total)})})["catch"](function(data){toastr.error("Error uploading file"),$scope.disabled.uploadGraphic=!1}))}}]),angular.module("appetizeApp").controller("NavbarCtrl",["$scope","$location",function($scope,$location){$scope.isActive=function(route){return route===$location.path()}}]),angular.module("appetizeApp").controller("UploadCtrl",["$scope","$rootScope","$upload","$route","$http","$location","$window",function($scope,$rootScope,$upload,$route,$http,$location,$window){function endsWith(str,suffix){return-1!==str.toLowerCase().indexOf(suffix.toLowerCase(),str.length-suffix.length)}console.log("UploadCtrl loaded");var x2js=new X2JS;$scope.error={};var uploadCredential=null;$scope.progress=!1,$scope.formData={},$http.get("/api/files/signedUpload").then(function(response){uploadCredential=response.data,$scope.loaded=!0},function(errorResponse){$scope.error.load=!0}),$scope.reloadPage=function(){$route.reload()},$scope.onFileSelect=function($files){for(var i=0;i<$files.length;i++){var fileType,fileSize,platform,file=$files[i];if(endsWith(file.name,".zip"))fileType="zip",platform="ios";else if(endsWith(file.name,".tar.gz"))fileType="tar.gz",platform="ios";else{if(!endsWith(file.name,".apk"))return $scope.error.message="Please upload a .zip or .tar.gz for iOS, or .apk for Android",void($scope.error.upload=!0);fileType="apk",platform="android"}if(fileSize=file.size,$scope.error.upload=!1,$scope.formData.location=null,$scope.error.message=null,$scope.success=!1,"object"==typeof $scope.pageConfig&&($scope.pageConfig.newValue=!1),file.size>1e9)return $scope.error.message="Your proposed upload exceeds the maximum allowed size of 1GB",void($scope.error.upload=!0);if($scope.progress=.01,"s3"===uploadCredential.storageType)$scope.upload=$upload.upload({url:uploadCredential.url,method:"POST",data:{key:uploadCredential.key,acl:"authenticated-read",AWSAccessKeyId:uploadCredential.AWSAccessKeyId,success_action_status:"201","x-amz-server-side-encryption":"AES256",Policy:uploadCredential.s3Policy,Signature:uploadCredential.s3Signature},file:file});else{if("local"!==uploadCredential.storageType)return;$scope.upload=$upload.http({url:uploadCredential.url,headers:{"Content-Type":file.type},data:file})}$scope.upload.then(function(response){if($scope.progress=!1,201===response.status){var data;"s3"===uploadCredential.storageType?data=x2js.xml_str2json(response.data):"local"===uploadCredential.storageType&&(data=response.data),$rootScope.app&&$rootScope.app.privateKey?$http.post("/api/app/"+$rootScope.app.privateKey+"/update",{location:decodeURIComponent(data.PostResponse.Location),fileType:fileType,fileSize:fileSize,platform:platform}).then(function(response){$rootScope.app.updated=response.data.updated,$rootScope.app.platform=response.data.platform,$rootScope.app.versionCode=response.data.versionCode,$rootScope.app.email=response.data.email,"object"==typeof $scope.pageConfig&&($scope.pageConfig.newValue=!0),$scope.formData.location=response.data.file},function(errorResponse){$scope.error.upload=!0,$scope.error.message=errorResponse.data}):($scope.formData.location=decodeURIComponent(data.PostResponse.Location),$scope.formData.fileType=fileType,$scope.formData.fileSize=fileSize,$scope.formData.platform=platform,$rootScope.user&&($scope.formData.email=$rootScope.user.username,$scope.formData.sendEmail=!1,$scope.generate()))}else $scope.error.upload=!0},function(failure){var data=x2js.xml_str2json(failure.data);"EntityTooLarge"==data.Error.Code&&($scope.error.message="Your proposed upload exceeds the maximum allowed size of 1GB"),$scope.progress=!1,$scope.error.upload=!0},function(evt){$scope.progress=parseInt(100*evt.loaded/evt.total)>.01?parseInt(100*evt.loaded/evt.total):.01})}},$scope.generate=function(token){$rootScope.appConfig.recaptcha&&$window.grecaptcha.reset(),$scope.disabled=!0,$scope.error.generate=null,$scope.formData.token=token,$scope.error.generateMessage=null,$http.post("/api/app/create",$scope.formData).then(function(response){$scope.success=!0,$rootScope.recordEvent("app_created_via_upload"+$scope.device),$scope.newApp=response.data,$scope.disabled=!1},function(errorResponse){$scope.error.generate=!0,$scope.disabled=!1,403===errorResponse.status&&($scope.error.generateMessage="Error uploading app. User specified is a non-developer member of an existing account, or must be logged in to upload apps.")})},$window.generate=$scope.generate,$window.recaptchaReset=function(){$rootScope.appConfig.recaptcha&&($scope.formError="There was an error, please try again or contact hello@appetize.io.",$scope.disabled=!1,$window.grecaptcha.reset())},$scope.validate=function(){$scope.formError=null,$scope.uploadForm1.$valid&&($scope.disabled=!0,$rootScope.appConfig.recaptcha?$window.grecaptcha.execute():$scope.generate())}}]),angular.module("appetizeApp").controller("CanvasCtrl",["$scope","$routeParams","$timeout","$sce","$rootScope","$modal","$location","$anchorScroll","$http","Device","appConstants",function($scope,$routeParams,$timeout,$sce,$rootScope,$modal,$location,$anchorScroll,$http,Device,appConstants){function isValidScale(scale){return"number"==typeof scale&&scale>=10&&100>=scale?!0:!1}function getDeviceForPlatform(platform){return $rootScope.deviceConfig.compatibleDevices&&$rootScope.deviceConfig.compatibleDevices[platform]&&objectContainsKey($routeParams.device,$rootScope.deviceConfig.compatibleDevices[platform])?$routeParams.device:"android"==platform?$rootScope.deviceConfig.androidDefault:platform||!objectContainsKey($routeParams.device,$rootScope.deviceConfig.compatibleDevices.ios)&&!objectContainsKey($routeParams.device,$rootScope.deviceConfig.compatibleDevices.android)?$rootScope.deviceConfig.iosDefault:$routeParams.device}function interpolateJourneyPlayback(journey){for(var lastInteraction,lastInteractionOriginalTimeStamp,timeToAdd=0,result=[],i=0;i<journey.length;i++){if("mousedown"===journey[i].type||"keypress"===journey[i].type)lastInteractionOriginalTimeStamp=journey[i].timeStamp,journey[i].timeStamp+=timeToAdd,result.push(journey[i]);else if("mouseup"===journey[i].type){if("mousedown"!==lastInteraction.type)return void toastr.error("Error processing journeyPlaybackSimple");for(var deltaX=journey[i].xPos-lastInteraction.xPos,deltaY=journey[i].yPos-lastInteraction.yPos,numSteps=Math.abs(deltaX)>Math.abs(deltaY)?Math.ceil(Math.abs(deltaX)/10):Math.ceil(Math.abs(deltaY)/10),j=0;numSteps>j;j++)result.push({
type:"mousemove",timeStamp:lastInteractionOriginalTimeStamp+timeToAdd,xPos:Math.ceil(lastInteraction.xPos+j/numSteps*deltaX),yPos:Math.ceil(lastInteraction.yPos+j/numSteps*deltaY)}),timeToAdd+=20;journey[i].timeStamp+=timeToAdd,result.push(journey[i])}else if("string"===journey[i].type)for(var k=0;k<journey[i].value.length;k++){var rawKey=$rootScope.convertCharToRawKey(journey[i].value[k]);result.push({type:"keypress",key:rawKey.key,shiftKey:rawKey.shiftKey,timeStamp:journey[i].timeStamp+timeToAdd}),timeToAdd+=50}lastInteraction=journey[i]}return result}if(console.log("CanvasCtrl loaded"),$anchorScroll(),$scope.trustSrc=function(src){return $sce.trustAsResourceUrl(src)},$rootScope.devices=[],$rootScope.isEmbed=$location.path().indexOf("/embed/")>-1,$rootScope.isHomepage="/"===$location.path(),$rootScope.isStandalone=$location.path().indexOf("/standalone")>-1,toastr.options.timeOut=1e4,toastr.options.positionClass="toast-bottom-full-width",$rootScope.deviceConfig.compatibleDevices.ios){$rootScope.deviceConfig.iosDevices=[];for(var key in $rootScope.deviceConfig.compatibleDevices.ios)$rootScope.deviceConfig.iosDevices.push(key)}if($rootScope.deviceConfig.compatibleDevices.android){$rootScope.deviceConfig.androidDevices=[];for(var key in $rootScope.deviceConfig.compatibleDevices.android)$rootScope.deviceConfig.androidDevices.push(key)}$rootScope.deviceConfig.deviceLabels=appConstants.deviceLabels;var firstDevice={};"landscape"==$routeParams.orientation?(firstDevice.orientation="landscape",firstDevice.rotation=270):(firstDevice.orientation="portrait",firstDevice.rotation=0);var scaleInput=parseInt($routeParams.scale);isValidScale(scaleInput)?firstDevice.scale=scaleInput:appConstants.tabletDevices.indexOf($routeParams.device)>-1?firstDevice.scale=50:firstDevice.scale=75,"silver"==$routeParams.deviceColor||"white"==$routeParams.deviceColor||!$routeParams.deviceColor&&!$rootScope.isEmbed?firstDevice.deviceColor="white":firstDevice.deviceColor="black","true"==$routeParams.screenOnly?firstDevice.showDeviceBorder=!1:firstDevice.showDeviceBorder=!0,"true"==$routeParams.debug?firstDevice.debug=!0:firstDevice.debug=!1,"true"==$routeParams.noVideo?firstDevice.noVideo=!0:firstDevice.noVideo=!1,"true"==$routeParams.broadcastInteractions?firstDevice.broadcastInteractions=!0:firstDevice.broadcastInteractions=!1,"true"==$routeParams.enableAdb?firstDevice.enableAdb=!0:firstDevice.enableAdb=!1,"true"==$routeParams.embedLogs&&(firstDevice.embedLogs=!0),"true"==$routeParams.showRotateButtons&&(firstDevice.showRotateButtons=!0),"true"==$routeParams.screenRecording?firstDevice.screenRecording=!0:firstDevice.screenRecording=!1,"true"==$routeParams.disableSessionStart&&(firstDevice.disableSessionStart=!0),"true"==$routeParams.loopback?firstDevice.loopback=!0:firstDevice.loopback=!1,"true"==$routeParams.androidPackageManager?firstDevice.androidPackageManager=!0:firstDevice.androidPackageManager=!1,"true"==$routeParams.xdocMsg?firstDevice.xdocMsg=!0:firstDevice.xdocMsg=!1,"true"==$routeParams.autoplay?firstDevice.autoplay=!0:firstDevice.autoplay=!1,"true"==$routeParams.centered?firstDevice.centered=!0:firstDevice.centered=!1,"true"==$routeParams.grantPermissions&&(firstDevice.grantPermissions=!0),"true"==$routeParams.hidePasswords&&(firstDevice.hidePasswords=!0),"true"==$routeParams.record&&(firstDevice.record=!0),"h264"==$routeParams.codec?firstDevice.requestedCodec="h264":"jpeg"==$routeParams.codec&&(firstDevice.requestedCodec="jpeg"),"true"==$routeParams.audio?firstDevice.enableAudio=!0:firstDevice.enableAudio=!1,"top"==$routeParams.toast&&(toastr.options.positionClass="toast-top-full-width"),appConstants.physicalDevices.indexOf($routeParams.device)>-1?firstDevice.physical=!0:firstDevice.physical=!1,$routeParams.language&&(firstDevice.language=$routeParams.language),$routeParams.locale&&(firstDevice.locale=$routeParams.locale),$routeParams.adbShellCommand&&(firstDevice.adbShellCommand=$routeParams.adbShellCommand),"true"==$routeParams.disableVirtualKeyboard&&(firstDevice.disableVirtualKeyboard=!0),$routeParams.timezone&&(firstDevice.timezone=$routeParams.timezone);var userTimezone;try{var intlName=Intl.DateTimeFormat().resolvedOptions().timeZone;intlName&&intlName.length>3&&(userTimezone=intlName)}catch(e){}if(firstDevice.userTimezone=userTimezone,$routeParams.iosKeyboard&&(firstDevice.iosKeyboard=$routeParams.iosKeyboard),$routeParams.osVersion&&(firstDevice.osVersion=$routeParams.osVersion),$routeParams.location&&($routeParams.location.match(/^-?[\d]{1,3}[.][\d]+,-?[\d]{1,3}[.][\d]+$/)?firstDevice.location=$routeParams.location:console.log("Invalid location specified, must be expressed  location=10.123,42.12\nYou specified: "+$routeParams.location)),$routeParams.launchUrl&&(firstDevice.launchUrl=$routeParams.launchUrl),$routeParams.proxy&&(firstDevice.proxy=$routeParams.proxy),$routeParams.pc&&(firstDevice.payerCode=$routeParams.pc),firstDevice.region=$routeParams.region,firstDevice.notFirstRequest=!1,firstDevice.params=null,$routeParams.params)try{firstDevice.params=JSON.parse(decodeURIComponent($routeParams.params)),firstDevice.paramsString=JSON.parse(decodeURIComponent($routeParams.params))}catch(err){firstDevice.paramsString="Unable to parse params",console.log("Error parsing params, ",err)}if(firstDevice.plistEdit=null,$routeParams.plistEdit)try{firstDevice.plistEdit=JSON.parse(decodeURIComponent($routeParams.plistEdit)),firstDevice.plistEditString=JSON.parse(decodeURIComponent($routeParams.plistEdit))}catch(err){firstDevice.plistEditString="Unable to parse plistEdit",console.log("Error parsing plistEdit, ",err)}$rootScope.devices.push(new Device(firstDevice)),$scope.addWatch=function(){var watch={name:"wearround",deviceColor:"black",showDeviceBorder:!0,notFirstRequest:!1,params:null,type:"watch",scale:75,orientation:"portrait",platform:"android",rotation:0};$rootScope.devices.push(new Device(watch)),$rootScope.devices[1].setDeviceParameters("wearround"),$rootScope.devices[1].updateScaledWidthsAndHeights(),$rootScope.devices[0].appLaunch&&$rootScope.devices[1].requestSession()},$scope.connectWatch=function(){$rootScope.devices[1].connectWatch($rootScope.devices[0].connectionString,$rootScope.devices[0].connectionToken)},$scope.removeWatch=function(){$rootScope.devices[$rootScope.devices.length-1].destroy(),$rootScope.devices.pop()};var sampleSms=["Hello from Appetize.io!","You're looking great today!","Knock, Knock...","Go on, try and break me!","Sorry, I'm not talkative right now"];if($scope.sendSms=function(){"watch"!=$rootScope.devices[0].type&&$rootScope.devices[0].appetizer&&$rootScope.devices[1]&&($rootScope.devices[0].appetizer.emit("sendSms",{message:sampleSms[Math.floor(Math.random()*sampleSms.length)]}),$rootScope.devices[1].heartbeat())},$rootScope.app=null,"/"===$location.path())$rootScope.isEmbed=!0,$rootScope.app=appConstants.homepageDemoAppData,$routeParams.device="iphone6s",$rootScope.devices[0].updateDevice($routeParams.device),$rootScope.devices[0].centered=!0,$rootScope.devices[0].updateScale(60),$rootScope.devices[0].deviceColor="white";else if($routeParams.publicKey&&"demo"!=$routeParams.publicKey)"<PUBLIC KEY>"==$routeParams.publicKey||$routeParams.publicKey.indexOf("<")>-1||$routeParams.publicKey.indexOf(">")>-1?$scope.mustReplacePublicKey=!0:$http.get("/api/app/"+$routeParams.publicKey+"?pc="+$routeParams.pc).then(function(response){$rootScope.app=response.data,$rootScope.devices[0].updateDevice(getDeviceForPlatform(response.data.platform)),$routeParams.addWatch&&$scope.addWatch()},function(errorResponse){"This app is no longer available"===errorResponse.data?$scope.error={message:errorResponse.data}:$scope.error={message:"Error loading app, please verify URL"}});else if($routeParams.privateKey)$http.get("/api/app/"+$routeParams.privateKey+"/manage").then(function(response){$rootScope.app=response.data,$rootScope.devices[0].updateDevice(getDeviceForPlatform(response.data.platform)),$rootScope.devices[0].debug=!0,$routeParams.addWatch&&$scope.addWatch()},function(errorResponse){$scope.error=!0});else if($rootScope.isEmbed&&"demo"!=$routeParams.publicKey)if(3===$location.path().split("/").length){var publicKey=$location.path().split("/")[2];$http.get("/api/app/"+publicKey+"?pc="+$routeParams.pc).then(function(response){$rootScope.app=response.data,$rootScope.devices[0].updateDevice(getDeviceForPlatform(response.data.platform)),$routeParams.addWatch&&$scope.addWatch()},function(errorResponse){401===errorResponse.status?$scope.error={message:"This app is no longer available."}:$scope.error={message:"Error loading app, please verify URL"}})}else $scope.error=!0;else $rootScope.isEmbed&&"demo"==$routeParams.publicKey?$scope.error={message:"Embedding the demo is not allowed, please visit https://appetize.io/demo"}:1==$scope.adbConnect?($rootScope.devices[0].enableAdb=!0,$rootScope.deviceConfig.androidDevices.indexOf($routeParams.device)>-1?$rootScope.devices[0].updateDevice($routeParams.device):$rootScope.devices[0].updateDevice($rootScope.deviceConfig.androidDefault)):$rootScope.isStandalone?($rootScope.deviceConfig.iosDevices.indexOf($routeParams.device)>-1||$rootScope.deviceConfig.androidDevices.indexOf($routeParams.device)>-1?$rootScope.devices[0].updateDevice($routeParams.device):$rootScope.devices[0].updateDevice($rootScope.deviceConfig.systemDefault),$routeParams.addWatch&&$scope.addWatch()):($rootScope.deviceConfig.iosDevices.indexOf($routeParams.device)>-1||$rootScope.deviceConfig.androidDevices.indexOf($routeParams.device)>-1?$rootScope.devices[0].updateDevice($routeParams.device):$rootScope.devices[0].updateDevice($rootScope.deviceConfig.systemDefault),$routeParams.addWatch&&$scope.addWatch(),$rootScope.isDemo=!0);if($scope.onClipboardSuccess=function(e){e.clearSelection()},$scope.$on("$locationChangeStart",function(event,next,current){if(!(current.indexOf(-1==next.indexOf("?")?next:next.substring(0,next.indexOf("?")))>-1)){for(var i=0;i<$rootScope.devices.length;i++)$rootScope.devices[i].destroy();$rootScope.devices=[],$rootScope.app=null,$rootScope.isEmbed=null,$(document).off("keypress").keypress(function(e){}),$(document).off("keydown").keydown(function(e){}),$(document).off("keyup").keyup(function(e){}),toastr.remove()}}),"true"==$routeParams.xdocMsg){var messageEventHandler=function(event){if("requestSession"==event.data)$rootScope.devices[0].appetizer||$rootScope.devices[0].queue||($rootScope.app.programmaticPlay?$rootScope.devices[0].requestSession():toastr.warning("Cross-document messages are not supported under the Trial plan. Please try again!"));else if("emitHomeButton"==event.data)$rootScope.devices[0].appetizer&&$rootScope.devices[0].appLaunch&&$rootScope.devices[0].appetizer.emit("userInteraction",{type:"keypress",which:null,shiftKey:null,key:"home",timeStamp:Date.now()});else if("rotateLeft"==event.data)$rootScope.devices[0].rotateLeft(),$rootScope.$apply(function(){});else if("rotateRight"==event.data)$rootScope.devices[0].rotateRight(),$rootScope.$apply(function(){});else if("playEvent"===event.data.type&&event.data.value)$rootScope.devices[0].playEvent(event.data.value),$rootScope.$apply(function(){});else if("setScale"===event.data.type&&event.data.value){var newScale=parseInt(event.data.value);isValidScale(newScale)&&($rootScope.devices[0].updateScale(newScale),$rootScope.$apply(function(){}))}else if("setParams"===event.data.type&&event.data.value){delete $rootScope.devices[0].params,delete $rootScope.devices[0].paramsString;try{$rootScope.devices[0].params=JSON.parse(decodeURIComponent(event.data.value)),$rootScope.devices[0].paramsString=JSON.parse(decodeURIComponent(event.data.value)),console.log("params set to "+JSON.parse(decodeURIComponent(event.data.value)))}catch(err){$rootScope.devices[0].paramsString="Unable to parse params",console.log("Error parsing params, ",err)}$rootScope.$apply(function(){})}else if("setLaunchUrl"===event.data.type&&event.data.value)$rootScope.devices[0].launchUrl=event.data.value,console.log("launchUrl set to "+event.data.value),console.log("launchUrl length is "+event.data.value.length);else if("setVolume"===event.data.type&&event.data.value){var volume=parseFloat(event.data.value);if(0>volume||volume>1)return console.log("Volume must be [0,1]"),void toastr.error("Volume must be [0,1]");$rootScope.devices[0].setVolume(volume)}else if("enableSessionStart"==event.data)$rootScope.devices[0].disableSessionStart=!1;else if("disableSessionStart"==event.data)$rootScope.devices[0].disableSessionStart=!0;else if("cleanConnection"==event.data)$rootScope.devices[0].cleanConnection();else if("endSession"==event.data)$rootScope.devices[0].endSession();else if("saveScreenshot"==event.data)$rootScope.devices[0].appetizer&&$rootScope.devices[0].appLaunch&&$rootScope.devices[0].screenshot();else if("getScreenshot"==event.data)$rootScope.devices[0].appetizer&&$rootScope.devices[0].appLaunch&&$rootScope.devices[0].xdocScreenshot();else if("heartbeat"==event.data)$rootScope.devices[0].appetizer&&($rootScope.devices[0].appLaunch||$rootScope.devices[0].physical)&&$rootScope.devices[0].appetizer.emit("userInteraction",{type:"heartbeat"});else if("androidKeycodeMenu"==event.data)$rootScope.devices[0].appetizer&&($rootScope.devices[0].appLaunch||$rootScope.devices[0].physical)&&$rootScope.devices[0].appetizer.emit("androidKeycodeMenu");else if("dumpUi"==event.data)$rootScope.devices[0].appetizer&&$rootScope.devices[0].appLaunch&&$rootScope.devices[0].appetizer.emit("dumpUi");else if("restartApp"==event.data)$rootScope.devices[0].appetizer&&$rootScope.devices[0].appLaunch&&$rootScope.devices[0].appetizer.emit("restartApp");else if("shakeDevice"==event.data)$rootScope.devices[0].appetizer&&$rootScope.devices[0].appLaunch&&$rootScope.devices[0].appetizer.emit("shakeDevice");else if("biometryMatch"==event.data)$rootScope.devices[0].appetizer&&$rootScope.devices[0].appLaunch&&$rootScope.devices[0].appetizer.emit("biometryMatch");else if("biometryNonMatch"==event.data)$rootScope.devices[0].appetizer&&$rootScope.devices[0].appLaunch&&$rootScope.devices[0].appetizer.emit("biometryNonMatch");else if("disableInteractions"==event.data)$rootScope.devices[0].emitUserInteractionDisabled=!0;else if("enableInteractions"==event.data)$rootScope.devices[0].emitUserInteractionDisabled=!1;else if("swipeRight"==event.data){if($rootScope.devices[0].appetizer&&$rootScope.devices[0].appLaunch){var steps=[{type:"mousedown",timeStamp:43299.635,xPos:31,yPos:273},{type:"mousemove",timeStamp:43383.995,xPos:33,yPos:273},{type:"mousemove",timeStamp:43401.69500000001,xPos:42,yPos:273},{type:"mousemove",timeStamp:43418.82000000001,xPos:55,yPos:273},{type:"mousemove",timeStamp:43435.66,xPos:85,yPos:273},{type:"mousemove",timeStamp:43452.545,xPos:124,yPos:273},{type:"mousemove",timeStamp:43469.67,xPos:164,yPos:273},{type:"mousemove",timeStamp:43486.565,xPos:196,yPos:273},{type:"mousemove",timeStamp:43503.670000000006,xPos:224,yPos:279},{type:"mousemove",timeStamp:43521.30500000001,xPos:236,yPos:280},{type:"mousemove",timeStamp:43538.385,xPos:249,yPos:283},{type:"mousemove",timeStamp:43555.42500000001,xPos:253,yPos:283},{type:"mousemove",timeStamp:43572.46000000001,xPos:255,yPos:284},{type:"mousemove",timeStamp:43589.64,xPos:255,yPos:286},{type:"mousemove",timeStamp:43607.340000000004,xPos:256,yPos:286},{type:"mouseup",timeStamp:43623.58,xPos:256,yPos:286}];$rootScope.devices[0].playBackSequence(steps,0,10)}}else if("swipeLeft"==event.data){if($rootScope.devices[0].appetizer&&$rootScope.devices[0].appLaunch){var steps=[{type:"mousedown",timeStamp:40900.785,xPos:279,yPos:290},{type:"mousemove",timeStamp:41005.895000000004,xPos:275,yPos:290},{type:"mousemove",timeStamp:41022.745,xPos:267,yPos:290},{type:"mousemove",timeStamp:41039.740000000005,xPos:260,yPos:290},{type:"mousemove",timeStamp:41056.54000000001,xPos:250,yPos:290},{type:"mousemove",timeStamp:41073.545000000006,xPos:232,yPos:290},{type:"mousemove",timeStamp:41090.545000000006,xPos:203,yPos:290},{type:"mousemove",timeStamp:41107.965,xPos:174,yPos:290},{type:"mousemove",timeStamp:41124.810000000005,xPos:154,yPos:290},{type:"mousemove",timeStamp:41141.98,xPos:134,yPos:288},{type:"mousemove",timeStamp:41158.705,xPos:116,yPos:287},{type:"mousemove",timeStamp:41175.62500000001,xPos:103,yPos:284},{type:"mousemove",timeStamp:41192.61,xPos:91,yPos:283},{type:"mousemove",timeStamp:41209.755000000005,xPos:81,yPos:283},{type:"mousemove",timeStamp:41226.655,xPos:72,yPos:283},{type:"mousemove",timeStamp:41243.575,xPos:62,yPos:282},{type:"mousemove",timeStamp:41260.795,xPos:54,yPos:280},{type:"mousemove",timeStamp:41277.545000000006,xPos:45,yPos:278},{type:"mousemove",timeStamp:41294.255000000005,xPos:31,yPos:273},{type:"mouseup",timeStamp:41339.605,xPos:31,yPos:273}];$rootScope.devices[0].playBackSequence(steps,0,10)}}else if("swipeDown"==event.data){if($rootScope.devices[0].appetizer&&$rootScope.devices[0].appLaunch){var steps=[{type:"mousedown",timeStamp:52000.895000000004,xPos:137,yPos:69},{type:"mousemove",timeStamp:52100.95500000001,xPos:137,yPos:72},{type:"mousemove",timeStamp:52131.655,xPos:137,yPos:111},{type:"mousemove",timeStamp:52165.08500000001,xPos:142,yPos:151},{type:"mousemove",timeStamp:52198.835,xPos:146,yPos:184},{type:"mousemove",timeStamp:52232.58500000001,xPos:152,yPos:232},{type:"mousemove",timeStamp:52266.355,xPos:159,yPos:290},{type:"mousemove",timeStamp:52300.155000000006,xPos:164,yPos:346},{type:"mousemove",timeStamp:52367.685000000005,xPos:163,yPos:414},{type:"mousemove",timeStamp:52435.135,xPos:160,yPos:448},{type:"mousemove",timeStamp:52468.87,xPos:159,yPos:456},{type:"mousemove",timeStamp:52503.30500000001,xPos:159,yPos:462},{type:"mousemove",timeStamp:52538.975000000006,xPos:159,yPos:464},{type:"mousemove",timeStamp:52577.83000000001,xPos:157,yPos:466},{type:"mousemove",timeStamp:52611.435000000005,xPos:157,yPos:467},{type:"mousemove",timeStamp:52662.76500000001,xPos:157,yPos:474},{type:"mousemove",timeStamp:52696.990000000005,xPos:157,yPos:482},{type:"mousemove",timeStamp:52731.135,xPos:160,yPos:488},{type:"mouseup",timeStamp:52847.825000000004,xPos:160,yPos:488}];$rootScope.devices[0].playBackSequence(steps,0,10)}}else if("swipeUp"==event.data){if($rootScope.devices[0].appetizer&&$rootScope.devices[0].appLaunch){var steps=[{type:"mousedown",timeStamp:48373.990000000005,xPos:146,yPos:488},{type:"mousemove",timeStamp:48391.705,xPos:142,yPos:470},{type:"mousemove",timeStamp:48425.58,xPos:126,yPos:464},{type:"mousemove",timeStamp:48459.715000000004,xPos:114,yPos:412},{type:"mousemove",timeStamp:48493.735,xPos:109,yPos:368},{type:"mousemove",timeStamp:48527.345,xPos:107,yPos:330},{type:"mousemove",timeStamp:48561.055,xPos:107,yPos:302},{type:"mousemove",timeStamp:48595.04,xPos:107,yPos:280},{type:"mousemove",timeStamp:48629.415,xPos:107,yPos:261},{type:"mousemove",timeStamp:48663.020000000004,xPos:109,yPos:243},{type:"mousemove",timeStamp:48696.815,xPos:110,yPos:231},{type:"mousemove",timeStamp:48731.19500000001,xPos:110,yPos:218},{type:"mousemove",timeStamp:48765.495,xPos:110,yPos:201},{type:"mousemove",timeStamp:48799.46000000001,xPos:110,yPos:182},{type:"mousemove",timeStamp:48849.84000000001,xPos:107,yPos:160},{type:"mousemove",timeStamp:48917.66,xPos:107,yPos:140},{type:"mousemove",timeStamp:48986.18000000001,xPos:109,yPos:126},{type:"mousemove",timeStamp:49020.23500000001,xPos:111,yPos:118},{type:"mousemove",timeStamp:49087.715000000004,xPos:115,yPos:107},{type:"mousemove",timeStamp:49121.755000000005,xPos:117,yPos:102},{type:"mousemove",timeStamp:49173.705,xPos:120,yPos:97},{type:"mousemove",timeStamp:49207.77500000001,xPos:122,yPos:94},{type:"mousemove",timeStamp:49242.19,xPos:122,yPos:91},{type:"mousemove",timeStamp:49277.840000000004,xPos:123,yPos:91},{type:"mouseup",timeStamp:49371.735,xPos:123,yPos:91}];$rootScope.devices[0].playBackSequence(steps,0,10)}}else if(event.data&&"journeyPlayback"==event.data.type&&event.data.value)$rootScope.devices[0].appetizer&&$rootScope.devices[0].endSession(),$rootScope.devices[0].requestSession(),$rootScope.devices[0].journeyPlayback=event.data.value;else if(event.data&&"journeyPlaybackSimple"==event.data.type&&event.data.value){$rootScope.devices[0].appetizer&&$rootScope.devices[0].endSession(),$rootScope.devices[0].requestSession();var interpolated=interpolateJourneyPlayback(event.data.value);$rootScope.devices[0].journeyPlayback=interpolated}else if(event.data&&event.data.type&&$rootScope.devices[0].appetizer&&$rootScope.devices[0].appLaunch)if("mouseclick"==event.data.type&&event.data.x&&event.data.y)$rootScope.devices[0].appetizer.emit("userInteraction",{type:"mousedown",timeStamp:Date.now(),xPos:event.data.x,yPos:event.data.y}),$rootScope.devices[0].appetizer.emit("userInteraction",{type:"mouseup",timeStamp:Date.now(),xPos:event.data.x,yPos:event.data.y});else if("mousedown"==event.data.type&&event.data.x&&event.data.y)$rootScope.devices[0].appetizer.emit("userInteraction",{type:"mousedown",timeStamp:Date.now(),xPos:event.data.x,yPos:event.data.y});else if("mousemove"==event.data.type&&event.data.x&&event.data.y)$rootScope.devices[0].appetizer.emit("userInteraction",{type:"mousemove",timeStamp:Date.now(),xPos:event.data.x,yPos:event.data.y});else if("mouseup"==event.data.type&&event.data.x&&event.data.y)$rootScope.devices[0].appetizer.emit("userInteraction",{type:"mouseup",timeStamp:Date.now(),xPos:event.data.x,yPos:event.data.y});else if("keypress"==event.data.type&&event.data.key)$rootScope.devices[0].appetizer.emit("userInteraction",{type:"keypress",shiftKey:event.data.shiftKey+"",key:event.data.key,timeStamp:Date.now()});else if("pasteText"==event.data.type&&event.data.value){var stringToPaste=event.data.value;if("string"!=typeof stringToPaste||0==stringToPaste.length)return;for(var shiftKeyArray=[],keyArray=[],i=0;i<stringToPaste.length;i++){var rawKey=$rootScope.convertCharToRawKey(stringToPaste[i]);shiftKeyArray.push(rawKey.shiftKey),keyArray.push(rawKey.key)}$rootScope.devices[0].appetizer.emit("userInteraction",{type:"keypressArray",shiftKeyArray:shiftKeyArray,keyArray:keyArray,value:stringToPaste,timeStamp:Date.now()})}else"language"==event.data.type&&event.data.value?$rootScope.devices[0].appetizer.emit("setLanguage",{language:event.data.value,timeStamp:Date.now()}):"adbShellCommand"===event.data.type&&event.data.value?$rootScope.devices[0].appetizer.emit("adbShellCommand",{command:event.data.value,timeStamp:Date.now()}):"location"==event.data.type&&event.data.value?$rootScope.devices[0].appetizer.emit("setLocation",{location:event.data.value,timeStamp:Date.now()}):"url"==event.data.type&&event.data.value&&$rootScope.devices[0].appetizer.emit("openUrl",{url:event.data.value,timeStamp:Date.now()})};window.addEventListener("message",messageEventHandler,!1)}$rootScope.broadcastInteractionsConstants={controlKeys:[8,9,13,16,37,38,39,40,null],digitCharsWithShift:[")","!","@","#","$","%","^","&","*","("],charsWithShiftMap:{47:"?",44:"<",45:"_",46:">",91:"{",92:"|",93:"}",96:"~",59:":",61:"+",39:'"'},keysWithShiftMap:{191:"?",188:"<",189:"_",190:">",219:"{",220:"|",221:"}",192:"~",186:":",187:"+",222:'"'}},$rootScope.convertCharToRawKey=function(key){var result;for(var entry in $rootScope.broadcastInteractionsConstants.charsWithShiftMap)if(key===$rootScope.broadcastInteractionsConstants.charsWithShiftMap[entry])return result={key:String.fromCharCode(entry),shiftKey:"true"};var indexInDigits=$rootScope.broadcastInteractionsConstants.digitCharsWithShift.indexOf(key);return result=indexInDigits>-1?{key:String.fromCharCode(indexInDigits+48).toLowerCase(),shiftKey:"true"}:key!==key.toLowerCase()?{key:key.toLowerCase(),shiftKey:"true"}:{key:key,shiftKey:"false"}},$rootScope.getCharFromKeypress=function(event){return event.which>=65&&event.which<=90?"true"==event.shiftKey?event.key:event.key.toLowerCase():"false"==event.shiftKey?event.key:event.which>=48&&event.which<=57?$rootScope.broadcastInteractionsConstants.digitCharsWithShift[event.which-48]:$rootScope.broadcastInteractionsConstants.keysWithShiftMap[event.which]};var objectContainsKey=function(keyToFind,object){for(var key in object)if(key==keyToFind)return!0;return!1}}]),angular.module("appetizeApp").controller("SubscribeCtrl",["$scope","$http",function($scope,$http){$scope.subscription={},$scope.doSubscribe=function(email){$scope.subscription={},$scope.subscribeForm.$valid?$http.post("/api/doSubscribe",{email:email}).then(function(res){$scope.subscription.result="success"})["catch"](function(err){$scope.subscription.result="error",400===err.status?$scope.subscription.message=err.data:$scope.subscription.message="Error subscribing to newsletter, please try again or email hello@appetize.io"}):($scope.subscription.result="error",$scope.subscription.message="Error subscribing to newsletter, please try again or email hello@appetize.io")}}]),angular.module("appetizeApp").controller("AnalyticsCtrl",["$scope","$http","$rootScope","$location","$timeout","$upload","$routeParams","$window",function($scope,$http,$rootScope,$location,$timeout,$upload,$routeParams,$window){$rootScope.recordEvent=function(event){$window.isOnprem||(-1===document.cookie.indexOf("analytics-ignore")?_gaq.push(["_trackEvent","userInteraction",event]):console.log("excluded: "+event))},$rootScope.recordTransaction=function(purchase){if(!$window.isOnprem&&-1===document.cookie.indexOf("analytics-ignore")){var transId=Date.now();_gaq.push(["_addTrans",transId,"Appetize",purchase.cost,"0","0","N/A","N/A","N/A"]),_gaq.push(["_addItem",transId,purchase.accountId,purchase.plan,purchase.plan,purchase.cost,"1"]),_gaq.push(["_trackTrans"])}},$scope.$on("$routeChangeSuccess",function(event){$window.isOnprem||(-1===document.cookie.indexOf("analytics-ignore")?_gaq.push(["_trackPageview",$location.url()]):console.log("excluded: "+$location.url()))})}]),angular.module("appetizeApp").controller("ConnectCtrl",["$scope",function($scope){console.log("ConnectCtrl loaded"),$scope.adbConnect=!0,$scope.forceButtonText="ADB Connect",$scope.forceButtonColor="#333333"}]),angular.module("appetizeApp").controller("LoginCtrl",["$scope","$rootScope","$http","$routeParams","$location","$window","$cookies","AuthService",function($scope,$rootScope,$http,$routeParams,$location,$window,$cookies,AuthService){$cookies.get("appetize_default_auth_url")&&$cookies.get("appetize_default_login_url")?($scope.defaultAuthUrl=$window.location.origin+$cookies.get("appetize_default_auth_url"),$scope.defaultLoginUrl=$window.location.origin+$cookies.get("appetize_default_login_url")):$rootScope.isOnprem&&$rootScope.isOnprem.defaultAuthUrl&&$rootScope.isOnprem.defaultLoginUrl&&($scope.defaultAuthUrl=$rootScope.isOnprem.defaultAuthUrl,$scope.defaultLoginUrl=$rootScope.isOnprem.defaultLoginUrl),$scope.removeDefaultAuthUrl=function(){$cookies.remove("appetize_default_auth_url"),$cookies.remove("appetize_default_login_url"),$scope.defaultAuthUrl=null,$scope.defaultLoginUrl=null},$scope.openUrl=function(url){window.location.href=url},"true"==$routeParams.forcePasswordLogin&&($scope.forcePasswordLogin=!0),$scope.credentials={},"invite"==$routeParams.reason?$scope.reason="You must be signed in to accept or decline this invitation":"launch"==$routeParams.reason?$scope.reason="You must be signed in to visit the launch page":"manage"==$routeParams.reason?$scope.reason="You must be signed in to manage your apps":"debug"==$routeParams.reason?$scope.reason="You must be signed in to debug your apps":"standalone"==$routeParams.reason?$scope.reason="You must be signed in to run standalone devices":"unauthorized"==$routeParams.reason?$scope.reason="You are not authorized to access that page, please sign in below":"accounts"==$routeParams.reason?$scope.reason="Our accounts dashboard has moved, please sign in below":"systemadmin"==$routeParams.reason?$scope.reason="You must be logged in as a system admin to access that page":"admin"==$routeParams.reason?$scope.reason="You must be logged in as an account admin to access that page":"developer"==$routeParams.reason&&($scope.reason="You must be logged in as an account developer to access that page"),$scope.login=function(token){var credentials=$scope.credentials;credentials.token=token,$scope.formError=null,$scope.loginForm.$valid&&($scope.disabled=!0,AuthService.login(credentials).then(function(user){$scope.setCurrentUser(user),$routeParams.next?$location.url($routeParams.next):$routeParams.ref?window.location.href=$routeParams.ref:!$rootScope.isOnprem||!$rootScope.isOnprem.hasLaunchPage||$rootScope.user.roles&&0!==$rootScope.user.roles.length?$rootScope.isOnprem?$location.url("/"):$location.url("/dashboard"):$location.url("/launch-page")},function(response){console.log(response),429==response.status?$scope.formError=response.data:400==response.status?$scope.formError=response.data:$scope.formError=response.data||"Invalid username or password",$rootScope.appConfig.recaptcha&&$window.grecaptcha.reset(),$scope.disabled=!1}))},$window.login=$scope.login,$window.recaptchaReset=function(){$rootScope.appConfig.recaptcha&&($scope.formError="There was an error, please try again or contact hello@appetize.io.",$scope.disabled=!1,$window.grecaptcha.reset())},$scope.validate=function(){$scope.formError=null,$scope.loginForm.$valid&&($scope.disabled=!0,$rootScope.appConfig.recaptcha?$window.grecaptcha.execute():$scope.login())}}]),angular.module("appetizeApp").controller("SignupCtrl",["$scope","$rootScope","$http","$location","$anchorScroll","$window",function($scope,$rootScope,$http,$location,$anchorScroll,$window){console.log("SignupCtrl loaded"),$scope.verifyEmail=function(token){$rootScope.appConfig.recaptcha&&$window.grecaptcha.reset(),toastr.remove(),$scope.disabled=!0,$http.post("/api/user/verifyEmail",{username:$scope.formData.email,token:token}).then(function(res){$scope.formData.email=null,$scope.verifyForm.$setPristine(),$scope.disabled=!1,toastr.info("Email verification sent. Please check your email.")})["catch"](function(){$scope.formData.email=null,$scope.verifyForm.$setPristine(),$scope.disabled=!1,toastr.error("Error creating user. Please email hello@appetize.io for assistance.")})},$window.verifyEmail=$scope.verifyEmail,$window.recaptchaReset=function(){$rootScope.appConfig.recaptcha&&($scope.formError="There was an error, please try again or contact hello@appetize.io.",$scope.disabled=!1,$window.grecaptcha.reset())},$scope.validate=function(){$scope.formError=null,$scope.verifyForm.$valid&&($scope.disabled=!0,$rootScope.appConfig.recaptcha?$window.grecaptcha.execute():$scope.verifyEmail())}}]),angular.module("appetizeApp").controller("PricingCtrl",["$scope","$rootScope","$location",function($scope,$rootScope,$location){console.log("loaded"),$scope.signup=function(){if($rootScope.user&&Array.isArray($rootScope.user.roles)&&$rootScope.user.roles.indexOf("admin")>-1)$location.url("/account");else if($rootScope.user)toastr.remove(),toastr.info("Must be account admin to manage account settings");else{var el=document.getElementById("signupInput");el&&el.focus()}}}]),angular.module("appetizeApp").controller("RegisterCtrl",["$scope","$rootScope","$routeParams","$http","$location","$anchorScroll","$window","AuthService",function($scope,$rootScope,$routeParams,$http,$location,$anchorScroll,$window,AuthService){function checkToken(token){$http.get("/api/registrationToken/"+token+"/verify").then(function(response){response.data&&response.data.username?$scope.newUser=response.data:$scope.error="Invalid registration token"},function(errorResponse){console.log(errorResponse.data),$scope.error=errorResponse.data})}console.log("RegisterCtrl loaded"),checkToken($routeParams.token),$scope.register=function(newUser){$scope.formError=null,$scope.registerForm.$valid&&($scope.disabled=!0,AuthService.register(newUser).then(function(user){$scope.setCurrentUser(user),$location.url("/account")},function(response){$scope.formError=response.data,$scope.disabled=!1}))}}]),angular.module("appetizeApp").controller("InviteCtrl",["$scope","$rootScope","$routeParams","$http","$location","$anchorScroll","$window","AuthService",function($scope,$rootScope,$routeParams,$http,$location,$anchorScroll,$window,AuthService){
function checkToken(token){$http.get("/api/inviteToken/"+token+"/verify").then(function(response){return console.log(response.data),response.data.userIsRegistered&&!response.data.userIsLoggedIn?void $location.url("/login?reason=invite&next="+encodeURIComponent($location.url())):void($scope.tokenData=response.data)},function(errorResponse){$scope.error=errorResponse.data})}console.log("InviteCtrl loaded"),$scope.tokenData={},$routeParams.token?checkToken($routeParams.token):$scope.error="Invalid token provided",$scope.acceptInvite=function(){$http.post("/api/user/acceptInvite",$scope.tokenData).then(function(response){response.data.redirectUrl?window.location.href=response.data.redirectUrl:window.location.href="/success"},function(errorResponse){$scope.error=errorResponse.data})},$scope.rejectInvite=function(){$http.post("/api/user/rejectInvite",$scope.tokenData).then(function(response){$location.url("/success")},function(errorResponse){$scope.error=errorResponse.data})},$scope.register=function(newUser){$scope.formError=null,$scope.registerForm.$valid&&($scope.disabled=!0,AuthService.register(newUser).then(function(user){$scope.setCurrentUser(user),$location.url("/dashboard")},function(response){$scope.formError=response.data,$scope.disabled=!1}))}}]),angular.module("appetizeApp").controller("PrewarmCtrl",["$scope","$rootScope","$routeParams","$http",function($scope,$rootScope,$routeParams,$http){function getPrewarm(){$scope.prewarm=null,$http.get("/api/admin-prewarm").then(function(res){console.log("Got prewarm!"),$scope.prewarm=res.data})["catch"](function(err){toastr.error(err)})}console.log("PrewarmCtrl loaded"),toastr.options.timeOut=1e4,toastr.options.positionClass="toast-bottom-full-width",$scope.prewarm,$scope.filter={},$scope.formData2,$scope.searchText,getPrewarm(),$scope.newRule=function(rule){$scope.submitEditRule(rule)},$scope.editRule=function(rule){$scope.formData2=angular.copy(rule),$scope.showEditRule=!0},$scope.deleteRule=function(rule){confirm("Confirm delete rule?")&&(rule["delete"]=!0,$scope.submitEditRule(rule))},$scope.submitEditRule=function(rule){$http.post("/api/admin-prewarm",rule).then(function(res){console.log(res.data),getPrewarm()})["catch"](function(err){toastr.error(err.data||"Error editing rule"),getPrewarm()})}}]),angular.module("appetizeApp").controller("UserCtrl",["$scope","$rootScope","$http","$location","AuthService",function($scope,$rootScope,$http,$location,AuthService){function checkLogin(){return AuthService.checkLogin().then(function(user){user&&user.username?$scope.setCurrentUser(user):$rootScope.loggedIn=!1},function(){console.log("Error checking login")})}$scope.setCurrentUser=function(user){user&&($rootScope.loggedIn=!0,$rootScope.user=user)},$scope.logout=function(){$rootScope.user=null,$http.post("/api/user/logout").then(function(response){$rootScope.user=null,$rootScope.loggedIn=!1},function(errorResponse){console.log("Error logging out")})},checkLogin()}]),angular.module("appetizeApp").factory("AuthService",["$rootScope","$http",function($rootScope,$http){var authService={};return authService.login=function(credentials){return $http.post("/api/user/login",credentials).then(function(res){return $rootScope.recordEvent("user_login"),res.data})},authService.register=function(user){return $http.post("/api/user/register",user).then(function(res){return $rootScope.recordEvent("user_register"),res.data})},authService.checkLogin=function(){return $http.get("/api/user").then(function(res){return res.data})["catch"](function(error){console.log("Error checking login"),console.log(error)})},authService}]),angular.module("appetizeApp").controller("ClaimCtrl",["$scope","$rootScope","$http","$location","$routeParams","AuthService",function($scope,$rootScope,$http,$location,$routeParams,AuthService){function checkToken(token){$http.get("/api/usertoken/"+token).then(function(response){var account=response.data;account?($scope.account=account,$scope.newUser.accountId=account._id):$scope.error="Invalid token"},function(errorResponse){console.log(errorResponse),$scope.error=errorResponse.data})}$scope.newUser={},$scope.disabled=!1,$routeParams.token?($scope.newUser.token=$routeParams.token,checkToken($scope.newUser.token)):$scope.error="You must have a token to register an account",$scope.register=function(newUser){$scope.formError=null,newUser.accountId=$scope.account._id,console.log(newUser),$scope.registerForm.$valid&&($scope.disabled=!0,AuthService.register(newUser).then(function(user){$scope.setCurrentUser(user),$location.url("/")},function(response){$scope.formError=response.data,$scope.disabled=!1}))}}]),angular.module("appetizeApp").controller("ResetCtrl",["$scope","$rootScope","$routeParams","$location","$http",function($scope,$rootScope,$routeParams,$location,$http){function checkToken(token){$http.get("/api/passwordToken/"+token+"/verify").then(function(response){$scope.changeFormData=response.data},function(errorResponse){console.log(errorResponse.data),$scope.error.page=errorResponse.data})}$scope.error={},$scope.disabled={},$scope.changeFormData={},$scope.resetForm={},$routeParams.token?($scope.token=$routeParams.token,checkToken($scope.token)):$scope.noToken=!0,$scope.reset=function(formData){$scope.error.resetForm=null,$scope.disabled.resetForm=!0,$http.post("/api/user/emailPasswordReset",{username:formData.email}).then(function(response){$scope.disabled.resetForm=!1,$location.path("/success")},function(errorResponse){$scope.disabled.resetForm=!1,$scope.error.resetForm=errorResponse.data})},$scope.change=function(changeFormData){return $scope.error.changeForm=null,changeFormData.password!==changeFormData.confirmPassword?void($scope.error.changeForm="Passwords must match"):($scope.disabled.changeForm=!0,void $http.post("/api/user/changePassword",changeFormData).then(function(response){$scope.disabled.changeForm=!1,window.location.href="/success"},function(errorResponse){$scope.disabled.changeForm=!1,$scope.error.changeForm=errorResponse.data}))}}]),angular.module("appetizeApp").directive("match",function(){return{restrict:"A",require:"ngModel",link:function(scope,element,attrs,ctrl){function matchValidator(value){return scope.$watch(attrs.match,function(newValue,oldValue){var isValid=value===scope.$eval(attrs.match);ctrl.$setValidity("match",isValid)}),value}ctrl.$parsers.push(matchValidator)}}}),angular.module("appetizeApp").controller("DashboardCtrl",["$scope","$rootScope","$q","$http",function($scope,$rootScope,$q,$http){function getApps(){var deferred=$q.defer();return $http.post("/api/account/getApps",{filter:$scope.filter,search:$scope.search,sort:$scope.sort,lastItem:$scope.lastItem}).then(function(res){res&&res.data?deferred.resolve(res.data):deferred.reject()}),deferred.promise}function getAppGroups(){$http.get("/api/account/getAppGroups").then(function(res){res&&res.data?$scope.appGroups=res.data:toastr.error("Error getting app groups")})}function getUserStandalonePublicKey(){$http.get("/api/user/getStandalonePublicKey").then(function(res){res.data&&res.data.publicKey&&($scope.standalonePublicKey=res.data.publicKey)})}function countApps(){$http.post("/api/account/countApps",{filter:$scope.filter,search:$scope.search}).then(function(res){res&&res.data&&($scope.count=res.data.count)})}console.log("DashboardCtrl loaded"),$rootScope.user&&(toastr.options.timeOut=1e4,toastr.options.positionClass="toast-bottom-full-width",$scope.apps,$scope.appGroups,$scope.disabled={},$scope.filter={},$scope.filter.disabled={$ne:!0},$scope.search,$scope.sort={},$scope.lastItem,getApps().then(function(apps){$scope.apps=apps,$scope.lastItem=apps[apps.length-1]}),countApps(),getAppGroups(),getUserStandalonePublicKey(),$scope.updateParamsForApps=function(){$scope.lastItem=null,getApps().then(function(apps){$scope.apps=apps,$scope.lastItem=apps[apps.length-1]}),countApps()},$scope.setDisabled=function(value){angular.equals($scope.filter.disabled,value)?delete $scope.filter.disabled:$scope.filter.disabled=value,$scope.updateParamsForApps()},$scope.setPlatform=function(value){$scope.filter.platform==value?delete $scope.filter.platform:$scope.filter.platform=value,$scope.updateParamsForApps()},$scope.loadMore=function(){getApps().then(function(apps){apps.forEach(function(app){$scope.apps.push(app)}),$scope.lastItem=apps[apps.length-1]})},$scope.disable=function(app,disabled,index){if(!$scope.disabled.disable){$scope.disabled.disable=!0;var postData={};postData.disabled=disabled,$http.post("/api/app/"+app.privateKey+"/update",postData).then(function(response){$scope.apps[index]=response.data,$scope.disabled.disable=!1},function(errorResponse){console.log(errorResponse),alert("Error updating app, please try again or contact hello@appetize.io."),$scope.disabled.disable=!1})}},$scope.deleteApp=function(app,index){if(!$scope.disabled["delete"]){$scope.disabled["delete"]=!0;var postData={};postData.deleted=!0,$http.post("/api/app/"+app.privateKey+"/update",postData).then(function(response){$scope.apps.splice(index,1),$scope.count--,$scope.countTotal--,getAppGroups(),$scope.disabled["delete"]=!1},function(errorResponse){console.log(errorResponse),alert("Error updating app, please try again or contact hello@appetize.io."),$scope.disabled["delete"]=!1})}},$scope.updateFieldForApp=function(app,field,index){if(!$scope.disabled[field]){$scope.disabled[field]=!0;var postData={};postData[field]=app[field]||null,$http.post("/api/app/"+app.privateKey+"/update",postData).then(function(response){$scope.apps[index]=response.data,$scope.disabled[field]=!1},function(errorResponse){console.log(errorResponse),alert("Error updating app, please try again or contact hello@appetize.io."),$scope.disabled[field]=!1})}},$scope.createAppGroup=function(){toastr.remove(),$http.post("/api/appGroup/create").then(function(res){toastr.info("App group created"),getAppGroups()})["catch"](function(){getAppGroups(),toastr.error("Error creating app group")})},$scope.deleteAppGroup=function(appGroup){toastr.remove(),$http.post("api/appGroup/delete",{publicKey:appGroup.publicKey}).then(function(res){toastr.info("App group deleted"),getAppGroups()})["catch"](function(){getAppGroups(),toastr.error("Error deleting app group")})},$scope.updateFieldForAppGroup=function(appGroup,field){if(toastr.remove(),"apps"===field){if(appGroup.apps.length>10)return toastr.error("App group may not contain more than 10 apps, please delete one and try again"),void getAppGroups();for(var i=0;i<appGroup.apps.length;i++)if(!appGroup.apps[i])return toastr.warning("Invalid publicKey detected, please try again"),void getAppGroups()}if(!$scope.disabled[field]){$scope.disabled[field]=!0;var postData={};postData[field]=appGroup[field]||null,postData.publicKey=appGroup.publicKey,$http.post("/api/appGroup/update",postData).then(function(response){getAppGroups(),$scope.disabled[field]=!1},function(errorResponse){getAppGroups(),toastr.error(errorResponse.data),$scope.disabled[field]=!1})}})}]),angular.module("appetizeApp").controller("AccountCtrl",["$scope","$rootScope","$http","$location","$anchorScroll","$window","AuthService","appConstants",function($scope,$rootScope,$http,$location,$anchorScroll,$window,AuthService,appConstants){function getAccount(){$http.get("/api/account").then(function(res){$scope.account=res.data,$scope.billingEmails=angular.copy($scope.account.billingEmails),appConstants&&appConstants.plans&&$scope.account.plan&&($scope.planCharge=$scope.account.planCharge||appConstants.plans[$scope.account.plan]),$scope.account.team&&$scope.account.team.forEach(function(member){member.isAdmin=member.roles.indexOf("admin")>-1,member.isDeveloper=member.roles.indexOf("developer")>-1}),$scope.formAddress={legalName:$scope.account.legalName||$scope.account.name,addressLine1:$scope.account.addressLine1,addressLine2:$scope.account.addressLine2,addressLine3:$scope.account.addressLine3,addressLine4:$scope.account.addressLine4},countTotalApps()})}function countTotalApps(){$http.post("/api/account/countApps").then(function(res){res.data&&($scope.countTotal=res.data.count)})}function getUsage(){$http.get("/api/account/usage/mtd").then(function(res){$scope.usage=res.data})}function getUser(){AuthService.checkLogin().then(function(user){user&&user.username&&($rootScope.user=user)},function(err){toastr.error(err)})}function getUpdateHandler(){var updateHandler=StripeCheckout.configure({key:"pk_live_rJPDFK5LNQN9B5m0aGRLs8MB",image:"/images/logo1_colored_background_padded_extra.png",locale:"auto",token:function(token){$scope.disabled.billing=!0,$http.post("/api/account/setStripePayment",{token:token.id}).then(function(res){toastr.info("Card successfully updated"),getAccount(),$scope.disabled.billing=!1})["catch"](function(err){toastr.error(err.data),$scope.disabled.billing=!1})}});return updateHandler}function getSignupHandler(plan,description,isAnnual){var signupHandler=StripeCheckout.configure({key:"pk_live_rJPDFK5LNQN9B5m0aGRLs8MB",image:"/images/logo1_colored_background_padded_extra.png",locale:"auto",token:function(token){$scope.disabled.billing=!0,$http.post("/api/account/selectPlan",{token:token.id,plan:plan,description:description,isAnnual:isAnnual}).then(function(res){toastr.info("Success!"),getAccount(),$scope.disabled.billing=!1,$rootScope.recordTransaction({accountId:$scope.account.id,plan:plan,cost:$scope.plans[plan]})})["catch"](function(err){toastr.error(err.data),$scope.disabled.billing=!1})}});return signupHandler}if(console.log("AccountCtrl loaded"),$rootScope.user){if($scope.messages={},$scope.account,$scope.billingEmails,$scope.pageConfig={},$scope.disabled={},$scope.error={},$scope.plans=appConstants.plans,getAccount(),getUsage(),$scope.setRoles=function(username,isDeveloper,isAdmin){var postData={username:username,isDeveloper:isDeveloper,isAdmin:isAdmin};$scope.disabled.setRoles||($scope.disabled.setRoles=!0,toastr.remove(),$http.post("/api/account/roles",postData).then(function(res){toastr.info("Account roles updated"),getAccount(),$scope.disabled.setRoles=!1})["catch"](function(result){toastr.error(result.data||"Error updating account roles"),getAccount(),$scope.disabled.setRoles=!1}))},$scope.deleteAccount=function(){toastr.remove(),$scope.disabled.deleteAccount||0!=$scope.countTotal||1!=$scope.account.team.length||$scope.account.plan||confirm("This action will permanently delete your account from Appetize. This action is final, and cannot be undone. Do you wish to continue?")&&confirm("This action is final, and cannot be undone. Please confirm you would like to delete your account?")&&($scope.disabled.deleteAccount=!0,$http.post("/api/account/deleteAccount").then(function(res){$scope.disabled.deleteAccount=!1,window.location.href="/success"})["catch"](function(err){err.data?toastr.error(err.data):toastr.error("Error deleting. Please email hello@appetize.io for assistance."),$scope.disabled.deleteAccount=!1}))},$scope.deleteUser=function(member){toastr.remove(),$scope.disabled.deleteUser||confirm("This action will permanently delete this user from Appetize, and assign all apps uploaded by this user to original account creator. This action is final, and cannot be undone. Do you wish to continue?")&&confirm("This action is final, and cannot be undone. Please confirm you would like to delete this user?")&&($scope.disabled.deleteUser=!0,$http.post("/api/account/deleteUser",member).then(function(res){toastr.info("User has been deleted."),$scope.disabled.deleteUser=!1,getAccount()})["catch"](function(result){toastr.error(result.data||"Error deleting. Please email hello@appetize.io for assistance."),$scope.disabled.deleteUser=!1}))},$scope.updateAddress=function(formAddress){toastr.remove(),$http.post("/api/account",formAddress).then(function(res){toastr.info("Billing address updated"),getAccount()})["catch"](function(){toastr.error("Error updating billing address")})},$scope.updateAccountName=function(name){toastr.remove(),$http.post("/api/account",{name:name}).then(function(res){toastr.info("Account name updated"),$scope.showEditName=!1,$scope.accountNameUpdate=null,getAccount()})["catch"](function(){toastr.error("Error updating account name")})},$scope.updateAccount=function(field,value){if($scope.disabled[field]=!0,toastr.remove(),"timeout"===field||"authenticated"!==value||confirm("Restrict this action to signed in users only?")){var fieldsToUpdate={};fieldsToUpdate[field]=value,$http.post("/api/account",fieldsToUpdate).then(function(res){toastr.info("Account updated"),getAccount(),$scope.disabled[field]=!1})["catch"](function(){toastr.error("Error updating account"),$scope.disabled[field]=!1})}},!$rootScope.isOnprem){$scope.setAlert=function(formData){return toastr.remove(),$scope.alertForm.$valid||"object"!=typeof formData?void $http.post("/api/user",{billingAlertLevel:formData&&formData.amount?formData.amount:null}).then(function(res){formData&&(formData.amount=null),$scope.alertForm.$setPristine(),toastr.info("Alert saved"),getUser()})["catch"](function(){toastr.error("Error setting alert")}):void toastr.error("Invalid alert value")},$scope.updateBillingEmails=function(billingEmails){return"object"!=typeof billingEmails?void toastr.error("Invalid value"):(toastr.remove(),void $http.post("/api/account",{billingEmails:billingEmails}).then(function(res){toastr.info("Billing emails updated"),$scope.newBillingEmail&&($scope.newBillingEmail=null),$scope.billingForm.$setPristine(),getAccount()})["catch"](function(){toastr.error("Error updating billing emails")}))},$scope.cancelPlan=function(){toastr.remove(),$scope.disabled.billing||confirm("This will remove your card and cancel your plan immediately. Any extra minutes charge for this billing period will be billed upon account cancellation. Your plan will not renew, and you will not be billed again. Do you wish to continue?")&&confirm("Please confirm you would like to cancel your plan?")&&($scope.disabled.billing=!0,$http.post("/api/account/cancelPlan",{}).then(function(res){toastr.info("Plan has been cancelled. We would be happy to serve you again as a customer if your needs change in the future."),$scope.disabled.billing=!1,getAccount()})["catch"](function(){toastr.error("Error cancelling plan. Please email hello@appetize.io for assistance."),$scope.disabled.billing=!1}))};var signupHandler,updateHandler;$scope.signup=function(plan,description,isAnnual){toastr.remove(),!$scope.disabled.billing&&StripeCheckout&&(signupHandler=getSignupHandler(plan,description,isAnnual),signupHandler.open({name:"Appetize.io LLC",allowRememberMe:!1,zipCode:!0,description:description,panelLabel:"Select Plan",billingAddress:!0,email:$rootScope.user.username}))},$scope.updateCard=function(){toastr.remove(),!$scope.disabled.billing&&StripeCheckout&&(updateHandler=getUpdateHandler(),updateHandler.open({name:"Appetize.io LLC",allowRememberMe:!1,zipCode:!0,panelLabel:"Update Card",email:$rootScope.user.username}))},$(window).on("popstate",function(){signupHandler&&signupHandler.close(),updateHandler&&updateHandler.close()})}$scope.invite=function(formData){$scope.inviteForm.$valid&&(toastr.remove(),$http.post("/api/user/inviteUser",{email:formData.email}).then(function(res){formData.email=null,$scope.inviteForm.$setPristine(),toastr.info("Invite sent")})["catch"](function(result){formData.email=null,$scope.inviteForm.$setPristine(),toastr.error(result.data||"Error inviting user")}))},$scope.resetPassword=function(){toastr.remove(),$http.post("/api/user/emailPasswordReset",{username:$rootScope.user.username}).then(function(res){toastr.info("Reset email sent. Please check your email.")})["catch"](function(result){toastr.error(result.data||"Error sending reset email")})},$scope.downloadUsage=function(){$window.location.href="/api/app/all/usageReport"},$scope.securityEvents=function(){$window.location.href="/api/account/securityEvents"};var today=new Date;$scope.dailyUsageMonthMax=today,$scope.dailyUsageMonthMin=new Date($rootScope.user.created),$scope.downloadDailyUsage=function(month){$window.location.href="/api/app/all/dailyUsageReport?month="+month.getFullYear()+"-"+(month.getMonth()+1)},$scope.downloadSessionLogs=function(month){$window.location.href="/api/app/all/sessionLogs?month="+month.getFullYear()+"-"+(month.getMonth()+1)},$scope.downloadInvoice=function(invoiceId,fileId,filename){$window.location.href="/api/account/invoice?invoiceId="+invoiceId+"&fileId="+fileId+"&filename="+filename},$scope.token=function(){$scope.error.token=null,$scope.error.tokenMessage=null,$scope.apiForm.$valid&&!$scope.success&&$http.post("/api/apiToken/create",$scope.formData).then(function(response){$scope.success=!0,$rootScope.recordEvent("api_token_created"+$scope.device)},function(errorResponse){$scope.error.token=!0,403===errorResponse.status&&($scope.error.tokenMessage="Error generating token. User specified is a non-developer member of an existing account, or API access is disabled for this account.")})}}}]),angular.module("appetizeApp").controller("PayerCodeCtrl",["$scope","$rootScope","$http",function($scope,$rootScope,$http){function getAccount(){$http.get("/api/account").then(function(res){$scope.account=res.data,$scope.payerCode=res.data.payerCode})}console.log("PayerCodeCtrl loaded"),$scope.payerCode,$scope.account,toastr.options.timeOut=1e4,toastr.options.positionClass="toast-bottom-full-width",$scope.requestPayerCode=function(){toastr.remove(),$http.get("/api/account/payerCode",{}).then(function(res){res.data&&res.data.payerCode&&($scope.payerCode=res.data.payerCode)})["catch"](function(error){console.log(error.status),400===error.status&&toastr.error("Payer codes are only enabled for active paying accounts.")})},getAccount()}]),angular.module("appetizeApp").controller("LaunchCtrl",["$scope","$rootScope","$q","$http","$location","$sce","$window",function($scope,$rootScope,$q,$http,$location,$sce,$window){function getLaunchPageConfig(){$http.get("/api/launch-page").then(function(res){console.log("Got launch page!"),$scope.launchPageConfig=res.data,console.log($scope.launchPageConfig),$scope.selectApp(0),$scope.launchPageConfig.options.showList&&showList()})["catch"](function(err){console.log(err),toastr.error(err.data||"Error loading launch page")})}function showList(){getApps().then(function(apps){$scope.appList=apps;try{$scope.selectedAppInfo=$scope.appList.filter(function(element){return element.publicKey==$scope.selectedApp[$scope.platform].publicKey})[0]}catch(e){console.log(e)}})["catch"](function(err){console.log("Error getting app list"),console.log(err)})}function getApps(){var deferred=$q.defer();return $http.post("/api/account/getApps",{filter:void 0,search:void 0,sort:void 0,lastItem:void 0,limit:1e3}).then(function(res){res&&res.data?deferred.resolve(res.data):deferred.reject()}),deferred.promise}function updateFrameHeight(){iframe||(iframe=document.querySelector("iframe")),iframe&&iframe.contentWindow&&iframe.contentWindow.document&&iframe.contentWindow.document.body&&iframe.contentWindow.document.getElementById("devicesContainer")&&iframeHeight!==iframe.contentWindow.document.getElementById("devicesContainer").offsetHeight+50&&(iframeHeight=iframe.contentWindow.document.getElementById("devicesContainer").offsetHeight+50,iframe.height=iframeHeight)}function setDevice(){var matchDevice;if($scope.theDevice){var name=$scope.theDevice.name;$scope.selectedApp[$scope.platform].devices.forEach(function(device){device.name===name&&(matchDevice=device)})}$scope.theDevice=matchDevice||$scope.selectedApp[$scope.platform].devices[0]}function setLanguage(){var matchLanguage;if($scope.theLanguage){var name=$scope.theLanguage.name;$scope.selectedApp[$scope.platform].languages.forEach(function(language){language.name===name&&(matchLanguage=language)})}$scope.theLanguage=matchLanguage||$scope.selectedApp[$scope.platform].languages[0]}console.log("LaunchCtrl loaded"),toastr.options.timeOut=1e4,toastr.options.positionClass="toast-top-full-width",$scope.filter={},$scope.trustSrc=function(src){return $sce.trustAsResourceUrl(src)},$scope.sessionActive,$scope.launchPageConfig,getLaunchPageConfig(),$scope.$watch("scale",function(newValue,oldValue){if(newValue!==oldValue&&document&&document.querySelector("iframe")&&document.querySelector("iframe").contentWindow){var iframe=document.querySelector("iframe");iframe.contentWindow.postMessage({type:"setScale",value:100*newValue},"*")}},!1);var iframe,iframeHeight=0;setInterval(updateFrameHeight,50),$scope.updateField=function(field,newValue){$scope[field]!==newValue&&(!$scope.sessionActive||confirm("This will restart your session. Do you want to continue?"))&&($scope[field]=newValue,"platform"===field&&(setDevice(),setLanguage()),$scope.sessionActive=!1)},$scope.selectApp=function(index){index>=$scope.launchPageConfig.apps.length||$scope.selectedAppIndex!==index&&(!$scope.sessionActive||confirm("This will restart your session. Do you want to continue?"))&&($scope.selectedAppIndex=index,$scope.selectedApp=$scope.launchPageConfig.apps[index],$scope.platform=Object.keys($scope.selectedApp)[0],setDevice(),setLanguage(),$scope.sessionActive=!1)},$scope.endSession=function(){if((!$scope.sessionActive||confirm("This will restart your session. Do you want to continue?"))&&document&&document.querySelector("iframe")&&document.querySelector("iframe").contentWindow){var iframe=document.querySelector("iframe");iframe.contentWindow.postMessage("endSession","*")}};var messageEventHandler=function(event){"appLaunch"==event.data?($scope.sessionActive=!0,$rootScope.$apply(function(){})):"sessionEnded"==event.data&&($scope.sessionActive=!1,$rootScope.$apply(function(){}))};$window.addEventListener("message",messageEventHandler,!1)}]),angular.module("appetizeApp").controller("LibraryCtrl",["$scope","$rootScope","$q","$http",function($scope,$rootScope,$q,$http){function getApps(){var deferred=$q.defer();return $http.post("/api/account/getApps",{filter:{},search:{},sort:{},lastItem:{},limit:1e3}).then(function(res){res&&res.data?deferred.resolve(res.data):deferred.resolve()}),deferred.promise}function getUser(){var deferred=$q.defer();return $http.get("/api/user").then(function(response){var user=response.data;user&&user.username?deferred.resolve(user):deferred.resolve()}),deferred.promise}function getLibraryConfig(){var deferred=$q.defer();return $http.get("/api/account/library").then(function(response){response.data?deferred.resolve(response.data):deferred.resolve()}),deferred.promise}function start(){var user,libraryConfig,targetOrigin;return getUser().then(function(data){user=data}).then(getLibraryConfig).then(function(data){libraryConfig=data,targetOrigin=libraryConfig?libraryConfig.targetOrigin:void 0}).then(function(){function allowedTargetOrigin(origin){if(targetOrigin){if(targetOrigin===origin)return!0;window.parent.postMessage({type:"error",data:"Parent window origin: "+origin+" not allowed to receive postMessage, please email hello@appetize.io"},"*")}else window.parent.postMessage({type:"error",data:"No targetOrigin configured for account, please email hello@appetize.io"},"*")}var messageEventHandler=function(event){if("getUser"==event.data){if(!user)return console.log("User is not logged in"),void window.parent.postMessage({type:"user"},"*");allowedTargetOrigin(event.origin)&&window.parent.postMessage({type:"user",data:user},targetOrigin)}else if("getApps"==event.data){if(!user)return console.log("User must be logged in to get apps"),void window.parent.postMessage({type:"apps"},"*");if(allowedTargetOrigin(event.origin))return getApps().then(function(data){window.parent.postMessage({type:"apps",data:data},targetOrigin)})}else"getLoginUrl"==event.data?$rootScope.isOnprem&&$rootScope.isOnprem.defaultAuthUrl?window.parent.postMessage({type:"loginUrl",data:$rootScope.appConfig.baseUrl+$rootScope.isOnprem.defaultAuthUrl},"*"):window.parent.postMessage({type:"loginUrl",data:window.location.origin+"/login"},"*"):"getIsLoaded"==event.data&&window.parent.postMessage({type:"isLoaded"},"*")};window.addEventListener("message",messageEventHandler,!1)})}console.log("LibraryCtrl loaded"),start()}]),angular.module("appetizeApp").factory("Device",["$location","$rootScope","$routeParams","$http","$upload","$document","$window","$timeout","$interval","appConstants",function Device($location,$rootScope,$routeParams,$http,$upload,$document,$window,$timeout,$interval,appConstants){var Device=function(device){function journeyPlaybackSequence(journey,step,waitTime){$timeout(function(){"true"==$routeParams.xdocMsg&&(window.parent.postMessage({type:"journeyPlaybackStep",value:step},"*"),window.parent.postMessage({type:"journeyPlaybackProgress",value:step/journey.length},"*")),journey&&journey[step]&&$rootScope.devices[0].appetizer&&($rootScope.devices[0].appetizer.emit("userInteraction",journey[step]),journey[step+1]?(waitTime=journey[step+1].timeStamp-journey[step].timeStamp,journeyPlaybackSequence(journey,step+1,waitTime)):("true"==$routeParams.xdocMsg&&window.parent.postMessage("journeyPlaybackComplete","*"),$rootScope.devices[0].journeyPlayback=null))},waitTime)}function updateLocationSearch(field,value){$rootScope.isHomepage||$location.search(field,value)}var isSimulating=!1;this.initialize=function(device){var self=this;angular.extend(self,device),this.canvasId=Date.now(),this.debugConsole=["Log messages will follow once session has started...\n"],this.debugConsoleVisible=this.debugConsole[0],this.interactionHistory=[],this.interactionHistorySimple=[],this.selectedRequestId,this.networkLog={},this.networkLogSimple={},this.chromeDevToolsUrl=null,this.disableSessionStart,this.requestSessionOnConnect=!1,this.requestSessionConnectTimeout=null,window.isCrawler?console.log("Crawler detected, do not initialize websocket connection"):(this.clientController=new AppSocket("/client"),this.clientController.on("disconnect",function(){self.clientControllerConnected=null,!self.queue&&!self.accountQueue||self.connection||(self.cleanConnections(),toastr.remove(),toastr.info("Server lost connection, please try again"),$rootScope.$$phase||$rootScope.$apply(function(){}))}),this.clientController.on("queue",function(data){self.queue||"true"!=$routeParams.xdocMsg||window.parent.postMessage("sessionQueued","*"),self.queue||(self.accountQueue=!1,toastr.remove(),toastr.info("All devices are currently in use. Please wait until requested device becomes available.")),self.queue=data.position,"true"==$routeParams.xdocMsg&&window.parent.postMessage({type:"sessionQueuedPosition",position:data.position},"*"),$rootScope.$apply(function(){})}),this.clientController.on("accountQueue",function(data){self.accountQueue||"true"!=$routeParams.xdocMsg||window.parent.postMessage("accountQueued","*"),self.accountQueue||(toastr.remove(),toastr.info("All slots for this account are currently in use. Please wait until a slot becomes available.")),self.accountQueue=data.position,"true"==$routeParams.xdocMsg&&window.parent.postMessage({type:"accountQueuedPosition",position:data.position},"*"),$rootScope.$apply(function(){})}),this.clientController.on("connect",function(data){console.log("clientController connected"),self.clientControllerConnected=!0,self.autoplay&&self.deviceUpdated&&($rootScope.app.programmaticPlay?self.requestSession():toastr.warning("Autoplay is not supported under the Trial plan. Please try again!")),self.requestSessionOnConnect&&(clearTimeout(self.requestSessionConnectTimeout),self.requestSessionConnectTimeout=null,self.requestSession())}),this.clientController.on("newSession",function(data){self.connect(data)}),this.clientController.on("userError",function(data){$rootScope.recordEvent("user_error_on_clientController"),"true"==$routeParams.xdocMsg&&(window.parent.postMessage("userError","*"),window.parent.postMessage({type:"userErrorMessage",message:data.message},"*")),data.message&&toastr.error(data.message)}))},this.requestIdSelected=function(requestId){this.selectedRequestId===requestId?this.selectedRequestId=null:this.selectedRequestId=requestId},this.connectWatch=function(connectionString,connectionToken){this.appetizer&&this.appetizer.emit("connectWearToPhone",{
connectionString:connectionString,connectionToken:connectionToken})},this.setVolume=function(volume){console.log("Setting volume to: "+(volume||this.volume)),document.getElementsByClassName("audio-player")[0].volume=volume||this.volume},this.screenshot=function(){if(this.appetizer||console.log("Must have active session to get screenshot"),this.getScreenshotEnabled)console.log("High Res Screenshot requested"),this.screenshotRequested=!0,this.appetizer.emit("getScreenshot");else{var file=new Blob([lastFrame],{type:"image/jpeg"});saveAs(file,getFormattedDate()+" Screenshot.jpg")}},this.addMedia=function($files){toastr.remove();var self=this,file=$files[0];if(file){if(file.size>52428800)return void toastr.error("Your proposed upload exceeds the maximum allowed size of 50MB");if(!this.connectionString||!this.connectionToken)return void toastr.error("Streaming must be active before adding media!");this.addMediaDisabled=!0,this.fileUploadProgress=0;var url=this.connectionString+"/session/"+this.connectionToken+"/addMedia";console.log("Uploading "+file.name+" to "+url),this.fileUpload=$upload.http({url:url,headers:{"X-Appetize-File-Name":file.name,"Content-Type":file.type},data:file}),this.fileUpload.then(function(response){self.fileUploadProgress=!1,201===response.status?toastr.info("Media sent to device! Check Photo Library!"):toastr.error("Error adding media! Please try again or email support!"),self.addMediaDisabled=!1,$rootScope.$$phase||$rootScope.$apply(function(){})},function(failure){toastr.error("Error adding media! Please try again or email support!"),self.addMediaDisabled=!1,$rootScope.$$phase||$rootScope.$apply(function(){})},function(evt){self.fileUploadProgress=parseInt(100*evt.loaded/evt.total),console.log("Uploading file, progress is: "+self.fileUploadProgress)})}},this.xdocScreenshot=function(){if(this.getScreenshotEnabled)console.log("High Res Screenshot requested"),this.xdocScreenshotRequested=!0,this.appetizer.emit("getScreenshot");else{var uint8Arr=new Uint8Array(lastFrame),str=uint8ArrayToString(uint8Arr),base64String=btoa(str),data="data:image/jpeg;base64,"+base64String;window&&window.parent&&window.parent.postMessage({type:"screenshot",data:data},"*")}},this.emitHomeButton=function(){this.appetizer&&this.appLaunch&&this.emitUserInteraction({type:"keypress",which:null,shiftKey:null,key:"home",timeStamp:Date.now()})},this.playEvent=function(event){this.appetizer&&(this.appLaunch||this.physical)&&this.appetizer.emit("playEvent",event)},this.heartbeat=function(){this.appetizer&&(this.appLaunch||this.physical)&&this.appetizer.emit("userInteraction",{type:"heartbeat"})};var lastTranslateX=0,lastTranslateY=0;this.setRotation=function(degrees){var change=(degrees-this.rotation)%360;if(0!=change){var canvas=document.getElementById(this.canvasId);if(canvas){var ctx=canvas.getContext("2d");if(ctx){ctx.translate(-1*lastTranslateX,-1*lastTranslateY),ctx.rotate(-this.rotation*Math.PI/180),ctx.rotate(degrees*Math.PI/180);var translateX=0,translateY=0;0==degrees||(90==degrees?translateY=-1*appConstants.screenDimensions[this.name].height:180==degrees?(translateX=-1*appConstants.screenDimensions[this.name].width,translateY=-1*appConstants.screenDimensions[this.name].height):270==degrees&&(translateX=-1*appConstants.screenDimensions[this.name].width)),ctx.translate(translateX,translateY),lastTranslateX=translateX,lastTranslateY=translateY,degrees%180==0?this.orientation="portrait":this.orientation="landscape",this.rotation=degrees,this.updateScaledWidthsAndHeights();var uint8Arr=new Uint8Array(lastFrame),str=uint8ArrayToString(uint8Arr),base64String=btoa(str),img=new Image;img.onload=function(){var x=0,y=0;ctx.clearRect(0,0,2e3,2e3),ctx.drawImage(this,x,y,self.canvasInnerContainerWidth,self.canvasInnerContainerHeight)},img.src="data:image/jpeg;base64,"+base64String}}}},this.pasteText=function(e){if(!this.emitUserInteractionDisabled){var stringToPaste=e.originalEvent.clipboardData.getData("text");this.pasteTextString(stringToPaste)}},this.pasteTextString=function(stringToPaste){if(this.appetizer&&"string"==typeof stringToPaste&&0!=stringToPaste.length){for(var shiftKeyArray=[],keyArray=[],i=0;i<stringToPaste.length;i++){var rawKey=$rootScope.convertCharToRawKey(stringToPaste[i]);shiftKeyArray.push(rawKey.shiftKey),keyArray.push(rawKey.key)}this.emitUserInteraction({type:"keypressArray",shiftKeyArray:shiftKeyArray,keyArray:keyArray,value:stringToPaste,timeStamp:Date.now()})}};var lastInteractionSimple=null;this.emitUserInteraction=function(object){if(this.appetizer&&!this.journeyPlayback&&!this.emitUserInteractionDisabled)if(this.timeoutWarning)this.heartbeat();else{if(this.physical&&0!=this.rotation&&object.xPos&&object.yPos){var coordinateRotation=360-this.rotation,x=object.xPos,y=object.yPos;object.xPos=x*Math.cos(coordinateRotation*Math.PI/180)-y*Math.sin(coordinateRotation*Math.PI/180),object.yPos=x*Math.sin(coordinateRotation*Math.PI/180)+y*Math.cos(coordinateRotation*Math.PI/180),90==this.rotation?object.yPos+=appConstants.screenDimensions[this.name].height:180==this.rotation?(object.xPos+=appConstants.screenDimensions[this.name].width,object.yPos+=appConstants.screenDimensions[this.name].height):270==this.rotation&&(object.xPos+=appConstants.screenDimensions[this.name].width)}this.appetizer.emit("userInteraction",object),this.broadcastInteractions&&(this.addInteractionToHistory(object),"true"==$routeParams.xdocMsg&&(window.parent.postMessage({type:"interactionEvent",data:this.interactionHistory[this.interactionHistory.length-1]},"*"),window.parent.postMessage({type:"interactionEventSimple",data:this.interactionHistorySimple[this.interactionHistorySimple.length-1]},"*")),$rootScope.$$phase||$rootScope.$apply(function(){}))}},this.downloadHAR=function(){var harFormat={log:{version:"1.2",creator:{name:"Appetize.io Interceptor Proxy",version:"1.0"},entries:[]}};for(var key in this.networkLog)this.networkLog[key].response&&harFormat.log.entries.push(this.networkLog[key]);var file=new Blob([JSON.stringify(harFormat,!1,2)],{type:"application/text"});saveAs(file,getFormattedDate()+" network log.har")},this.downloadDebugLog=function(){for(var formatted="",i=0;i<this.debugConsole.length;i++)formatted+=this.debugConsole[i]+"\n";var file=new Blob([formatted],{type:"application/text"});saveAs(file,getFormattedDate()+" debug log.txt")};var updateDebugConsoleQueued;this.updateDebugConsoleVisible=function(){var self=this;updateDebugConsoleQueued||(updateDebugConsoleQueued=!0,setTimeout(function(){self.debugConsoleVisible=self.debugConsole.slice(-5e3).join(""),updateDebugConsoleQueued=!1},500))};var rotationChange=0;this.rotateLeft=function(){return this.noVideo?(toastr.remove(),void toastr.warning("Rotation not supported when noVideo=true")):void(this.rotateDisabled||(this.appLaunch?(this.rotateDisabled="disabled",this.appetizer&&this.appLaunch&&this.emitUserInteraction({type:"keypress",which:null,shiftKey:null,key:"rotateLeft",timeStamp:Date.now()}),rotationChange+=270,rotationChange%=360):(this.rotation+=270,this.rotation%=360,this.rotation%180==90?this.orientation="landscape":this.orientation="portrait"),this.updateScaledWidthsAndHeights()))},this.rotateRight=function(){return this.noVideo?(toastr.remove(),void toastr.warning("Rotation not supported when noVideo=true")):void(this.rotateDisabled||(this.appLaunch?(this.rotateDisabled="disabled",this.appetizer&&this.appLaunch&&this.emitUserInteraction({type:"keypress",which:null,shiftKey:null,key:"rotateRight",timeStamp:Date.now()}),rotationChange+=90,rotationChange%=360):(this.rotation+=90,this.rotation%=360,this.rotation%180==90?this.orientation="landscape":this.orientation="portrait"),this.updateScaledWidthsAndHeights()))},this.cleanConnections=function(){isSimulating=!1;for(var i=0;i<$rootScope.devices.length;i++)$rootScope.devices[i].cleanConnection()},this.destroy=function(){this.cleanConnection(),this.clientController&&this.clientController.disconnect()};var lastFrameSavedFlag=!1;this.cleanConnection=function(){if($rootScope.app&&$rootScope.app.useLastFrame&&!lastFrameSavedFlag&&this.appLaunch){$rootScope.app.lastFrame||($rootScope.app.lastFrame={});var uint8Arr=new Uint8Array(lastFrame),str=uint8ArrayToString(uint8Arr),base64String=btoa(str),data="data:image/jpeg;base64,"+base64String;$rootScope.app.lastFrame[this.name]=data,lastFrameSavedFlag=!0}this.appetizer&&(this.appetizer.disconnect(),"true"==$routeParams.xdocMsg&&window.parent.postMessage("sessionEnded","*")),this.clientController&&this.clientController.emit("removeFromQueue",{timestamp:Date.now()}),this.firstFrameReceived=!1,this.appLaunch=!1,this.queue=!1,this.accountQueue=!1,this.connection=!1,this.requestSessionConnectTimeout&&(clearTimeout(this.requestSessionConnectTimeout),this.requestSessionConnectTimeout=null),this.appetizer=null,this.adbConnectionInfo=null,this.loadingStatus=null,this.deviceUpdated=null,lastFrameSavedFlag=!1,this.preReadyBuffer=null,this.preReadyAudioBuffer=null,this.video&&this.video.removeEventListener("timeupdate",this.onTimeUpdate),this.audio&&this.audio.removeEventListener("timeupdate",this.onTimeUpdateAudio),this.video=void 0,this.audio=void 0,this.jmuxer&&this.jmuxer.destroy(),this.audioJmuxer&&this.audioJmuxer.destroy(),this.jmuxer=void 0,this.audioJmuxer=void 0,this.onTimeUpdate=void 0,this.onTimeUpdateAudio=void 0,this.skipAhead=void 0,this.getScreenshotEnabled=void 0,this.xdocScreenshotRequested=void 0,this.screenshotRequested=void 0,this.timeoutWarning=!1,angular.isDefined(this.countdownWarningInterval)&&$interval.cancel(this.countdownWarningInterval),angular.isDefined(this.timeLimitCountdownInterval)&&$interval.cancel(this.timeLimitCountdownInterval),this.countdownWarning=null,this.timeLimitCountdown=null,this.journeyPlayback=null,this.emitUserInteractionDisabled=!1,delete this.fileUpload,delete this.addMediaDisabled,delete this.fileUploadProgress;var canvas=document.getElementById(this.canvasId);if(canvas){var ctx=canvas.getContext("2d");ctx&&ctx.clearRect(0,0,2e3,2e3)}"Log messages will follow once session has started...\n"!==this.debugConsole[this.debugConsole.length-1]&&(this.debugConsole.push(""),this.debugConsole.push("Log messages will follow once session has started...\n"),this.updateDebugConsoleVisible()),$("#"+self.canvasId).off("mousedown").mousedown(function(e){}),$(document).off("mousedown").mousedown(function(e){}),$(document).off("mousemove").mousemove(function(e){}),$(document).off("mouseup").mouseup(function(e){}),$("#"+self.canvasId).off("touchstart").on("touchstart",function(e){}),$(document).off("touchstart").on("touchstart",function(e){}),$(document).off("touchmove").on("touchmove",function(e){}),$(document).off("touchend").on("touchend",function(e){})},this.setDeviceParameters=function(newValue){appConstants.deviceDimensions[newValue]&&(this.deviceWidth=appConstants.deviceDimensions[newValue].width,this.deviceHeight=appConstants.deviceDimensions[newValue].height,this.generic=appConstants.deviceDimensions[newValue].generic),$rootScope.deviceConfig.iosDevices.indexOf(newValue)>-1?this.platform="ios":this.platform="android",appConstants.tabletDevices.indexOf(newValue)>-1?(this.type="tablet",(this.name&&this.name!=newValue||!this.name&&!$routeParams.scale)&&(this.scale=50)):appConstants.watchDevices.indexOf(newValue)>-1?(this.type="watch",this.name&&this.name!=newValue&&(this.scale=75)):(this.type="phone",this.name&&this.name!=newValue&&(this.scale=75)),appConstants.physicalDevices.indexOf(newValue)>-1?this.physical=!0:this.physical=!1,"ios"===this.platform&&this.enableAdb&&this.toggleAdb(!1),this.name=newValue},this.updateDevice=function(newValue){if(toastr.remove(),this.showPostSession=!1,$rootScope.app&&$rootScope.app.useLastFrame&&this.appLaunch){$rootScope.app.lastFrame||($rootScope.app.lastFrame={});var uint8Arr=new Uint8Array(lastFrame),str=uint8ArrayToString(uint8Arr),base64String=btoa(str),data="data:image/jpeg;base64,"+base64String;$rootScope.app.lastFrame[this.name]=data,lastFrameSavedFlag=!0}this.setDeviceParameters(newValue),this.updateScaledWidthsAndHeights(),this.cleanConnections(),this.setDefaultOSVersion(newValue),this.checkValidOSVersion(newValue),this.deviceUpdated=!0,this.autoplay&&this.clientControllerConnected&&($rootScope.app.programmaticPlay?this.requestSession():toastr.warning("Autoplay is not supported under the Trial plan. Please try again!"))},this.updateColor=function(newValue){$rootScope.devices&&$rootScope.devices[0]==this&&updateLocationSearch("deviceColor",newValue)},this.toggleIntercept=function(){$rootScope.devices&&$rootScope.devices[0]==this&&(this.proxy?(this.proxy=!1,updateLocationSearch("proxy","false")):(this.proxy="intercept",updateLocationSearch("proxy","intercept")),this.cleanConnections())},this.toggleDebug=function(newValue){$rootScope.devices&&$rootScope.devices[0]==this&&(this.debug=newValue,updateLocationSearch("debug",newValue?"true":"false"),this.cleanConnections())},this.toggleAdb=function(newValue){$rootScope.devices&&$rootScope.devices[0]==this&&(this.enableAdb=newValue,updateLocationSearch("enableAdb",newValue?"true":"false"),this.cleanConnections())},this.requiresArm=function(){return"android"==this.platform&&$rootScope.app&&$rootScope.app.architectures&&$rootScope.app.architectures.length>0&&-1===$rootScope.app.architectures.indexOf("x86")},this.setDefaultOSVersion=function(newValue){!$routeParams.osVersion&&this.requiresArm()?this.osVersion="11":!$routeParams.osVersion&&$rootScope.app&&$rootScope.app.defaultOSVersions&&$rootScope.app.defaultOSVersions[newValue]?this.osVersion=$rootScope.app.defaultOSVersions[newValue]:$rootScope.deviceConfig.defaultOSOverrides&&$rootScope.deviceConfig.defaultOSOverrides[this.platform]&&$rootScope.deviceConfig.defaultOSOverrides[this.platform][this.osVersion]?this.osVersion=$rootScope.deviceConfig.defaultOSOverrides[this.platform][this.osVersion]:$rootScope.deviceConfig.compatibleDevices&&$rootScope.deviceConfig.compatibleDevices[this.platform]&&$rootScope.deviceConfig.compatibleDevices[this.platform][this.name]&&-1===$rootScope.deviceConfig.compatibleDevices[this.platform][this.name].indexOf(this.osVersion)&&(this.osVersion=$rootScope.deviceConfig.osVersionDefaults[this.name]),updateLocationSearch("osVersion",this.osVersion)},this.updateOsVersion=function(newValue){this.cleanConnections(),$rootScope.devices&&$rootScope.devices[0]==this&&updateLocationSearch("osVersion",newValue)},this.checkValidOSVersion=function(newValue){this.osVersion&&(this.requiresArm()&&"11"!==this.osVersion.substr(0,2)?(toastr.remove(),toastr.warning("APK has native code but does not have x86 architecture. Switching osVersion to Android 11+."),this.osVersion="11",updateLocationSearch("osVersion",this.osVersion)):$rootScope.deviceConfig.compatibleDevices&&$rootScope.deviceConfig.compatibleDevices[this.platform]&&$rootScope.deviceConfig.compatibleDevices[this.platform][newValue]&&$rootScope.deviceConfig.compatibleDevices[this.platform][newValue].indexOf(this.osVersion)>-1||(toastr.remove(),toastr.error("Invalid osVersion. OS: "+this.osVersion+" for device: "+newValue+" not supported. Device will use default osVersion."),delete this.osVersion,updateLocationSearch("osVersion",null)))},this.updateScaledWidthsAndHeights=function(){if(this.canvasWrapperWidth=Math.ceil(appConstants.deviceDimensions[this.name].width*this.scale/100),this.canvasWrapperHeight=Math.ceil(appConstants.deviceDimensions[this.name].height*this.scale/100),this.showDeviceBorder?"portrait"==this.orientation?this.divMinWidth=this.canvasWrapperWidth:this.divMinWidth=this.canvasWrapperHeight:"portrait"==this.orientation?this.divMinWidth=this.canvasInnerContainerWidth:this.divMinWidth=this.canvasInnerContainerHeight,this.canvasInnerContainerTop=appConstants.screenPositions[this.name][this.rotation].top,this.canvasInnerContainerLeft=appConstants.screenPositions[this.name][this.rotation].left,this.rotateButtonsWidth=appConstants.screenPositions[this.name].rotateButtons.width,this.rotateButtonsHeight=appConstants.screenPositions[this.name].rotateButtons.height,this.rotateButtonsPosition=appConstants.screenPositions[this.name].rotateButtons[this.orientation],"ios"==this.platform)for(this.homeButtonContainer=appConstants.screenPositions[this.name].homeButtonContainer[this.rotation],this.homeButtonDimensions=appConstants.screenPositions[this.name].homeButtonDimensions;$rootScope.devices.length>1;)$rootScope.devices[$rootScope.devices.length-1].destroy(),$rootScope.devices.pop();"landscape"==this.orientation?(this.canvasInnerContainerWidth=appConstants.screenDimensions[this.name].height,this.canvasInnerContainerHeight=appConstants.screenDimensions[this.name].width):(this.canvasInnerContainerWidth=appConstants.screenDimensions[this.name].width,this.canvasInnerContainerHeight=appConstants.screenDimensions[this.name].height),$rootScope.isEmbed&&"landscape"==this.orientation&&(this.embedTranslateX=0,this.embedTranslateY=Math.ceil(appConstants.embedTranslations[this.name].y*this.scale/100)),$rootScope.devices&&$rootScope.devices[0]==this&&(updateLocationSearch("device",this.name),updateLocationSearch("scale",this.scale),this.physical||updateLocationSearch("orientation",this.orientation))};var requestDisabled=!1;this.requestSession=function(){var self=this;if(!this.clientControllerConnected)return this.requestSessionOnConnect=!0,void(this.requestSessionConnectTimeout=setTimeout(function(){toastr.error("Your may be offline, or your browser may not support secure WebSockets. More info at https://websocketstest.com.",null,{onclick:function(){window.open("https://websocketstest.com")}}),self.requestSessionOnConnect=!1,$rootScope.$apply(function(){})},2e3));if("jpeg"!=this.requestedCodec&&window.MediaSource?this.codec="h264":this.codec="jpeg",(!window.MediaSource||window.MSInputMethodContext&&document.documentMode)&&("h264"==this.codec&&(console.log("Browser does not support Media Source Extensions, switching codec to jpeg"),this.codec="jpeg"),this.enableAudio&&(console.log("Browser does not support Media Source Extensions, disabling audio"),this.enableAudio=!1)),$rootScope.app&&0===$rootScope.app.publicKey.indexOf("ag_")&&"hammerhead"===this.name)return void toastr.warning("App groups not supported on Nexus 5 Physical");if(!(this.connection||this.queue||this.accountQueue||this.disableSessionStart||requestDisabled))if(this.selectedRequestId,this.networkLog={},this.networkLogSimple={},this.chromeDevToolsUrl=null,this.cleanConnection(),this.clientController.connected)if(this.clientController&&this.clientController.io&&this.clientController.io.engine){toastr.remove(),requestDisabled=!0;var referrer;referrer=$rootScope.isEmbed&&!$rootScope.isHomepage?document.referrer:document.location.href;var requestSessionData={debug:this.debug,deviceType:this.name,platform:this.platform,rotation:this.rotation,params:this.params,plistEdit:this.plistEdit,noVideo:this.noVideo,enableAdb:this.enableAdb,androidPackageManager:this.androidPackageManager,screenRecording:this.screenRecording,loopback:this.loopback,language:this.language,locale:this.locale,adbShellCommand:this.adbShellCommand,disableVirtualKeyboard:this.disableVirtualKeyboard,timezone:this.timezone,userTimezone:this.userTimezone,iosKeyboard:this.iosKeyboard,location:this.location,launchUrl:this.launchUrl,proxy:this.proxy,codec:this.codec,audio:this.enableAudio,osVersion:this.osVersion,timestamp:Date.now(),referrer:referrer,xdocMsg:this.xdocMsg,autoplay:this.autoplay,region:this.region,payerCode:this.payerCode,grantPermissions:this.grantPermissions,hidePasswords:this.hidePasswords,record:this.record};$rootScope.app&&$rootScope.app.privateKey?(requestSessionData.publicKey=$rootScope.app.publicKey,requestSessionData.privateKey=$rootScope.app.privateKey,$rootScope.recordEvent("debug_"+this.name+"_session_requested")):$rootScope.app&&$rootScope.app.publicKey?(requestSessionData.publicKey=$rootScope.app.publicKey,$rootScope.recordEvent("app_"+this.name+"_session_requested")):$rootScope.isStandalone?(requestSessionData.publicKey="standalone",$rootScope.recordEvent("standalone_"+this.name+"_session_requested")):($rootScope.isOnprem?requestSessionData.publicKey="demo":"ios"!==this.platform||"8.4"!==this.osVersion&&"9.3"!==this.osVersion?"ios"===this.platform?requestSessionData.publicKey="demo_phq04c56jnvrkg0bn9w5ep4m9r":requestSessionData.publicKey="demo_r0m5r98axtdhftx1hmmhq1c0m8":requestSessionData.publicKey="demo_j98yb8warf526v22yyqvx3kz10",$rootScope.recordEvent("demo_"+this.name+"_session_requested")),$http.post("/api/session/request",{data:requestSessionData,socketid:this.clientController.io.engine.id})["catch"](function(err){err&&400===err.status&&err.data?toastr.error(err.data):toastr.error("Error requesting session")}),this.notFirstRequest=!0,"true"==$routeParams.xdocMsg&&window.parent.postMessage("sessionRequested","*"),setTimeout(function(){requestDisabled=!1},500)}else toastr.error("Error requesting session");else;},this.updateScale=function(value){this.scale=value,this.updateScaledWidthsAndHeights()},this.sendHeartbeatsToOtherDevices=function(){for(var i=0;i<$rootScope.devices.length;i++)$rootScope.devices[i]!==this&&$rootScope.devices[i].heartbeat()},this.endSession=function(data){$routeParams.endSessionRedirectUrl?window.location.href=$routeParams.endSessionRedirectUrl:("disconnect"===data&&isSimulating&&toastr.info("Lost connection to server. Please restart your session."),data&&data.timeLimitElapsed&&data.timeLimit&&data.timeLimitFreeTier?(!$rootScope.app||$rootScope.isHomepage)&&toastr.info("Free tier has a "+data.timeLimit/60+" minute time limit"):data&&data.timeLimitElapsed&&data.timeLimit&&(!$rootScope.app||$rootScope.isHomepage)&&toastr.info("Demo has a "+data.timeLimit+" second time limit"),this.cleanConnections(),$rootScope.$$phase||$rootScope.$apply(function(){})),isSimulating=!1};var lastFrame;this.connect=function(data){function initiateJmuxer(){self.jmuxer||(self.jmuxer=new JMuxer({node:self.video,mode:"video",flushingTime:15,onReady:function(){self.jmuxer.mediaSource.duration=1/0,self.jmuxer.feed({video:self.preReadyBuffer}),self.preReadyBuffer=null}}),self.video.addEventListener("timeupdate",self.onTimeUpdate),self.audioJmuxer||(self.audioJmuxer=new JMuxer({node:self.audio,mode:"audio",flushingTime:15,onReady:function(){self.audioJmuxer.mediaSource.duration=1/0,self.audioJmuxer.feed({audio:self.preReadyAudioBuffer}),self.preReadyAudioBuffer=null}}),self.audio.addEventListener("timeupdate",self.onTimeUpdateAudio)))}var self=this;if(self.connection=!0,self.requestSessionOnConnect=!1,$rootScope.$apply(function(){}),data.path&&data.sessionToken){this.appetizer&&this.appetizer.disconnect(),this.appetizer=new AppSocket(data.path+"/client?sessionToken="+data.sessionToken,{pingInterval:3e4}),"true"==$routeParams.xdocMsg&&window.parent.postMessage({type:"sessionConnecting",token:data.sessionToken,path:data.path},"*"),this.connectionString=data.path,this.connectionToken=data.sessionToken,"watch"==this.type&&"watch"!=$rootScope.devices[0].type&&$rootScope.devices[0].appetizer?this.connectWatch($rootScope.devices[0].connectionString,$rootScope.devices[0].connectionToken):$rootScope.devices[1]&&"watch"!=this.type&&"watch"==$rootScope.devices[1].type&&$rootScope.devices[1].appetizer&&$rootScope.devices[1].connectWatch(this.connectionString,this.connectionToken),this.appetizer.on("capabilities",function(data){data&&data.getScreenshot&&(self.getScreenshotEnabled=!0)}),this.appetizer.on("screenshot",function(data){if(data&&data.success===!1)toastr.error(data.error||"Error retrieving screenshot");else if(data&&data.success&&data.data&&data.mimeType)if(self.screenshotRequested){self.screenshotRequested=!1;var file=new Blob([data.data],{type:data.mimeType});saveAs(file,getFormattedDate()+" High Res Screenshot.png")}else if(self.xdocScreenshotRequested){self.xdocScreenshotRequested=!1;var uint8Arr=new Uint8Array(data.data),str=uint8ArrayToString(uint8Arr),base64String=btoa(str),screenshotData="data:image/png;base64,"+base64String;window&&window.parent&&window.parent.postMessage({type:"screenshot",data:screenshotData},"*")}}),this.appetizer.on("userError",function(data){"true"==$routeParams.xdocMsg&&(window.parent.postMessage("userError","*"),window.parent.postMessage({type:"userErrorMessage",message:data.message},"*")),data.requiresArm?(toastr.warning("APK has native code but does not have x86 architecture. Switching osVersion to Android 11+."),this.osVersion="11",updateLocationSearch("osVersion",this.osVersion),"true"==$routeParams.xdocMsg&&window.parent.postMessage("requiresArm","*")):data.message?toastr.error(data.message):toastr.error("There was an error loading your app"),self.cleanConnection(),$rootScope.recordEvent("user_error_on_requested_session"),$rootScope.$apply(function(){})}),this.appetizer.on("launchStatus",function(data){if(!data||!data.status)return void(self.loadingStatus=null);switch(data.status){case"switchingDevice":self.loadingStatus="Switching device...";break;case"downloadingApp":self.loadingStatus="Downloading app...";break;case"installingApp":self.loadingStatus="Installing app...";break;case"launchingApp":self.loadingStatus="Launching app...";break;default:self.loadingStatus="Loading..."}$rootScope.$apply(function(){})}),this.appetizer.on("timeoutWarning",function(data){"true"==$routeParams.xdocMsg&&window.parent.postMessage("timeoutWarning","*"),self.timeoutWarning=!0,$rootScope.$apply(function(){})}),this.appetizer.on("countdownWarning",function(data){"true"==$routeParams.xdocMsg&&window.parent.postMessage("countdownWarning","*"),self.countdownWarning=data.secondsRemaining,self.countdownWarningInterval=$interval(function(){0==self.countdownWarning&&angular.isDefined(self.countdownWarningInterval)?$interval.cancel(self.countdownWarningInterval):self.countdownWarning--},1e3),$rootScope.$apply(function(){})}),this.appetizer.on("timeLimitCountdown",function(data){"true"==$routeParams.xdocMsg&&window.parent.postMessage({type:"timeLimitCountdown",value:data.secondsRemaining},"*"),self.timeLimitCountdown=data.secondsRemaining-.5,self.timeLimitCountdownTotal=data.secondsRemaining,self.timeLimitCountdownInterval=$interval(function(){self.timeLimitCountdown<=1&&angular.isDefined(self.timeLimitCountdownInterval)?($interval.cancel(self.timeLimitCountdownInterval),self.timeLimitCountdown=0):self.timeLimitCountdown=self.timeLimitCountdown-1},1e3),$rootScope.$apply(function(){})}),this.appetizer.on("uiDump",function(data){"true"==$routeParams.xdocMsg&&data&&window.parent.postMessage({type:"uiDump",value:data},"*"),console.log("uiDump",data)}),this.appetizer.on("recordedEvent",function(data){"true"==$routeParams.xdocMsg&&window.parent.postMessage({type:"recordedEvent",value:data},"*"),console.log("recordedEvent",data),window.lastEvent2=window.lastEvent,window.lastEvent=data}),this.appetizer.on("deleteEvent",function(data){"true"==$routeParams.xdocMsg&&window.parent.postMessage({type:"deleteEvent",value:data},"*"),console.log("deleteEvent",data),window.lastEvent=null}),this.appetizer.on("playbackFoundAndSent",function(data){"true"==$routeParams.xdocMsg&&window.parent.postMessage({type:"playbackFoundAndSent",value:data},"*"),console.log("playbackFoundAndSent",data)}),this.appetizer.on("playbackError",function(data){"true"==$routeParams.xdocMsg&&window.parent.postMessage({type:"playbackError",value:data},"*"),console.log("playbackError",data)}),this.appetizer.on("userInteractionReceived",function(data){self.timeoutWarning=!1,angular.isDefined(self.countdownWarningInterval)&&$interval.cancel(self.countdownWarningInterval),self.countdownWarning=null,toastr.remove(),$rootScope.$apply(function(){}),"true"==$routeParams.xdocMsg&&(data&&"heartbeat"===data.type?window.parent.postMessage("heartbeatReceived","*"):(window.parent.postMessage("userInteractionReceived","*"),window.parent.postMessage({type:"userInteractionReceived",value:data},"*")))}),this.appetizer.on("debug",function(data){"true"==$routeParams.xdocMsg&&window.parent.postMessage({type:"debug",message:data.message},"*"),self.debugConsole.push(data.message),self.updateDebugConsoleVisible(),$rootScope.$apply(function(){})}),this.appetizer.on("appLaunch",function(data){self.appLaunch=!0,self.showPostSession=!0,"true"==$routeParams.xdocMsg&&window.parent.postMessage("appLaunch","*"),$rootScope.$apply(function(){}),self.journeyPlayback&&("true"==$routeParams.xdocMsg&&window.parent.postMessage("journeyPlaybackStarted","*"),journeyPlaybackSequence(self.journeyPlayback,0,5e3))}),this.appetizer.on("interceptRequest",function(data){self.networkLog[data.requestId]||(self.networkLog[data.requestId]=data),self.networkLogSimple[data.requestId]||(self.networkLogSimple[data.requestId]={name:data.request.url,status:"(pending)"}),"true"==$routeParams.xdocMsg&&window.parent.postMessage({type:"interceptRequest",value:data},"*"),$rootScope.$apply(function(){})}),this.appetizer.on("interceptResponse",function(data){self.networkLog[data.requestId]=data,self.networkLogSimple[data.requestId]={name:data.request.url,status:data.response.status,type:data.response.content.mimeType.split(";").shift(),size:data.response.bodySize/1024,time:data.time},"true"==$routeParams.xdocMsg&&window.parent.postMessage({type:"interceptResponse",value:data},"*"),$rootScope.$apply(function(){})}),this.appetizer.on("interceptError",function(data){self.networkLog[data.requestId]=data,self.networkLogSimple[data.requestId]={name:data.request.url,status:"(failed)"},"true"==$routeParams.xdocMsg&&window.parent.postMessage({type:"interceptError",value:data},"*"),$rootScope.$apply(function(){})}),this.appetizer.on("devtoolsConnection",function(data){data.secure?self.chromeDevToolsUrl="https://"+appConstants.chromeDevToolsBaseUrl+"?wss="+data.url:self.chromeDevToolsUrl="http://"+appConstants.chromeDevToolsBaseUrl+"?ws="+data.url,"true"==$routeParams.xdocMsg&&window.parent.postMessage({type:"chromeDevToolsUrl",value:self.chromeDevToolsUrl},"*"),$rootScope.$apply(function(){})}),this.appetizer.on("adbOverTcp",function(data){self.adbConnectionInfo=data,"true"==$routeParams.xdocMsg&&window.parent.postMessage({type:"adbConnectionInfo",value:data},"*"),$rootScope.$apply(function(){})}),this.appetizer.on("disconnect",function(data){self.endSession("disconnect")}),this.appetizer.on("endSession",function(data){self.endSession(data)}),this.appetizer.on("setRotation",function(data){self.setRotation(data.rotation),$rootScope.$apply(function(){})}),this.preReadyBuffer=new Uint8Array,this.preReadyAudioBuffer=new Uint8Array,this.video=document.getElementById("video_"+this.canvasId),this.audio=document.getElementById("audio_"+this.canvasId),"h264"==self.codec&&initiateJmuxer(),this.appetizer.on("h264Data",function(data){if("jpeg"==self.codec&&(console.log("Error: receiving h264 streaming when requested codec is jpeg"),initiateJmuxer(),self.codec="h264",$rootScope.$apply(function(){})),isSimulating=!0,self.appetizer&&self.appetizer.emit("frameReceived",{hash:data.hash}),self.firstFrameReceived||("true"==$routeParams.xdocMsg&&window.parent.postMessage("firstFrameReceived","*"),self.firstFrameReceived=!0,$rootScope.$apply(function(){})),self.preReadyBuffer)self.preReadyBuffer=append(self.preReadyBuffer,data.buffer);else try{self.jmuxer.feed({video:data.buffer}),self.video.paused&&self.skipAhead(self.video)}catch(e){console.error(e)}data.width>data.height&&"portrait"==self.orientation?(self.rotation+=rotationChange,rotationChange=0,self.rotation%=360,self.orientation="landscape",self.rotation%180!=90&&(self.rotation=270),self.rotateDisabled=!1,self.updateScaledWidthsAndHeights(),console.log("orientationChanged: landscape"),"true"==$routeParams.xdocMsg&&window.parent.postMessage({type:"orientationChanged",value:"landscape"},"*"),$rootScope.$apply(function(){})):data.height>data.width&&"landscape"==self.orientation&&(self.rotation+=rotationChange,rotationChange=0,self.rotation%=360,self.orientation="portrait",self.rotation%180!=0&&(self.rotation=0),self.rotateDisabled=!1,self.updateScaledWidthsAndHeights(),
console.log("orientationChanged: portrait"),"true"==$routeParams.xdocMsg&&window.parent.postMessage({type:"orientationChanged",value:"portrait"},"*"),$rootScope.$apply(function(){}))}),this.appetizer.on("audioData",function(data){if(self.preReadyAudioBuffer)self.preReadyAudioBuffer=append(self.preReadyAudioBuffer,data);else try{self.audioJmuxer.feed({audio:data}),self.audio.paused&&self.skipAhead(self.audio)}catch(e){console.error(e)}}),this.skipAhead=function(element){element&&element.buffered&&element.buffered.length&&(element.currentTime=element.buffered.end(element.buffered.length-1),element.play()["catch"](function(e){console.log(e)}))},this.onTimeUpdate=function(element){if(console.log("ontimeupdate video",element),this.video&&this.video.buffered&&this.video.buffered.length){var delay=this.video.buffered.end(this.video.buffered.length-1)-this.video.currentTime;delay>1?this.skipAhead(this.video):delay>.7?this.video.playbackRate=5:delay>.5?this.video.playbackRate=3:delay>.2?this.video.playbackRate=2:this.video.playbackRate=1}},this.onTimeUpdateAudio=function(element){if(console.log("onTimeUpdateAudio",element),this.audio&&this.audio.buffered&&this.audio.buffered.length){var delay=this.audio.buffered.end(this.audio.buffered.length-1)-this.audio.currentTime;console.log("audio buffered",this.audio.buffered,"currentTime",this.audio.currentTime,"delay",delay),delay>1?this.skipAhead(this.audio):delay>.7?this.audio.playbackRate=5:delay>.5?this.audio.playbackRate=3:delay>.2?this.audio.playbackRate=2:this.audio.playbackRate=1}},this.appetizer.on("frameData",function(data){"h264"==self.codec&&(console.log("Switching codec from h264 to jpeg"),self.codec="jpeg",$rootScope.$apply(function(){})),isSimulating=!0,self.appetizer&&self.appetizer.emit("frameReceived",{hash:data.hash}),self.firstFrameReceived||("true"==$routeParams.xdocMsg&&window.parent.postMessage("firstFrameReceived","*"),self.firstFrameReceived=!0,$rootScope.$apply(function(){})),lastFrame=data.buffer;var canvas=document.getElementById(self.canvasId);if(canvas){var ctx=canvas.getContext("2d"),uint8Arr=new Uint8Array(data.buffer),str=uint8ArrayToString(uint8Arr),base64String=btoa(str),img=new Image;img.onload=function(){var x=0,y=0;ctx.clearRect(0,0,2e3,2e3),ctx.drawImage(this,x,y,self.canvasInnerContainerWidth,self.canvasInnerContainerHeight)},img.src="data:image/jpeg;base64,"+base64String,self.physical||setTimeout(function(){img.width>img.height&&"portrait"==self.orientation?(self.rotation+=rotationChange,rotationChange=0,self.rotation%=360,self.orientation="landscape",self.rotation%180!=90&&(self.rotation=270),self.rotateDisabled=!1,self.updateScaledWidthsAndHeights(),console.log("orientationChanged: landscape"),"true"==$routeParams.xdocMsg&&window.parent.postMessage({type:"orientationChanged",value:"landscape"},"*"),$rootScope.$apply(function(){})):img.height>img.width&&"landscape"==self.orientation&&(self.rotation+=rotationChange,rotationChange=0,self.rotation%=360,self.orientation="portrait",self.rotation%180!=0&&(self.rotation=0),self.rotateDisabled=!1,self.updateScaledWidthsAndHeights(),console.log("orientationChanged: portrait"),"true"==$routeParams.xdocMsg&&window.parent.postMessage({type:"orientationChanged",value:"portrait"},"*"),$rootScope.$apply(function(){}))},20)}}),"watch"!=self.type&&($(document).off("keyup").keyup(function(e){return 18===e.which?void(self.altKey=!1):void(20==e.which&&(self.capsLock=!1))}),$(document).off("keypress").keypress(function(e){e.preventDefault()}),$(document).off("keydown").keydown(function(e){if(!e.metaKey&&!e.ctrlKey||86!=e.which){if(20==e.which)return void(self.capsLock=!0);var n,preventDefault;switch(e.which){case 18:return void(self.altKey=!0);case 12:case 16:case 17:case 33:case 34:case 35:case 36:case 91:case 93:case 27:case 46:case 106:case 107:case 109:case 111:case 112:case 113:case 114:case 115:case 116:case 117:case 118:case 119:case 120:case 121:case 122:case 123:case 124:case 127:case 144:return;case 8:case 9:case 32:preventDefault=!0,n=String.fromCharCode(e.which);break;case 37:preventDefault=!0,n="leftArrow";break;case 38:preventDefault=!0,n="upArrow";break;case 39:preventDefault=!0,n="rightArrow";break;case 40:preventDefault=!0,n="downArrow";break;case 186:n=";";break;case 187:n="=";break;case 188:n=",";break;case 173:n="-";break;case 189:n="-";break;case 110:case 190:n=".";break;case 191:n="/";break;case 192:n="`";break;case 219:n="[";break;case 220:n="\\";break;case 221:n="]";break;case 222:n="'";break;case 96:case 97:case 98:case 99:case 100:case 101:case 102:case 103:case 104:case 105:n=String.fromCharCode(e.which-48);break;default:n=String.fromCharCode(e.which)}n&&(preventDefault&&e.preventDefault(),self.emitUserInteraction({type:"keypress",which:e.which,shiftKey:(e.shiftKey||self.capsLock&&/^[a-zA-Z]$/i.test(n))+"",key:n,timeStamp:e.timeStamp}),self.sendHeartbeatsToOtherDevices())}}));var lastMove=0,eventThrottle=10,swipeThottle=4,lastX=0,lastY=0;$(document).mousedown(function(e){if(-1===e.target.id.indexOf(self.canvasId)){if($rootScope.devices&&$rootScope.devices.length>1)for(var i=0;i<$rootScope.devices.length;i++)if(e.target.id.indexOf($rootScope.devices[i].canvasId)>-1)return;$(document).off("mouseup").mouseup(function(e){})}}),$("#container_"+self.canvasId).off("mousedown").mousedown(function(e){var originalRelX=e.offsetX||100/self.scale*(e.clientX-$(e.target).offset().left+window.pageXOffset),originalRelY=e.offsetY||100/self.scale*(e.clientY-$(e.target).offset().top+window.pageYOffset);self.emitUserInteraction({type:e.type,timeStamp:e.timeStamp,xPos:originalRelX,yPos:originalRelY,altKey:self.altKey}),self.sendHeartbeatsToOtherDevices();var mouseMoved,mustSendAltKeyOnMouseUp=self.altKey;$(document).off("mousemove").mousemove(function(e){e.preventDefault();var now=Date.now();if(now>lastMove+eventThrottle){var relX=e.offsetX||100/self.scale*(e.clientX-$(e.target).offset().left+window.pageXOffset),relY=e.offsetY||100/self.scale*(e.clientY-$(e.target).offset().top+window.pageYOffset);(Math.abs(originalRelX-relX)>swipeThottle||Math.abs(originalRelY-relY)>swipeThottle)&&(lastMove=now,mouseMoved=!0,e.target.id.indexOf(self.canvasId)>-1&&relX>=0&&relX<=$(".canvas-inner-container."+self.canvasId).width()&&relY>=0&&relY<=$(".canvas-inner-container."+self.canvasId).height()&&(lastX=relX,lastY=relY,self.emitUserInteraction({type:e.type,timeStamp:e.timeStamp,xPos:relX,yPos:relY,altKey:self.altKey})))}}),$(document).off("mouseup").mouseup(function(e){$(document).off("mousemove");var relX=e.offsetX||100/self.scale*(e.clientX-$(e.target).offset().left+window.pageXOffset),relY=e.offsetY||100/self.scale*(e.clientY-$(e.target).offset().top+window.pageYOffset);mouseMoved?e.target.id.indexOf(self.canvasId)>-1&&relX>=0&&relX<=$(".canvas-inner-container."+self.canvasId).width()&&relY>=0&&relY<=$(".canvas-inner-container."+self.canvasId).height()?self.emitUserInteraction({appetizerID:self.appetizerID,type:e.type,timeStamp:e.timeStamp,xPos:relX,yPos:relY,altKey:mustSendAltKeyOnMouseUp}):self.emitUserInteraction({appetizerID:self.appetizerID,type:e.type,timeStamp:e.timeStamp,xPos:lastX,yPos:lastY,altKey:mustSendAltKeyOnMouseUp}):self.emitUserInteraction({appetizerID:self.appetizerID,type:"mouseup",timeStamp:e.timeStamp,xPos:originalRelX,yPos:originalRelY}),self.sendHeartbeatsToOtherDevices()})}),$(document).on("touchstart",function(e){if(-1===e.target.id.indexOf(self.canvasId)){if($rootScope.devices&&$rootScope.devices.length>1)for(var i=0;i<$rootScope.devices.length;i++)if(e.target.id.indexOf($rootScope.devices[i].canvasId)>-1)return;$(document).off("touchend").on("touchend",function(e){})}}),$("#container_"+self.canvasId).off("touchstart").on("touchstart",function(e){$("#container_"+self.canvasId).off("mousedown");var originalEvent=e.originalEvent.changedTouches[0],frameOffset=$("#container_"+self.canvasId).offset(),originalRelX=100/self.scale*(originalEvent.pageX-frameOffset.left),originalRelY=100/self.scale*(originalEvent.pageY-frameOffset.top);self.emitUserInteraction({type:"mousedown",timeStamp:e.timeStamp,xPos:originalRelX,yPos:originalRelY}),self.sendHeartbeatsToOtherDevices();var mouseMoved;$(document).off("touchmove").on("touchmove",function(e){e.preventDefault();var now=Date.now();if(now>lastMove+eventThrottle){var originalEvent=e.originalEvent.changedTouches[0],frameOffset=$("#container_"+self.canvasId).offset(),relX=100/self.scale*(originalEvent.pageX-frameOffset.left),relY=100/self.scale*(originalEvent.pageY-frameOffset.top);(Math.abs(originalRelX-relX)>swipeThottle||Math.abs(originalRelY-relY)>swipeThottle)&&(lastMove=now,mouseMoved=!0,e.target.id.indexOf(self.canvasId)>-1&&relX>=0&&relX<=$(".canvas-inner-container."+self.canvasId).width()&&relY>=0&&relY<=$(".canvas-inner-container."+self.canvasId).height()&&(lastX=relX,lastY=relY,self.emitUserInteraction({type:"mousemove",timeStamp:e.timeStamp,xPos:relX,yPos:relY})))}}),$(document).off("touchend").on("touchend",function(e){$(document).off("touchmove");var originalEvent=e.originalEvent.changedTouches[0],frameOffset=$("#container_"+self.canvasId).offset(),relX=100/self.scale*(originalEvent.pageX-frameOffset.left),relY=100/self.scale*(originalEvent.pageY-frameOffset.top);mouseMoved?e.target.id.indexOf(self.canvasId)>-1&&relX>=0&&relX<=$(".canvas-inner-container."+self.canvasId).width()&&relY>=0&&relY<=$(".canvas-inner-container."+self.canvasId).height()?self.emitUserInteraction({appetizerID:self.appetizerID,type:"mouseup",timeStamp:e.timeStamp,xPos:relX,yPos:relY}):self.emitUserInteraction({appetizerID:self.appetizerID,type:"mouseup",timeStamp:e.timeStamp,xPos:lastX,yPos:lastY}):self.emitUserInteraction({appetizerID:self.appetizerID,type:"mouseup",timeStamp:e.timeStamp,xPos:originalRelX,yPos:originalRelY}),self.sendHeartbeatsToOtherDevices()})});var fixed=document.getElementById("container_"+self.canvasId);if(fixed.addEventListener("touchmove",function(e){e.preventDefault()},!1),/Edge/.test(navigator.userAgent)){var canvasWrapper=document.getElementsByClassName("canvas-wrapper")[0];canvasWrapper.addEventListener("mousemove",function(e){e.preventDefault()},!1)}}},this.initialize(device),this.downloadInteractionHistory=function(){var file=new Blob([JSON.stringify(this.interactionHistory)],{type:"application/json"});saveAs(file,getFormattedDate()+" interaction history.json")},this.downloadInteractionHistorySimple=function(){var file=new Blob([JSON.stringify(this.interactionHistorySimple)],{type:"application/json"});saveAs(file,getFormattedDate()+" interaction history simple.json")},this.addInteractionToHistory=function(object){this.interactionHistory.push(jQuery.extend({},object)),"mousemove"!==object.type&&("keypress"!==object.type||-1!==$rootScope.broadcastInteractionsConstants.controlKeys.indexOf(object.which)||"home"===object.key||(object.key=$rootScope.getCharFromKeypress(object),object.key))&&("keypress"==object.type&&-1===$rootScope.broadcastInteractionsConstants.controlKeys.indexOf(object.which)&&"home"!==object.key?lastInteractionSimple&&"string"==lastInteractionSimple.type?(lastInteractionSimple.value+=object.key,this.interactionHistorySimple[this.interactionHistorySimple.length-1]=lastInteractionSimple):(lastInteractionSimple={type:"string",timeStamp:object.timeStamp,value:object.key},this.interactionHistorySimple.push(lastInteractionSimple)):(this.interactionHistorySimple.push(object),lastInteractionSimple=object))},this.playBackSequence=function(journey,step,waitTime){journeyPlaybackSequence(journey,step,waitTime)};var append=function(source,addition){var appended=new Uint8Array(source.byteLength+addition.byteLength);return appended.set(source,0),appended.set(addition,source.byteLength),appended}};return Device}]);var defaults={deviceDimensions:{hammerhead:{width:600,height:1193}},screenDimensions:{hammerhead:{width:540,height:960}},screenPositions:{hammerhead:{0:{top:100.5,left:30},90:{top:325.5,left:-171},180:{top:115.5,left:30},270:{top:325.5,left:-186},rotateButtons:{width:140,height:140,portrait:{bottom:-90,right:-90},landscape:{bottom:195,right:-375}}}},embedTranslations:{hammerhead:{x:300,y:-294}}},iosPlusScreenPositions={0:{top:320/3,left:70/3},90:{top:800/3,left:-410/3},180:{top:320/3,left:22},270:{top:800/3,left:-416/3},rotateButtons:{width:140,height:140,portrait:{bottom:-60,right:-60},landscape:{bottom:162.4,right:-326.8}},homeButtonContainer:{0:{width:"100%",left:"initial",top:"initial",right:"initial",bottom:"28px"},90:{width:"50px",left:"-220px",top:"initial",right:"initial",bottom:"443px"},180:{width:"100%",left:"initial",top:"28px",right:"initial",bottom:"initial"},270:{width:"50px",left:"initial",top:"initial",right:"-208px",bottom:"443px"}},homeButtonDimensions:{width:60,height:60}},appConstants={homepageDemoAppData:{appDisplayName:"Wikipedia Debug",architectures:[],bundle:"org.wikimedia.wikipedia",name:"Wikipedia Debug",platform:"ios",publicKey:"demo_phq04c56jnvrkg0bn9w5ep4m9r",whitelabel:!0},plans:{basic:40,premium:400,enterprise:2e3,basic_annual:432,premium_annual:4320,enterprise_annual:21600},chromeDevToolsBaseUrl:"appetizeio-static.s3.amazonaws.com/chrome-devtools/20200213/inspector/inspector.html",deviceDimensions:{iphone:{width:365,height:782},ipad:{width:864,height:1287},iphone4s:{width:370,height:733},iphone5s:{width:365,height:782},ipodtouch7thgeneration:{width:365,height:782},iphone6:{width:416,height:870},iphone6plus:{width:460,height:2840/3},ipadair:{width:864,height:1287},iphone6s:{width:416,height:870},iphone6splus:{width:460,height:2840/3},iphone7:{width:416,height:870},iphone7plus:{width:460,height:2840/3},iphone8:{width:416,height:870},iphone8plus:{width:460,height:2840/3},iphonex:{width:409,height:845},iphonexs:{width:409,height:845},iphonexsmax:{width:471,height:948},iphone11pro:{width:409,height:845},iphone11promax:{width:471,height:948},ipadair2:{width:864,height:1287},nexus5:{width:400,height:795},nexus7:{width:728,height:1268},nexus9:{width:866,height:1288},pixel4:{width:389,height:829},pixel4xl:{width:519,height:1105},d450:{width:389,height:829},g430:{width:728,height:1109},galaxytabs7:{width:718,height:1099},wearsquare:{width:336,height:688},wearround:{width:359,height:550},hammerhead:defaults.deviceDimensions.hammerhead,amazon:defaults.deviceDimensions.hammerhead,sam:defaults.deviceDimensions.hammerhead,hammerhead_persist1:defaults.deviceDimensions.hammerhead,flo:{width:728,height:1268},ruby:{width:655,height:1292},hercules:{width:585,height:1064}},screenDimensions:{iphone:{width:320,height:568},ipad:{width:768,height:1024},iphone4s:{width:320,height:480},iphone5s:{width:320,height:568},ipodtouch7thgeneration:{width:320,height:568},iphone6:{width:375,height:668},iphone6plus:{width:414,height:736},ipadair:{width:768,height:1024},iphone6s:{width:375,height:668},iphone6splus:{width:414,height:736},iphone7:{width:375,height:668},iphone7plus:{width:414,height:736},iphone8:{width:375,height:668},iphone8plus:{width:414,height:736},iphonex:{width:375,height:812},iphonexs:{width:375,height:812},iphonexsmax:{width:414,height:896},iphone11pro:{width:375,height:812},iphone11promax:{width:414,height:896},ipadair2:{width:768,height:1024},nexus5:{width:360,height:640},nexus7:{width:600,height:960},nexus9:{width:768,height:1024},pixel4:{width:360,height:760},pixel4xl:{width:480,height:1013},d450:{width:360,height:720},g430:{width:600,height:960},galaxytabs7:{width:640,height:1024},wearsquare:{width:280,height:280},wearround:{width:320,height:320},hammerhead:defaults.screenDimensions.hammerhead,amazon:defaults.screenDimensions.hammerhead,sam:defaults.screenDimensions.hammerhead,hammerhead_persist1:defaults.screenDimensions.hammerhead,flo:{width:600,height:960},ruby:{width:540,height:960},hercules:{width:480,height:800}},screenPositions:{iphone:{0:{top:105,left:22},90:{top:230,left:-103},180:{top:105,left:22},270:{top:230,left:-100},rotateButtons:{width:140,height:140,portrait:{bottom:-60,right:-60},landscape:{bottom:150,right:-270}},homeButtonContainer:{0:{width:"100%",left:"initial",top:"initial",right:"initial",bottom:"20px"},90:{width:"50px",left:"-188px",top:"initial",right:"initial",bottom:"361px"},180:{width:"100%",left:"initial",top:"20px",right:"initial",bottom:"initial"},270:{width:"50px",left:"initial",top:"initial",right:"-178px",bottom:"361px"}},homeButtonDimensions:{width:60,height:60}},ipad:{0:{top:130,left:48},90:{top:262,left:-82},180:{top:130,left:48},270:{top:262,left:-82},rotateButtons:{width:140,height:140,portrait:{bottom:-60,right:-60},landscape:{bottom:150,right:-270}},homeButtonContainer:{0:{width:"100%",left:"initial",top:"initial",right:"initial",bottom:"30px"},90:{width:"50px",left:"-180px",top:"initial",right:"initial",bottom:"612px"},180:{width:"100%",left:"initial",top:"30px",right:"initial",bottom:"initial"},270:{width:"50px",left:"initial",top:"initial",right:"-170px",bottom:"612px"}},homeButtonDimensions:{width:60,height:60}},ipadair:{0:{top:130,left:48},90:{top:262,left:-82},180:{top:130,left:48},270:{top:262,left:-82},rotateButtons:{width:140,height:140,portrait:{bottom:-60,right:-60},landscape:{bottom:150,right:-270}},homeButtonContainer:{0:{width:"100%",left:"initial",top:"initial",right:"initial",bottom:"30px"},90:{width:"50px",left:"-180px",top:"initial",right:"initial",bottom:"612px"},180:{width:"100%",left:"initial",top:"30px",right:"initial",bottom:"initial"},270:{width:"50px",left:"initial",top:"initial",right:"-170px",bottom:"612px"}},homeButtonDimensions:{width:60,height:60}},ipadair2:{0:{top:130,left:48},90:{top:262,left:-82},180:{top:130,left:48},270:{top:262,left:-82},rotateButtons:{width:140,height:140,portrait:{bottom:-60,right:-60},landscape:{bottom:150,right:-270}},homeButtonContainer:{0:{width:"100%",left:"initial",top:"initial",right:"initial",bottom:"30px"},90:{width:"50px",left:"-180px",top:"initial",right:"initial",bottom:"612px"},180:{width:"100%",left:"initial",top:"30px",right:"initial",bottom:"initial"},270:{width:"50px",left:"initial",top:"initial",right:"-170px",bottom:"612px"}},homeButtonDimensions:{width:60,height:60}},iphone4s:{0:{top:125,left:25},90:{top:206,left:-53},180:{top:127,left:25},270:{top:206,left:-57},rotateButtons:{width:140,height:140,portrait:{bottom:-60,right:-60},landscape:{bottom:125,right:-240}},homeButtonContainer:{0:{width:"100%",left:"initial",top:"initial",right:"initial",bottom:"35px"},90:{width:"50px",left:"-148px",top:"initial",right:"initial",bottom:"337px"},180:{width:"100%",left:"initial",top:"35px",right:"initial",bottom:"initial"},270:{width:"50px",left:"initial",top:"initial",right:"-138px",bottom:"337px"}},homeButtonDimensions:{width:60,height:60}},iphone5s:{0:{top:105,left:22},90:{top:230,left:-103},180:{top:105,left:22},270:{top:230,left:-100},rotateButtons:{width:140,height:140,portrait:{bottom:-60,right:-60},landscape:{bottom:150,right:-270}},homeButtonContainer:{0:{width:"100%",left:"initial",top:"initial",right:"initial",bottom:"20px"},90:{width:"50px",left:"-188px",top:"initial",right:"initial",bottom:"361px"},180:{width:"100%",left:"initial",top:"20px",right:"initial",bottom:"initial"},270:{width:"50px",left:"initial",top:"initial",right:"-178px",bottom:"361px"}},homeButtonDimensions:{width:60,height:60}},ipodtouch7thgeneration:{0:{top:105,left:22},90:{top:230,left:-103},180:{top:105,left:22},270:{top:230,left:-100},rotateButtons:{width:140,height:140,portrait:{bottom:-60,right:-60},landscape:{bottom:150,right:-270}},homeButtonContainer:{0:{width:"100%",left:"initial",top:"initial",right:"initial",bottom:"20px"},90:{width:"50px",left:"-188px",top:"initial",right:"initial",bottom:"361px"},180:{width:"100%",left:"initial",top:"20px",right:"initial",bottom:"initial"},270:{width:"50px",left:"initial",top:"initial",right:"-178px",bottom:"361px"}},homeButtonDimensions:{width:60,height:60}},iphone6:{0:{top:100,left:21},90:{top:247,left:-126},180:{top:100,left:21},270:{top:247,left:-126},rotateButtons:{width:140,height:140,portrait:{bottom:-60,right:-60},landscape:{bottom:160,right:-290}},homeButtonContainer:{0:{width:"100%",left:"initial",top:"initial",right:"initial",bottom:"20px"},90:{width:"50px",left:"-205px",top:"initial",right:"initial",bottom:"405px"},180:{width:"100%",left:"initial",top:"20px",right:"initial",bottom:"initial"},270:{width:"50px",left:"initial",top:"initial",right:"-195px",bottom:"405px"}},homeButtonDimensions:{width:60,height:60}},iphone6plus:iosPlusScreenPositions,iphone6s:{0:{top:100,left:21},90:{top:247,left:-126},180:{top:100,left:21},270:{top:247,left:-126},rotateButtons:{width:140,height:140,portrait:{bottom:-60,right:-60},landscape:{bottom:160,right:-290}},homeButtonContainer:{0:{width:"100%",left:"initial",top:"initial",right:"initial",bottom:"20px"},90:{width:"50px",left:"-205px",top:"initial",right:"initial",bottom:"405px"},180:{width:"100%",left:"initial",top:"20px",right:"initial",bottom:"initial"},270:{width:"50px",left:"initial",top:"initial",right:"-195px",bottom:"405px"}},homeButtonDimensions:{width:60,height:60}},iphone6splus:iosPlusScreenPositions,iphone7:{0:{top:100,left:21},90:{top:247,left:-126},180:{top:100,left:21},270:{top:247,left:-126},rotateButtons:{width:140,height:140,portrait:{bottom:-60,right:-60},landscape:{bottom:160,right:-290}},homeButtonContainer:{0:{width:"100%",left:"initial",top:"initial",right:"initial",bottom:"20px"},90:{width:"50px",left:"-205px",top:"initial",right:"initial",bottom:"405px"},180:{width:"100%",left:"initial",top:"20px",right:"initial",bottom:"initial"},270:{width:"50px",left:"initial",top:"initial",right:"-195px",bottom:"405px"}},homeButtonDimensions:{width:60,height:60}},iphone7plus:iosPlusScreenPositions,iphone8:{0:{top:100,left:21},90:{top:247,left:-126},180:{top:100,left:21},270:{top:247,left:-126},rotateButtons:{width:140,height:140,portrait:{bottom:-60,right:-60},landscape:{bottom:160,right:-290}},homeButtonContainer:{0:{width:"100%",left:"initial",top:"initial",right:"initial",bottom:"20px"},90:{width:"50px",left:"-205px",top:"initial",right:"initial",bottom:"405px"},180:{width:"100%",left:"initial",top:"20px",right:"initial",bottom:"initial"},270:{width:"50px",left:"initial",top:"initial",right:"-195px",bottom:"405px"}},homeButtonDimensions:{width:60,height:60}},iphone8plus:iosPlusScreenPositions,iphonex:{0:{top:15,left:17},90:{top:235,left:-199},180:{top:18,left:16},270:{top:235,left:-203},rotateButtons:{width:140,height:140,portrait:{bottom:-60,right:-60},landscape:{bottom:140,right:-300}},homeButtonContainer:{0:{width:"100%",left:"initial",top:"initial",right:"initial",bottom:"35px"},90:{width:"50px",left:"-330px",top:"initial",right:"initial",bottom:"665px"},180:{width:"100%",left:"initial",top:"35px",right:"initial",bottom:"initial"},270:{width:"50px",left:"initial",top:"initial",right:"-290px",bottom:"665px"}},homeButtonDimensions:{width:90,height:90}},iphonexs:{0:{top:15,left:17},90:{top:235,left:-199},180:{top:18,left:16},270:{top:235,left:-203},rotateButtons:{width:140,height:140,portrait:{bottom:-60,right:-60},landscape:{bottom:140,right:-300}},homeButtonContainer:{0:{width:"100%",left:"initial",top:"initial",right:"initial",bottom:"35px"},90:{width:"50px",left:"-330px",top:"initial",right:"initial",bottom:"665px"},180:{width:"100%",left:"initial",top:"35px",right:"initial",bottom:"initial"},270:{width:"50px",left:"initial",top:"initial",right:"-290px",bottom:"665px"}},homeButtonDimensions:{width:90,height:90}},iphonexsmax:{0:{top:26,left:29},90:{top:268,left:-213},180:{top:26,left:28},270:{top:266,left:-213},rotateButtons:{width:140,height:140,portrait:{bottom:-60,right:-60},landscape:{bottom:170,right:-300}},homeButtonContainer:{0:{width:"100%",left:"initial",top:"initial",right:"initial",bottom:"35px"},90:{width:"50px",left:"-330px",top:"initial",right:"initial",bottom:"665px"},180:{width:"100%",left:"initial",top:"35px",right:"initial",bottom:"initial"},270:{width:"50px",left:"initial",top:"initial",right:"-290px",bottom:"665px"}},homeButtonDimensions:{width:90,height:90}},iphone11pro:{0:{top:15,left:17},90:{top:235,left:-199},180:{top:18,left:16},270:{top:235,left:-203},rotateButtons:{width:140,height:140,portrait:{bottom:-60,right:-60},landscape:{bottom:140,right:-300}},homeButtonContainer:{0:{width:"100%",left:"initial",top:"initial",right:"initial",bottom:"35px"},90:{width:"50px",left:"-330px",top:"initial",right:"initial",bottom:"665px"},180:{width:"100%",left:"initial",top:"35px",right:"initial",bottom:"initial"},270:{width:"50px",left:"initial",top:"initial",right:"-290px",bottom:"665px"}},homeButtonDimensions:{width:90,height:90}},iphone11promax:{0:{top:26,left:29},90:{top:268,left:-213},180:{top:26,left:28},270:{top:266,left:-213},rotateButtons:{width:140,height:140,portrait:{bottom:-60,right:-60},landscape:{bottom:170,right:-300}},homeButtonContainer:{0:{width:"100%",left:"initial",top:"initial",right:"initial",bottom:"35px"},90:{width:"50px",left:"-330px",top:"initial",right:"initial",bottom:"665px"},180:{width:"100%",left:"initial",top:"35px",right:"initial",bottom:"initial"},270:{width:"50px",left:"initial",top:"initial",right:"-290px",bottom:"665px"}},homeButtonDimensions:{width:90,height:90}},nexus5:{0:{top:67,left:20},90:{top:217,left:-114},180:{top:77,left:20},270:{top:217,left:-124},rotateButtons:{width:140,height:140,portrait:{bottom:-60,right:-60},landscape:{bottom:130,right:-250}}},nexus7:{0:{top:155,left:64},90:{top:334,left:-117},180:{top:153,left:64},270:{top:334,left:-115},rotateButtons:{width:140,height:140,portrait:{bottom:-60,right:-60},landscape:{bottom:205,right:-330}}},nexus9:{0:{top:133,left:49},90:{top:260,left:-80},180:{top:131,left:49},270:{top:260,left:-78},rotateButtons:{width:140,height:140,portrait:{bottom:-60,right:-60},landscape:{bottom:140,right:-290}}},pixel4:{0:{top:46,left:12},90:{top:232,left:-197},180:{top:23,left:17},270:{top:236,left:-174},rotateButtons:{width:140,height:140,portrait:{bottom:-60,right:-60},landscape:{bottom:130,right:-250}}},pixel4xl:{0:{top:61,left:17},90:{top:310,left:-263},180:{top:30,left:22},270:{top:315,left:-232},rotateButtons:{width:140,height:140,portrait:{bottom:-60,right:-60},landscape:{bottom:130,right:-250}}},d450:{0:{top:46,left:12},90:{top:232,left:-167},180:{top:53,left:17},270:{top:236,left:-174},rotateButtons:{width:140,height:140,portrait:{bottom:-60,right:-60},landscape:{bottom:130,right:-250}}},g430:{0:{top:75,left:64},90:{top:254,left:-117},180:{top:73,left:64},270:{top:254,left:-115},rotateButtons:{width:140,height:140,portrait:{bottom:-60,right:-60},landscape:{bottom:205,right:-330}}},galaxytabs7:{0:{top:37,left:38},90:{top:228,left:-153},180:{top:37,left:40},270:{top:230,left:-153},rotateButtons:{width:140,height:140,portrait:{bottom:-60,right:-60},landscape:{bottom:130,right:-250}}},wearsquare:{0:{top:202,left:27},90:{top:0,left:0},180:{top:0,left:0},270:{top:0,left:0},rotateButtons:{width:140,height:140,portrait:{bottom:-60,right:-60},landscape:{bottom:130,right:-250}}},wearround:{0:{top:114,left:20},90:{top:0,left:0},180:{top:0,left:0},270:{top:0,left:0},rotateButtons:{width:140,height:140,portrait:{bottom:-60,right:-60},landscape:{bottom:130,right:-250}}},hammerhead:defaults.screenPositions.hammerhead,amazon:defaults.screenPositions.hammerhead,sam:defaults.screenPositions.hammerhead,hammerhead_persist1:defaults.screenPositions.hammerhead,flo:{0:{top:155,left:64},90:{top:334,left:-117},180:{top:153,left:64},270:{top:334,left:-115},rotateButtons:{width:140,height:140,portrait:{bottom:-60,right:-60},landscape:{bottom:205,right:-330}}},ruby:{0:{top:150,left:56},90:{top:375,left:-138},180:{top:180,left:58},270:{top:375,left:-172},rotateButtons:{width:140,height:140,portrait:{bottom:-60,right:-60},landscape:{bottom:205,right:-330}}},hercules:{0:{top:132,left:53},90:{top:293,left:-108},180:{top:132,left:52},270:{top:291,left:-108},rotateButtons:{width:140,height:140,portrait:{bottom:-60,right:-60},landscape:{bottom:190,right:-290}}}},embedTranslations:{iphone:{x:210,y:-208},ipad:{x:212,y:-210},iphone4s:{x:184,y:-180},iphone5s:{x:210,y:-208},ipodtouch7thgeneration:{x:210,y:-208},iphone6:{x:228,y:-226},iphone6plus:{x:730/3,y:-728/3},ipadair:{x:212,y:-210},iphone6s:{x:228,y:-226},iphone6splus:{x:730/3,y:-728/3},iphone7:{x:228,y:-226},iphone7plus:{x:730/3,y:-728/3},iphone8:{x:228,y:-226},iphone8plus:{x:730/3,y:-728/3},iphonex:{x:365,y:-217},iphonexs:{x:365,y:-217},iphonexsmax:{x:365,y:-240},iphone11pro:{x:365,y:-217},iphone11promax:{x:365,y:-240},ipadair2:{x:212,y:-210},nexus5:{x:200,y:-196},nexus7:{x:268,y:-272},nexus9:{x:212,y:-210},pixel4:{x:200,y:-196},pixel4xl:{x:200,y:-196},d450:{x:200,y:-196},g430:{x:268,y:-272},galaxytabs7:{x:212,y:-190},wearsquare:{x:0,y:0},wearround:{x:0,y:0},hammerhead:defaults.embedTranslations.hammerhead,flo:{x:268,y:-272},ruby:{x:268,y:-272},hercules:{x:218,y:-260}},tabletDevices:["ipad","ipadair","ipadair2","nexus7","nexus9","hammerhead","flo","ruby","amazon","sam","hammerhead_persist1"],physicalDevices:["hammerhead","flo","ruby"],watchDevices:["wearsquare","wearround"],deviceLabels:{iphone4s:"iPhone 4s",iphone5s:"iPhone 5s",ipodtouch7thgeneration:"iPod Touch 7th Gen",iphone6s:"iPhone 6s",iphone6splus:"iPhone 6s+",iphone6:"iPhone 6",iphone6plus:"iPhone 6+",iphone7:"iPhone 7",iphone7plus:"iPhone 7+",iphone8:"iPhone 8",iphone8plus:"iPhone 8+",iphonex:"iPhone X",iphonexs:"iPhone XS",iphonexsmax:"iPhone XS Max",iphone11pro:"iPhone 11 Pro",iphone11promax:"iPhone 11 Pro Max",ipadair:"iPad Air",ipadair2:"iPad Air 2",nexus5:"Nexus 5",nexus7:"Nexus 7",nexus9:"Nexus 9",pixel4:"Pixel 4",pixel4xl:"Pixel 4 XL",d450:"d450",g430:"g430",galaxytabs7:"Galaxy Tab S7",hammerhead:"Nexus 5 Physical"}},newDevices={arrowsbe:{width:360,height:640,label:"arrows Be",generic:!0},basio3:{width:360,height:640,label:"BASIO3",generic:!0},galaxys9:{width:450,height:925,label:"Galaxy S9",generic:!0},p20lite:{width:360,height:760,label:"P20 lite",generic:!0},sense2:{width:360,height:720,label:"AQUOS sense2",generic:!0}};for(var device in newDevices)appConstants.deviceLabels[device]=newDevices[device].label,appConstants.screenDimensions[device]={width:newDevices[device].width,height:newDevices[device].height},appConstants.deviceDimensions[device]={width:1.12*newDevices[device].width,height:1.12*newDevices[device].height,generic:newDevices[device].generic},appConstants.screenPositions[device]={0:{top:.05*newDevices[device].height,left:.06*newDevices[device].width},90:{top:1.12*(newDevices[device].height-newDevices[device].width)*.5+.06*newDevices[device].width,left:1.12*(newDevices[device].width-newDevices[device].height)*.5+.07*newDevices[device].height},180:{top:.07*newDevices[device].height,left:.06*newDevices[device].width},270:{top:1.12*(newDevices[device].height-newDevices[device].width)*.5+.06*newDevices[device].width,left:1.12*(newDevices[device].width-newDevices[device].height)*.5+.05*newDevices[device].height},rotateButtons:{width:newDevices[device].width/5,height:newDevices[device].width/5,portrait:{bottom:-60,right:-60},landscape:{bottom:1.12*(newDevices[device].height-newDevices[device].width)*.5-newDevices[device].width/5,right:1.12*(newDevices[device].width-newDevices[device].height)*.5-newDevices[device].width/5}}};angular.module("appetizeApp").constant("appConstants",appConstants),angular.module("appetizeApp").filter("reverse",function(){return function(items){return items&&items.length?items.slice().reverse():void 0}}).filter("adbconnectioninfo",function(){function filter(connectionInfo){if(!connectionInfo||!connectionInfo.forwards[0])return null;var returnValue=angular.copy(template);return returnValue=returnValue.replace(/SERVER_PORT/,connectionInfo.port),returnValue=returnValue.replace(/USERNAME/,connectionInfo.user),returnValue=returnValue.replace(/HOSTNAME/,connectionInfo.hostname),returnValue=returnValue.replace(/FORWARD_DESTINATION/,connectionInfo.forwards[0].destination),returnValue=returnValue.replace(/FORWARD_PORT/,connectionInfo.forwards[0].port)}var template="ssh -fN -o StrictHostKeyChecking=no -p SERVER_PORT USERNAME@HOSTNAME -L6000:FORWARD_DESTINATION:FORWARD_PORT && adb connect localhost:6000";
return filter.$stateful=!0,filter}).filter("capitalize",function(){return function(input){return input?input.charAt(0).toUpperCase()+input.substr(1).toLowerCase():""}}),angular.module("appetizeApp").directive("selectOnDblclick",["$window",function($window){return{link:function(scope,element){element.on("dblclick",function(){var selection=$window.getSelection(),range=document.createRange();range.selectNodeContents(element[0]),selection.removeAllRanges(),selection.addRange(range)})}}}]),function(){angular.module("anguFixedHeaderTable",[]).directive("fixedHeader",["$timeout",function($timeout){function link($scope,$elem,$attrs,$ctrl){function tableDataLoaded(){var firstCell=elem.querySelector("tbody tr:first-child td:first-child");return firstCell&&!firstCell.style.width}function transformTable(){angular.element(elem.querySelectorAll("thead, tbody, tfoot")).css("display",""),$timeout(function(){angular.forEach(elem.querySelectorAll("tr:first-child th"),function(thElem,i){var tdElems=elem.querySelector("tbody tr:first-child td:nth-child("+(i+1)+")"),tfElems=elem.querySelector("tfoot tr:first-child td:nth-child("+(i+1)+")"),columnWidth=tdElems?tdElems.offsetWidth:thElem.offsetWidth;tdElems&&(tdElems.style.width=columnWidth+"px"),thElem&&(thElem.style.width=columnWidth+"px"),tfElems&&(tfElems.style.width=columnWidth+"px")}),angular.element(elem.querySelectorAll("thead, tfoot")).css("display","block"),angular.element(elem.querySelectorAll("tbody")).css({display:"block",height:$attrs.tableHeight||"inherit",overflow:"auto"});var tbody=elem.querySelector("tbody"),scrollBarWidth=tbody.offsetWidth-tbody.clientWidth;if(scrollBarWidth>0){scrollBarWidth-=2;var lastColumn=elem.querySelector("tbody tr:first-child td:last-child");lastColumn.style.width=lastColumn.offsetWidth-scrollBarWidth+"px"}})}var elem=$elem[0];$scope.$watch(tableDataLoaded,function(isTableDataLoaded){isTableDataLoaded&&transformTable()})}return{restrict:"A",link:link}}])}(),function(){angular.module("appetizeApp").directive("appetizeFocus",function(){return{strict:"A",scope:!1,link:function($scope,$element){$element.trigger("focus")}}})}(),function(global,undefined){function encode(value){function prepareWrite(length){for(var newByteLength=data.byteLength,requiredLength=offset+length;requiredLength>newByteLength;)newByteLength<<=1;if(newByteLength!==data.byteLength){var oldDataView=dataView;data=new ArrayBuffer(newByteLength),dataView=new DataView(data);for(var uint32count=offset+3>>2,i=0;uint32count>i;++i)dataView.setUint32(i<<2,oldDataView.getUint32(i<<2))}return lastLength=length,dataView}function commitWrite(){offset+=lastLength}function writeFloat64(value){commitWrite(prepareWrite(8).setFloat64(offset,value))}function writeUint8(value){commitWrite(prepareWrite(1).setUint8(offset,value))}function writeUint8Array(value){for(var dataView=prepareWrite(value.length),i=0;i<value.length;++i)dataView.setUint8(offset+i,value[i]);commitWrite()}function writeUint16(value){commitWrite(prepareWrite(2).setUint16(offset,value))}function writeUint32(value){commitWrite(prepareWrite(4).setUint32(offset,value))}function writeUint64(value){var low=value%POW_2_32,high=(value-low)/POW_2_32,dataView=prepareWrite(8);dataView.setUint32(offset,high),dataView.setUint32(offset+4,low),commitWrite()}function writeTypeAndLength(type,length){24>length?writeUint8(type<<5|length):256>length?(writeUint8(type<<5|24),writeUint8(length)):65536>length?(writeUint8(type<<5|25),writeUint16(length)):4294967296>length?(writeUint8(type<<5|26),writeUint32(length)):(writeUint8(type<<5|27),writeUint64(length))}function encodeItem(value){var i;if(value===!1)return writeUint8(244);if(value===!0)return writeUint8(245);if(null===value)return writeUint8(246);if(value===undefined)return writeUint8(247);switch(typeof value){case"number":if(Math.floor(value)===value){if(value>=0&&POW_2_53>=value)return writeTypeAndLength(0,value);if(value>=-POW_2_53&&0>value)return writeTypeAndLength(1,-(value+1))}return writeUint8(251),writeFloat64(value);case"string":var utf8data=[];for(i=0;i<value.length;++i){var charCode=value.charCodeAt(i);128>charCode?utf8data.push(charCode):2048>charCode?(utf8data.push(192|charCode>>6),utf8data.push(128|63&charCode)):55296>charCode?(utf8data.push(224|charCode>>12),utf8data.push(128|charCode>>6&63),utf8data.push(128|63&charCode)):(charCode=(1023&charCode)<<10,charCode|=1023&value.charCodeAt(++i),charCode+=65536,utf8data.push(240|charCode>>18),utf8data.push(128|charCode>>12&63),utf8data.push(128|charCode>>6&63),utf8data.push(128|63&charCode))}return writeTypeAndLength(3,utf8data.length),writeUint8Array(utf8data);default:var length;if(Array.isArray(value))for(length=value.length,writeTypeAndLength(4,length),i=0;length>i;++i)encodeItem(value[i]);else if(value instanceof Uint8Array)writeTypeAndLength(2,value.length),writeUint8Array(value);else{var keys=Object.keys(value);for(length=keys.length,writeTypeAndLength(5,length),i=0;length>i;++i){var key=keys[i];encodeItem(key),encodeItem(value[key])}}}}var lastLength,data=new ArrayBuffer(256),dataView=new DataView(data),offset=0;if(encodeItem(value),"slice"in data)return data.slice(0,offset);for(var ret=new ArrayBuffer(offset),retView=new DataView(ret),i=0;offset>i;++i)retView.setUint8(i,dataView.getUint8(i));return ret}function decode(data,tagger,simpleValue){function commitRead(length,value){return offset+=length,value}function readArrayBuffer(length){return commitRead(length,new Uint8Array(data,offset,length))}function readFloat16(){var tempArrayBuffer=new ArrayBuffer(4),tempDataView=new DataView(tempArrayBuffer),value=readUint16(),sign=32768&value,exponent=31744&value,fraction=1023&value;if(31744===exponent)exponent=261120;else if(0!==exponent)exponent+=114688;else if(0!==fraction)return(sign?-1:1)*fraction*POW_2_24;return tempDataView.setUint32(0,sign<<16|exponent<<13|fraction<<13),tempDataView.getFloat32(0)}function readFloat32(){return commitRead(4,dataView.getFloat32(offset))}function readFloat64(){return commitRead(8,dataView.getFloat64(offset))}function readUint8(){return commitRead(1,dataView.getUint8(offset))}function readUint16(){return commitRead(2,dataView.getUint16(offset))}function readUint32(){return commitRead(4,dataView.getUint32(offset))}function readUint64(){return readUint32()*POW_2_32+readUint32()}function readBreak(){return 255!==dataView.getUint8(offset)?!1:(offset+=1,!0)}function readLength(additionalInformation){if(24>additionalInformation)return additionalInformation;if(24===additionalInformation)return readUint8();if(25===additionalInformation)return readUint16();if(26===additionalInformation)return readUint32();if(27===additionalInformation)return readUint64();if(31===additionalInformation)return-1;throw"Invalid length encoding"}function readIndefiniteStringLength(majorType){var initialByte=readUint8();if(255===initialByte)return-1;var length=readLength(31&initialByte);if(0>length||initialByte>>5!==majorType)throw"Invalid indefinite length element";return length}function appendUtf16Data(utf16data,length){for(var i=0;length>i;++i){var value=readUint8();128&value&&(224>value?(value=(31&value)<<6|63&readUint8(),length-=1):240>value?(value=(15&value)<<12|(63&readUint8())<<6|63&readUint8(),length-=2):(value=(15&value)<<18|(63&readUint8())<<12|(63&readUint8())<<6|63&readUint8(),length-=3)),65536>value?utf16data.push(value):(value-=65536,utf16data.push(55296|value>>10),utf16data.push(56320|1023&value))}}function decodeItem(){var i,length,initialByte=readUint8(),majorType=initialByte>>5,additionalInformation=31&initialByte;if(7===majorType)switch(additionalInformation){case 25:return readFloat16();case 26:return readFloat32();case 27:return readFloat64()}if(length=readLength(additionalInformation),0>length&&(2>majorType||majorType>6))throw"Invalid length";switch(majorType){case 0:return length;case 1:return-1-length;case 2:if(0>length){for(var elements=[],fullArrayLength=0;(length=readIndefiniteStringLength(majorType))>=0;)fullArrayLength+=length,elements.push(readArrayBuffer(length));var fullArray=new Uint8Array(fullArrayLength),fullArrayOffset=0;for(i=0;i<elements.length;++i)fullArray.set(elements[i],fullArrayOffset),fullArrayOffset+=elements[i].length;return fullArray}return readArrayBuffer(length);case 3:var utf16data=[];if(0>length)for(;(length=readIndefiniteStringLength(majorType))>=0;)appendUtf16Data(utf16data,length);else appendUtf16Data(utf16data,length);var string="";for(i=0;i<utf16data.length;i+=DECODE_CHUNK_SIZE)string+=String.fromCharCode.apply(null,utf16data.slice(i,i+DECODE_CHUNK_SIZE));return string;case 4:var retArray;if(0>length)for(retArray=[];!readBreak();)retArray.push(decodeItem());else for(retArray=new Array(length),i=0;length>i;++i)retArray[i]=decodeItem();return retArray;case 5:var retObject={};for(i=0;length>i||0>length&&!readBreak();++i){var key=decodeItem();retObject[key]=decodeItem()}return retObject;case 6:return tagger(decodeItem(),length);case 7:switch(length){case 20:return!1;case 21:return!0;case 22:return null;case 23:return undefined;default:return simpleValue(length)}}}var dataView=new DataView(data),offset=0;"function"!=typeof tagger&&(tagger=function(value){return value}),"function"!=typeof simpleValue&&(simpleValue=function(){return undefined});var ret=decodeItem();if(offset!==data.byteLength)throw"Remaining bytes";return ret}var POW_2_24=5.960464477539063e-8,POW_2_32=4294967296,POW_2_53=9007199254740992,DECODE_CHUNK_SIZE=8192,obj={encode:encode,decode:decode};"function"==typeof define&&define.amd?define("cbor/cbor",obj):"undefined"!=typeof module&&module.exports?module.exports=obj:global.CBOR||(global.CBOR=obj)}(this),function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r}()({1:[function(require,module,exports){function AppSocket(wsOrUrl,opts){if(opts=opts||{},this.isAlive=!0,this._pingInterval=5e3,this._handshakeTime=5e3,this._initialConnectTime=6e4,wsOrUrl&&"function"==typeof wsOrUrl.close){if(this.isClient=!1,this._ws=wsOrUrl,!opts.id)throw new Error("Server appsocket missing opts.id");"number"==typeof opts.pingInterval&&(this._pingInterval=opts.pingInterval),"number"==typeof opts.handshakeTime&&(this._handshakeTime=opts.handshakeTime),"number"==typeof opts.initialConnectTime&&(this._initialConnectTime=opts.initialConnectTime),this._setId(opts.id),this._attach(),this._state=2,this._startHearbeat()}else this.isClient=!0,this.url=normalizeUrl(wsOrUrl),this.opts=opts,"number"==typeof opts.pingInterval&&(this._pingInterval=opts.pingInterval),"number"==typeof opts.handshakeTime&&(this._handshakeTime=opts.handshakeTime),this.reconnection="boolean"==typeof this.opts.reconnection?this.opts.reconnection:!0,this.reconnectionAttempts="number"==typeof this.opts.reconnectionAttempts?this.opts.reconnectionAttempts:1/0,this.reconnectionDelay="number"==typeof this.opts.reconnectionDelay?this.opts.reconnectionDelay:1e4,this.reconnectionDelayMax="number"==typeof this.opts.reconnectionDelayMax?this.opts.reconnectionDelayMax:2e4,this.reconnectionDelayMin="number"==typeof this.opts.reconnectionDelayMin?this.opts.reconnectionDelayMin:3e3,this.randomizationFactor="number"==typeof this.opts.randomizationFactor?this.opts.randomizationFactor:.5,this._state=3,this._attempt=0,this.connect(),"object"==typeof window&&"function"==typeof window.addEventListener&&window.addEventListener("unload",this.close);this._sendHandshake(),AppSocket.prototype.hasOwnProperty("volatile")||Object.defineProperty(AppSocket.prototype,"volatile",{get:function(){return this._nextVolatile=!0,this}}),AppSocket.prototype.hasOwnProperty("connected")||Object.defineProperty(AppSocket.prototype,"connected",{get:function(){return 2===this._state}});var self=this;self.on("ping",function(){self.emit("pong")}),self.on("pong",function(){self.isAlive=!0})}function normalizeUrl(url){"object"==typeof window&&window.location&&window.location.href&&(url=urlUtil.resolve(window.location.href||"",url));var parsed=urlUtil.parse(url);return"http:"===parsed.protocol&&(parsed.protocol="ws:"),"https:"===parsed.protocol&&(parsed.protocol="wss:"),urlUtil.format(parsed)}var cbor,WS,EventEmitter=require("events"),urlUtil=require("url"),util=require("util");"object"==typeof window?(cbor=window.CBOR,WS=window.WebSocket):(cbor=require("cbor-sync"),WS=require("ws")),util.inherits(AppSocket,EventEmitter),module.exports=AppSocket,module.exports.events=["error","connect","disconnect"],AppSocket.prototype.connect=function(){if(this._noReconnect=!1,this.isClient&&3===this._state&&!this._ws){this._state=0,"function"==typeof WS.Server?this._ws=new WS(this.url,this.opts):(this._ws=new WS(this.url),this._ws.binaryType="arraybuffer");var self=this;this._connectTimeout=setTimeout(function(){if(self._ws)try{self._ws.close(),self._ws.terminate()}catch(err){}self._detach(),self.state=3,self._queueReconnection()},this._initialConnectTime),this._attempt++,this._setId(null),this.isAlive=!0,this._attach()}},AppSocket.prototype.disconnect=function(){if(this._noReconnect=!0,this._ws)try{this._ws.close(),this._ws.terminate()}catch(err){}},AppSocket.prototype.close=AppSocket.prototype.disconnect,AppSocket.prototype._setId=function(id){this.id=id,this.io={engine:{id:id}}},AppSocket.prototype._attach=function(){var self=this;"function"==typeof self._ws.on?(self._ws.on("open",function(){self._connected()}),self._ws.on("close",function(){self._disconnected()}),self._ws.on("message",function(message){self._message(message)}),self._ws.on("error",function(err){self._handleError(err)})):"function"==typeof self._ws.addEventListener&&(self._ws.addEventListener("open",function(){self._connected()}),self._ws.addEventListener("close",function(){self._disconnected()}),self._ws.addEventListener("message",function(message){self._message(message)}),self._ws.addEventListener("error",function(err){self._handleError(err)}))},AppSocket.prototype._detach=function(){this._ws&&("function"==typeof this._ws.removeAllListeners&&this._ws.removeAllListeners(),this._ws=null),clearInterval(this._heartbeatInterval),this._heartbeatInterval=null,this._handshakeTimeout&&(clearTimeout(this._handshakeTimeout),this._handshakeTimeout=null),this._connectTimeout&&(clearTimeout(this._connectTimeout),this._connectTimeout=null)},AppSocket.prototype._sendHandshake=function(){this.isClient||1!==this._ws.readyState||this._ws.send(cbor.encode({t:"handshake",id:this.id}))},AppSocket.prototype._connected=function(){if(this._connectTimeout&&(clearTimeout(this._connectTimeout),this._connectTimeout=null),0===this._state){this._state=1;var self=this;this._handshakeTimeout=setTimeout(function(){if(self._ws)try{self._ws.close(),self._ws.terminate()}catch(err){}self._detach(),self._state=3,self._queueReconnection()},this._handshakeTime),this._startHearbeat()}},AppSocket.prototype._startHearbeat=function(){var self=this;self._heartbeatInterval=setInterval(function(){if(!self.isAlive){try{self._ws.close(),self._ws.terminate()}catch(ignored){}return self._disconnected()}self.isAlive=!1,1===self._ws.readyState&&self.emit("ping")},self._pingInterval)},AppSocket.prototype._disconnected=function(){(1===this._state||2===this._state)&&(this._state=3,this._detach(),this.emit("disconnect"),this.reconnection&&!this._noReconnect&&this._queueReconnection())},AppSocket.prototype._handleError=function(err){try{this._ws.close(),this._ws.terminate()}catch(ignored){}this._detach(),(0===this._state||this.reconnection)&&this._queueReconnection(),this._state=3},AppSocket.prototype._queueReconnection=function(){if(!(this._attempt>=this.reconnectionAttempts)){var delay=this.reconnectionDelay*(1+2*(Math.random()-.5)*this.randomizationFactor);delay>this.reconnectionDelayMax&&(delay=this.reconnectionDelayMax),delay<this.reconnectionDelayMax&&(delay=this.reconnectionDelayMin);var self=this;setTimeout(function(){self._noReconnect||self.connect()},delay)}},AppSocket.prototype._message=function(message){try{var decoded;if(decoded=message.data?cbor.decode(message.data):cbor.decode(message),!decoded)return;if(this.isClient&&"handshake"===decoded.t){if(1!==this._state)return;return this._handshakeTimeout&&(clearTimeout(this._handshakeTimeout),this._handshakeTimeout=null),this._attempt=0,this._state=2,this._setId(decoded.id),void this.emit("connect")}if(2!==this._state)return;decoded.name&&-1===module.exports.events.indexOf(decoded.name)&&EventEmitter.prototype.emit.call(this,decoded.name,decoded.payload)}catch(err){}},AppSocket.prototype.emit=function(name,payload){return-1!==module.exports.events.indexOf(name)?void EventEmitter.prototype.emit.apply(this,arguments):void this._send(name,payload)},AppSocket.prototype._send=function(name,payload){if(this._ws&&1===this._ws.readyState&&!(this._nextVolatile&&(this._nextVolatile=!1,this._ws.bufferedAmount>100))){var encoded;encoded=payload?cbor.encode({name:name,payload:payload}):cbor.encode({name:name}),this._ws.send(encoded)}}},{"cbor-sync":3,events:7,url:14,util:18,ws:4}],2:[function(require,module,exports){window.AppSocket=require("./appsocket")},{"./appsocket":1}],3:[function(require,module,exports){(function(Buffer){!function(global,factory){"function"==typeof define&&define.amd?define([],factory):"undefined"!=typeof module&&module.exports?module.exports=factory():global.CBOR=factory()}(this,function(){var CBOR=function(){function BinaryHex(hex){this.$hex=hex}function Reader(){}function Writer(){}function readHeaderRaw(reader){var firstByte=reader.readByte(),majorType=firstByte>>5,value=31&firstByte;return{type:majorType,value:value}}function valueFromHeader(header,reader){var value=header.value;return 24>value?value:24==value?reader.readByte():25==value?reader.readUint16():26==value?reader.readUint32():27==value?reader.readUint64():31==value?null:void notImplemented("Additional info: "+value)()}function writeHeaderRaw(type,value,writer){writer.writeByte(type<<5|value)}function writeHeader(type,value,writer){var firstByte=type<<5;24>value?writer.writeByte(firstByte|value):256>value?(writer.writeByte(24|firstByte),writer.writeByte(value)):65536>value?(writer.writeByte(25|firstByte),writer.writeUint16(value)):4294967296>value?(writer.writeByte(26|firstByte),writer.writeUint32(value)):(writer.writeByte(27|firstByte),writer.writeUint64(value))}function decodeReader(reader){var header=readHeaderRaw(reader);switch(header.type){case 0:return valueFromHeader(header,reader);case 1:return-1-valueFromHeader(header,reader);case 2:return reader.readChunk(valueFromHeader(header,reader));case 3:var buffer=reader.readChunk(valueFromHeader(header,reader));return buffer.toString("utf-8");case 4:case 5:var arrayLength=valueFromHeader(header,reader),result=[];if(null!==arrayLength){5===header.type&&(arrayLength*=2);for(var i=0;arrayLength>i;i++)result[i]=decodeReader(reader)}else for(var item;(item=decodeReader(reader))!==stopCode;)result.push(item);if(5===header.type){for(var objResult={},i=0;i<result.length;i+=2)objResult[result[i]]=result[i+1];return objResult}return result;case 6:var tag=valueFromHeader(header,reader),decoder=semanticDecoders[tag],result=decodeReader(reader);return decoder?decoder(result):result;case 7:if(25===header.value)return reader.readFloat16();if(26===header.value)return reader.readFloat32();if(27===header.value)return reader.readFloat64();switch(valueFromHeader(header,reader)){case 20:return!1;case 21:return!0;case 22:return null;case 23:return void 0;case null:return stopCode;default:throw new Error("Unknown fixed value: "+header.value)}default:throw new Error("Unsupported header: "+JSON.stringify(header))}throw new Error("not implemented yet")}function encodeWriter(data,writer){for(var i=0;i<semanticEncoders.length;i++){var replacement=semanticEncoders[i].fn(data);if(void 0!==replacement)return writeHeader(6,semanticEncoders[i].tag,writer),encodeWriter(replacement,writer)}if(data&&"function"==typeof data.toCBOR&&(data=data.toCBOR()),data===!1)writeHeader(7,20,writer);else if(data===!0)writeHeader(7,21,writer);else if(null===data)writeHeader(7,22,writer);else if(void 0===data)writeHeader(7,23,writer);else if("number"==typeof data)Math.floor(data)===data&&9007199254740992>data&&data>-9007199254740992?0>data?writeHeader(1,-1-data,writer):writeHeader(0,data,writer):(writeHeaderRaw(7,27,writer),writer.writeFloat64(data));else if("string"==typeof data)writer.writeString(data,function(length){writeHeader(3,length,writer)});else if(writer.canWriteBinary(data))writer.writeBinary(data,function(length){writeHeader(2,length,writer)});else{if("object"!=typeof data)throw new Error("CBOR encoding not supported: "+data);if(api.config.useToJSON&&"function"==typeof data.toJSON&&(data=data.toJSON()),Array.isArray(data)){writeHeader(4,data.length,writer);for(var i=0;i<data.length;i++)encodeWriter(data[i],writer)}else{var keys=Object.keys(data);writeHeader(5,keys.length,writer);for(var i=0;i<keys.length;i++)encodeWriter(keys[i],writer),encodeWriter(data[keys[i]],writer)}}}function BufferReader(buffer){this.buffer=buffer,this.pos=0}function BufferWriter(stringFormat){this.byteLength=0,this.defaultBufferLength=16384,this.latestBuffer=Buffer.alloc(this.defaultBufferLength),this.latestBufferOffset=0,this.completeBuffers=[],this.stringFormat=stringFormat}function HexReader(hex){this.hex=hex,this.pos=0}function HexWriter(finalFormat){this.$hex="",this.finalFormat=finalFormat||"hex"}BinaryHex.prototype={length:function(){return this.$hex.length/2},toString:function(format){if(!format||"hex"===format||16===format)return this.$hex;if("utf-8"===format){for(var encoded="",i=0;i<this.$hex.length;i+=2)encoded+="%"+this.$hex.substring(i,i+2);return decodeURIComponent(encoded)}if("latin"===format){for(var encoded=[],i=0;i<this.$hex.length;i+=2)encoded.push(parseInt(this.$hex.substring(i,i+2),16));return String.fromCharCode.apply(String,encoded)}throw new Error("Unrecognised format: "+format)}},BinaryHex.fromLatinString=function(latinString){for(var hex="",i=0;i<latinString.length;i++){var pair=latinString.charCodeAt(i).toString(16);1===pair.length&&(pair="0"+pair),hex+=pair}return new BinaryHex(hex)},BinaryHex.fromUtf8String=function(utf8String){for(var encoded=encodeURIComponent(utf8String),hex="",i=0;i<encoded.length;i++)if("%"===encoded.charAt(i))hex+=encoded.substring(i+1,i+3),i+=2;else{var hexPair=encoded.charCodeAt(i).toString(16);hexPair.length<2&&(hexPair="0"+hexPair),hex+=hexPair}return new BinaryHex(hex)};var semanticEncoders=[],semanticDecoders={},notImplemented=function(label){return function(){throw new Error(label+" not implemented")}};Reader.prototype={peekByte:notImplemented("peekByte"),readByte:notImplemented("readByte"),readChunk:notImplemented("readChunk"),readFloat16:function(){var half=this.readUint16(),exponent=(32767&half)>>10,mantissa=1023&half,negative=32768&half;if(31===exponent)return 0===mantissa?negative?-(1/0):1/0:NaN;var magnitude=exponent?Math.pow(2,exponent-25)*(1024+mantissa):Math.pow(2,-24)*mantissa;return negative?-magnitude:magnitude},readFloat32:function(){var intValue=this.readUint32(),exponent=(2147483647&intValue)>>23,mantissa=8388607&intValue,negative=2147483648&intValue;if(255===exponent)return 0===mantissa?negative?-(1/0):1/0:NaN;var magnitude=exponent?Math.pow(2,exponent-23-127)*(8388608+mantissa):Math.pow(2,-149)*mantissa;return negative?-magnitude:magnitude},readFloat64:function(){var int1=this.readUint32(),int2=this.readUint32(),exponent=int1>>20&2047,mantissa=4294967296*(1048575&int1)+int2,negative=2147483648&int1;if(2047===exponent)return 0===mantissa?negative?-(1/0):1/0:NaN;var magnitude=exponent?Math.pow(2,exponent-52-1023)*(4503599627370496+mantissa):Math.pow(2,-1074)*mantissa;return negative?-magnitude:magnitude},readUint16:function(){return 256*this.readByte()+this.readByte()},readUint32:function(){return 65536*this.readUint16()+this.readUint16()},readUint64:function(){return 4294967296*this.readUint32()+this.readUint32()}},Writer.prototype={writeByte:notImplemented("writeByte"),result:notImplemented("result"),writeFloat16:notImplemented("writeFloat16"),writeFloat32:notImplemented("writeFloat32"),writeFloat64:notImplemented("writeFloat64"),writeUint16:function(value){this.writeByte(value>>8&255),this.writeByte(255&value)},writeUint32:function(value){this.writeUint16(value>>16&65535),this.writeUint16(65535&value)},writeUint64:function(value){if(value>=9007199254740992||-9007199254740992>=value)throw new Error("Cannot encode Uint64 of: "+value+" magnitude to big (floating point errors)");this.writeUint32(Math.floor(value/4294967296)),this.writeUint32(value%4294967296)},writeString:notImplemented("writeString"),canWriteBinary:function(chunk){return!1},writeBinary:notImplemented("writeChunk")};var stopCode=new Error,readerFunctions=[],writerFunctions=[],api={config:{useToJSON:!0},addWriter:function(format,writerFunction){"string"==typeof format?writerFunctions.push(function(f){return format===f?writerFunction(f):void 0}):writerFunctions.push(format)},addReader:function(format,readerFunction){"string"==typeof format?readerFunctions.push(function(data,f){return format===f?readerFunction(data,f):void 0}):readerFunctions.push(format)},encode:function(data,format){for(var i=0;i<writerFunctions.length;i++){var func=writerFunctions[i],writer=func(format);if(writer)return encodeWriter(data,writer),writer.result()}throw new Error("Unsupported output format: "+format)},decode:function(data,format){for(var i=0;i<readerFunctions.length;i++){var func=readerFunctions[i],reader=func(data,format);if(reader)return decodeReader(reader)}throw new Error("Unsupported input format: "+format)},addSemanticEncode:function(tag,fn){if("number"!=typeof tag||tag%1!==0||0>tag)throw new Error("Tag must be a positive integer");return semanticEncoders.push({tag:tag,fn:fn}),this},addSemanticDecode:function(tag,fn){if("number"!=typeof tag||tag%1!==0||0>tag)throw new Error("Tag must be a positive integer");return semanticDecoders[tag]=fn,this},Reader:Reader,Writer:Writer};return BufferReader.prototype=Object.create(Reader.prototype),BufferReader.prototype.peekByte=function(){return this.buffer[this.pos]},BufferReader.prototype.readByte=function(){return this.buffer[this.pos++]},BufferReader.prototype.readUint16=function(){var result=this.buffer.readUInt16BE(this.pos);return this.pos+=2,result},BufferReader.prototype.readUint32=function(){var result=this.buffer.readUInt32BE(this.pos);return this.pos+=4,result},BufferReader.prototype.readFloat32=function(){var result=this.buffer.readFloatBE(this.pos);return this.pos+=4,result},BufferReader.prototype.readFloat64=function(){var result=this.buffer.readDoubleBE(this.pos);return this.pos+=8,result},BufferReader.prototype.readChunk=function(length){var result=Buffer.alloc(length);return this.buffer.copy(result,0,this.pos,this.pos+=length),result},BufferWriter.prototype=Object.create(Writer.prototype),BufferWriter.prototype.writeByte=function(value){this.latestBuffer[this.latestBufferOffset++]=value,this.latestBufferOffset>=this.latestBuffer.length&&(this.completeBuffers.push(this.latestBuffer),this.latestBuffer=Buffer.alloc(this.defaultBufferLength),this.latestBufferOffset=0),this.byteLength++},BufferWriter.prototype.writeFloat32=function(value){var buffer=Buffer.alloc(4);buffer.writeFloatBE(value,0),this.writeBuffer(buffer)},BufferWriter.prototype.writeFloat64=function(value){var buffer=Buffer.alloc(8);buffer.writeDoubleBE(value,0),this.writeBuffer(buffer)},BufferWriter.prototype.writeString=function(string,lengthFunc){var buffer=Buffer.from(string,"utf-8");lengthFunc(buffer.length),this.writeBuffer(buffer)},BufferWriter.prototype.canWriteBinary=function(data){return data instanceof Buffer},BufferWriter.prototype.writeBinary=function(buffer,lengthFunc){lengthFunc(buffer.length),this.writeBuffer(buffer)},BufferWriter.prototype.writeBuffer=function(chunk){if(!(chunk instanceof Buffer))throw new TypeError("BufferWriter only accepts Buffers");this.latestBufferOffset?this.latestBuffer.length-this.latestBufferOffset>=chunk.length?(chunk.copy(this.latestBuffer,this.latestBufferOffset),this.latestBufferOffset+=chunk.length,this.latestBufferOffset>=this.latestBuffer.length&&(this.completeBuffers.push(this.latestBuffer),this.latestBuffer=Buffer.alloc(this.defaultBufferLength),this.latestBufferOffset=0)):(this.completeBuffers.push(this.latestBuffer.slice(0,this.latestBufferOffset)),this.completeBuffers.push(chunk),this.latestBuffer=Buffer.alloc(this.defaultBufferLength),this.latestBufferOffset=0):this.completeBuffers.push(chunk),this.byteLength+=chunk.length},BufferWriter.prototype.result=function(){for(var result=Buffer.alloc(this.byteLength),offset=0,i=0;i<this.completeBuffers.length;i++){var buffer=this.completeBuffers[i];buffer.copy(result,offset,0,buffer.length),offset+=buffer.length}return this.latestBufferOffset&&this.latestBuffer.copy(result,offset,0,this.latestBufferOffset),this.stringFormat?result.toString(this.stringFormat):result},"function"==typeof Buffer&&(api.addReader(function(data,format){if(data instanceof Buffer)return new BufferReader(data);if("hex"===format||"base64"===format){var buffer=Buffer.from(data,format);return new BufferReader(buffer)}}),api.addWriter(function(format){return format&&"buffer"!==format?"hex"===format||"base64"===format?new BufferWriter(format):void 0:new BufferWriter})),HexReader.prototype=Object.create(Reader.prototype),HexReader.prototype.peekByte=function(){var pair=this.hex.substring(this.pos,2);return parseInt(pair,16)},HexReader.prototype.readByte=function(){var pair=this.hex.substring(this.pos,this.pos+2);return this.pos+=2,parseInt(pair,16)},HexReader.prototype.readChunk=function(length){var hex=this.hex.substring(this.pos,this.pos+2*length);return this.pos+=2*length,"function"==typeof Buffer?Buffer.from(hex,"hex"):new BinaryHex(hex)},HexWriter.prototype=Object.create(Writer.prototype),HexWriter.prototype.writeByte=function(value){if(0>value||value>255)throw new Error("Byte value out of range: "+value);var hex=value.toString(16);1==hex.length&&(hex="0"+hex),this.$hex+=hex},HexWriter.prototype.canWriteBinary=function(chunk){return chunk instanceof BinaryHex||"function"==typeof Buffer&&chunk instanceof Buffer},HexWriter.prototype.writeBinary=function(chunk,lengthFunction){if(chunk instanceof BinaryHex)lengthFunction(chunk.length()),this.$hex+=chunk.$hex;else{if(!("function"==typeof Buffer&&chunk instanceof Buffer))throw new TypeError("HexWriter only accepts BinaryHex or Buffers");lengthFunction(chunk.length),this.$hex+=chunk.toString("hex")}},HexWriter.prototype.result=function(){return"buffer"===this.finalFormat&&"function"==typeof Buffer?Buffer.from(this.$hex,"hex"):new BinaryHex(this.$hex).toString(this.finalFormat)},HexWriter.prototype.writeString=function(string,lengthFunction){var buffer=BinaryHex.fromUtf8String(string);lengthFunction(buffer.length()),this.$hex+=buffer.$hex},api.addReader(function(data,format){return data instanceof BinaryHex||data.$hex?new HexReader(data.$hex):"hex"===format?new HexReader(data):void 0}),api.addWriter(function(format){return"hex"===format?new HexWriter:void 0}),api}();return CBOR.addSemanticEncode(0,function(data){return data instanceof Date?data.toISOString():void 0}).addSemanticDecode(0,function(isoString){return new Date(isoString)}).addSemanticDecode(1,function(isoString){return new Date(isoString)}),CBOR})}).call(this,require("buffer").Buffer)},{buffer:6}],4:[function(require,module,exports){module.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},{}],5:[function(require,module,exports){function getLens(b64){var len=b64.length;if(len%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var validLen=b64.indexOf("=");
-1===validLen&&(validLen=len);var placeHoldersLen=validLen===len?0:4-validLen%4;return[validLen,placeHoldersLen]}function byteLength(b64){var lens=getLens(b64),validLen=lens[0],placeHoldersLen=lens[1];return 3*(validLen+placeHoldersLen)/4-placeHoldersLen}function _byteLength(b64,validLen,placeHoldersLen){return 3*(validLen+placeHoldersLen)/4-placeHoldersLen}function toByteArray(b64){var tmp,i,lens=getLens(b64),validLen=lens[0],placeHoldersLen=lens[1],arr=new Arr(_byteLength(b64,validLen,placeHoldersLen)),curByte=0,len=placeHoldersLen>0?validLen-4:validLen;for(i=0;len>i;i+=4)tmp=revLookup[b64.charCodeAt(i)]<<18|revLookup[b64.charCodeAt(i+1)]<<12|revLookup[b64.charCodeAt(i+2)]<<6|revLookup[b64.charCodeAt(i+3)],arr[curByte++]=tmp>>16&255,arr[curByte++]=tmp>>8&255,arr[curByte++]=255&tmp;return 2===placeHoldersLen&&(tmp=revLookup[b64.charCodeAt(i)]<<2|revLookup[b64.charCodeAt(i+1)]>>4,arr[curByte++]=255&tmp),1===placeHoldersLen&&(tmp=revLookup[b64.charCodeAt(i)]<<10|revLookup[b64.charCodeAt(i+1)]<<4|revLookup[b64.charCodeAt(i+2)]>>2,arr[curByte++]=tmp>>8&255,arr[curByte++]=255&tmp),arr}function tripletToBase64(num){return lookup[num>>18&63]+lookup[num>>12&63]+lookup[num>>6&63]+lookup[63&num]}function encodeChunk(uint8,start,end){for(var tmp,output=[],i=start;end>i;i+=3)tmp=(uint8[i]<<16&16711680)+(uint8[i+1]<<8&65280)+(255&uint8[i+2]),output.push(tripletToBase64(tmp));return output.join("")}function fromByteArray(uint8){for(var tmp,len=uint8.length,extraBytes=len%3,parts=[],maxChunkLength=16383,i=0,len2=len-extraBytes;len2>i;i+=maxChunkLength)parts.push(encodeChunk(uint8,i,i+maxChunkLength>len2?len2:i+maxChunkLength));return 1===extraBytes?(tmp=uint8[len-1],parts.push(lookup[tmp>>2]+lookup[tmp<<4&63]+"==")):2===extraBytes&&(tmp=(uint8[len-2]<<8)+uint8[len-1],parts.push(lookup[tmp>>10]+lookup[tmp>>4&63]+lookup[tmp<<2&63]+"=")),parts.join("")}exports.byteLength=byteLength,exports.toByteArray=toByteArray,exports.fromByteArray=fromByteArray;for(var lookup=[],revLookup=[],Arr="undefined"!=typeof Uint8Array?Uint8Array:Array,code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=0,len=code.length;len>i;++i)lookup[i]=code[i],revLookup[code.charCodeAt(i)]=i;revLookup["-".charCodeAt(0)]=62,revLookup["_".charCodeAt(0)]=63},{}],6:[function(require,module,exports){(function(Buffer){function typedArraySupport(){try{var arr=new Uint8Array(1);return arr.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===arr.foo()}catch(e){return!1}}function createBuffer(length){if(length>K_MAX_LENGTH)throw new RangeError('The value "'+length+'" is invalid for option "size"');var buf=new Uint8Array(length);return buf.__proto__=Buffer.prototype,buf}function Buffer(arg,encodingOrOffset,length){if("number"==typeof arg){if("string"==typeof encodingOrOffset)throw new TypeError('The "string" argument must be of type string. Received type number');return allocUnsafe(arg)}return from(arg,encodingOrOffset,length)}function from(value,encodingOrOffset,length){if("string"==typeof value)return fromString(value,encodingOrOffset);if(ArrayBuffer.isView(value))return fromArrayLike(value);if(null==value)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof value);if(isInstance(value,ArrayBuffer)||value&&isInstance(value.buffer,ArrayBuffer))return fromArrayBuffer(value,encodingOrOffset,length);if("number"==typeof value)throw new TypeError('The "value" argument must not be of type number. Received type number');var valueOf=value.valueOf&&value.valueOf();if(null!=valueOf&&valueOf!==value)return Buffer.from(valueOf,encodingOrOffset,length);var b=fromObject(value);if(b)return b;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof value[Symbol.toPrimitive])return Buffer.from(value[Symbol.toPrimitive]("string"),encodingOrOffset,length);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof value)}function assertSize(size){if("number"!=typeof size)throw new TypeError('"size" argument must be of type number');if(0>size)throw new RangeError('The value "'+size+'" is invalid for option "size"')}function alloc(size,fill,encoding){return assertSize(size),0>=size?createBuffer(size):void 0!==fill?"string"==typeof encoding?createBuffer(size).fill(fill,encoding):createBuffer(size).fill(fill):createBuffer(size)}function allocUnsafe(size){return assertSize(size),createBuffer(0>size?0:0|checked(size))}function fromString(string,encoding){if(("string"!=typeof encoding||""===encoding)&&(encoding="utf8"),!Buffer.isEncoding(encoding))throw new TypeError("Unknown encoding: "+encoding);var length=0|byteLength(string,encoding),buf=createBuffer(length),actual=buf.write(string,encoding);return actual!==length&&(buf=buf.slice(0,actual)),buf}function fromArrayLike(array){for(var length=array.length<0?0:0|checked(array.length),buf=createBuffer(length),i=0;length>i;i+=1)buf[i]=255&array[i];return buf}function fromArrayBuffer(array,byteOffset,length){if(0>byteOffset||array.byteLength<byteOffset)throw new RangeError('"offset" is outside of buffer bounds');if(array.byteLength<byteOffset+(length||0))throw new RangeError('"length" is outside of buffer bounds');var buf;return buf=void 0===byteOffset&&void 0===length?new Uint8Array(array):void 0===length?new Uint8Array(array,byteOffset):new Uint8Array(array,byteOffset,length),buf.__proto__=Buffer.prototype,buf}function fromObject(obj){if(Buffer.isBuffer(obj)){var len=0|checked(obj.length),buf=createBuffer(len);return 0===buf.length?buf:(obj.copy(buf,0,0,len),buf)}return void 0!==obj.length?"number"!=typeof obj.length||numberIsNaN(obj.length)?createBuffer(0):fromArrayLike(obj):"Buffer"===obj.type&&Array.isArray(obj.data)?fromArrayLike(obj.data):void 0}function checked(length){if(length>=K_MAX_LENGTH)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+K_MAX_LENGTH.toString(16)+" bytes");return 0|length}function SlowBuffer(length){return+length!=length&&(length=0),Buffer.alloc(+length)}function byteLength(string,encoding){if(Buffer.isBuffer(string))return string.length;if(ArrayBuffer.isView(string)||isInstance(string,ArrayBuffer))return string.byteLength;if("string"!=typeof string)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof string);var len=string.length,mustMatch=arguments.length>2&&arguments[2]===!0;if(!mustMatch&&0===len)return 0;for(var loweredCase=!1;;)switch(encoding){case"ascii":case"latin1":case"binary":return len;case"utf8":case"utf-8":return utf8ToBytes(string).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*len;case"hex":return len>>>1;case"base64":return base64ToBytes(string).length;default:if(loweredCase)return mustMatch?-1:utf8ToBytes(string).length;encoding=(""+encoding).toLowerCase(),loweredCase=!0}}function slowToString(encoding,start,end){var loweredCase=!1;if((void 0===start||0>start)&&(start=0),start>this.length)return"";if((void 0===end||end>this.length)&&(end=this.length),0>=end)return"";if(end>>>=0,start>>>=0,start>=end)return"";for(encoding||(encoding="utf8");;)switch(encoding){case"hex":return hexSlice(this,start,end);case"utf8":case"utf-8":return utf8Slice(this,start,end);case"ascii":return asciiSlice(this,start,end);case"latin1":case"binary":return latin1Slice(this,start,end);case"base64":return base64Slice(this,start,end);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,start,end);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(encoding+"").toLowerCase(),loweredCase=!0}}function swap(b,n,m){var i=b[n];b[n]=b[m],b[m]=i}function bidirectionalIndexOf(buffer,val,byteOffset,encoding,dir){if(0===buffer.length)return-1;if("string"==typeof byteOffset?(encoding=byteOffset,byteOffset=0):byteOffset>2147483647?byteOffset=2147483647:-2147483648>byteOffset&&(byteOffset=-2147483648),byteOffset=+byteOffset,numberIsNaN(byteOffset)&&(byteOffset=dir?0:buffer.length-1),0>byteOffset&&(byteOffset=buffer.length+byteOffset),byteOffset>=buffer.length){if(dir)return-1;byteOffset=buffer.length-1}else if(0>byteOffset){if(!dir)return-1;byteOffset=0}if("string"==typeof val&&(val=Buffer.from(val,encoding)),Buffer.isBuffer(val))return 0===val.length?-1:arrayIndexOf(buffer,val,byteOffset,encoding,dir);if("number"==typeof val)return val=255&val,"function"==typeof Uint8Array.prototype.indexOf?dir?Uint8Array.prototype.indexOf.call(buffer,val,byteOffset):Uint8Array.prototype.lastIndexOf.call(buffer,val,byteOffset):arrayIndexOf(buffer,[val],byteOffset,encoding,dir);throw new TypeError("val must be string, number or Buffer")}function arrayIndexOf(arr,val,byteOffset,encoding,dir){function read(buf,i){return 1===indexSize?buf[i]:buf.readUInt16BE(i*indexSize)}var indexSize=1,arrLength=arr.length,valLength=val.length;if(void 0!==encoding&&(encoding=String(encoding).toLowerCase(),"ucs2"===encoding||"ucs-2"===encoding||"utf16le"===encoding||"utf-16le"===encoding)){if(arr.length<2||val.length<2)return-1;indexSize=2,arrLength/=2,valLength/=2,byteOffset/=2}var i;if(dir){var foundIndex=-1;for(i=byteOffset;arrLength>i;i++)if(read(arr,i)===read(val,-1===foundIndex?0:i-foundIndex)){if(-1===foundIndex&&(foundIndex=i),i-foundIndex+1===valLength)return foundIndex*indexSize}else-1!==foundIndex&&(i-=i-foundIndex),foundIndex=-1}else for(byteOffset+valLength>arrLength&&(byteOffset=arrLength-valLength),i=byteOffset;i>=0;i--){for(var found=!0,j=0;valLength>j;j++)if(read(arr,i+j)!==read(val,j)){found=!1;break}if(found)return i}return-1}function hexWrite(buf,string,offset,length){offset=Number(offset)||0;var remaining=buf.length-offset;length?(length=Number(length),length>remaining&&(length=remaining)):length=remaining;var strLen=string.length;length>strLen/2&&(length=strLen/2);for(var i=0;length>i;++i){var parsed=parseInt(string.substr(2*i,2),16);if(numberIsNaN(parsed))return i;buf[offset+i]=parsed}return i}function utf8Write(buf,string,offset,length){return blitBuffer(utf8ToBytes(string,buf.length-offset),buf,offset,length)}function asciiWrite(buf,string,offset,length){return blitBuffer(asciiToBytes(string),buf,offset,length)}function latin1Write(buf,string,offset,length){return asciiWrite(buf,string,offset,length)}function base64Write(buf,string,offset,length){return blitBuffer(base64ToBytes(string),buf,offset,length)}function ucs2Write(buf,string,offset,length){return blitBuffer(utf16leToBytes(string,buf.length-offset),buf,offset,length)}function base64Slice(buf,start,end){return 0===start&&end===buf.length?base64.fromByteArray(buf):base64.fromByteArray(buf.slice(start,end))}function utf8Slice(buf,start,end){end=Math.min(buf.length,end);for(var res=[],i=start;end>i;){var firstByte=buf[i],codePoint=null,bytesPerSequence=firstByte>239?4:firstByte>223?3:firstByte>191?2:1;if(end>=i+bytesPerSequence){var secondByte,thirdByte,fourthByte,tempCodePoint;switch(bytesPerSequence){case 1:128>firstByte&&(codePoint=firstByte);break;case 2:secondByte=buf[i+1],128===(192&secondByte)&&(tempCodePoint=(31&firstByte)<<6|63&secondByte,tempCodePoint>127&&(codePoint=tempCodePoint));break;case 3:secondByte=buf[i+1],thirdByte=buf[i+2],128===(192&secondByte)&&128===(192&thirdByte)&&(tempCodePoint=(15&firstByte)<<12|(63&secondByte)<<6|63&thirdByte,tempCodePoint>2047&&(55296>tempCodePoint||tempCodePoint>57343)&&(codePoint=tempCodePoint));break;case 4:secondByte=buf[i+1],thirdByte=buf[i+2],fourthByte=buf[i+3],128===(192&secondByte)&&128===(192&thirdByte)&&128===(192&fourthByte)&&(tempCodePoint=(15&firstByte)<<18|(63&secondByte)<<12|(63&thirdByte)<<6|63&fourthByte,tempCodePoint>65535&&1114112>tempCodePoint&&(codePoint=tempCodePoint))}}null===codePoint?(codePoint=65533,bytesPerSequence=1):codePoint>65535&&(codePoint-=65536,res.push(codePoint>>>10&1023|55296),codePoint=56320|1023&codePoint),res.push(codePoint),i+=bytesPerSequence}return decodeCodePointsArray(res)}function decodeCodePointsArray(codePoints){var len=codePoints.length;if(MAX_ARGUMENTS_LENGTH>=len)return String.fromCharCode.apply(String,codePoints);for(var res="",i=0;len>i;)res+=String.fromCharCode.apply(String,codePoints.slice(i,i+=MAX_ARGUMENTS_LENGTH));return res}function asciiSlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;end>i;++i)ret+=String.fromCharCode(127&buf[i]);return ret}function latin1Slice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;end>i;++i)ret+=String.fromCharCode(buf[i]);return ret}function hexSlice(buf,start,end){var len=buf.length;(!start||0>start)&&(start=0),(!end||0>end||end>len)&&(end=len);for(var out="",i=start;end>i;++i)out+=toHex(buf[i]);return out}function utf16leSlice(buf,start,end){for(var bytes=buf.slice(start,end),res="",i=0;i<bytes.length;i+=2)res+=String.fromCharCode(bytes[i]+256*bytes[i+1]);return res}function checkOffset(offset,ext,length){if(offset%1!==0||0>offset)throw new RangeError("offset is not uint");if(offset+ext>length)throw new RangeError("Trying to access beyond buffer length")}function checkInt(buf,value,offset,ext,max,min){if(!Buffer.isBuffer(buf))throw new TypeError('"buffer" argument must be a Buffer instance');if(value>max||min>value)throw new RangeError('"value" argument is out of bounds');if(offset+ext>buf.length)throw new RangeError("Index out of range")}function checkIEEE754(buf,value,offset,ext,max,min){if(offset+ext>buf.length)throw new RangeError("Index out of range");if(0>offset)throw new RangeError("Index out of range")}function writeFloat(buf,value,offset,littleEndian,noAssert){return value=+value,offset>>>=0,noAssert||checkIEEE754(buf,value,offset,4,3.4028234663852886e38,-3.4028234663852886e38),ieee754.write(buf,value,offset,littleEndian,23,4),offset+4}function writeDouble(buf,value,offset,littleEndian,noAssert){return value=+value,offset>>>=0,noAssert||checkIEEE754(buf,value,offset,8,1.7976931348623157e308,-1.7976931348623157e308),ieee754.write(buf,value,offset,littleEndian,52,8),offset+8}function base64clean(str){if(str=str.split("=")[0],str=str.trim().replace(INVALID_BASE64_RE,""),str.length<2)return"";for(;str.length%4!==0;)str+="=";return str}function toHex(n){return 16>n?"0"+n.toString(16):n.toString(16)}function utf8ToBytes(string,units){units=units||1/0;for(var codePoint,length=string.length,leadSurrogate=null,bytes=[],i=0;length>i;++i){if(codePoint=string.charCodeAt(i),codePoint>55295&&57344>codePoint){if(!leadSurrogate){if(codePoint>56319){(units-=3)>-1&&bytes.push(239,191,189);continue}if(i+1===length){(units-=3)>-1&&bytes.push(239,191,189);continue}leadSurrogate=codePoint;continue}if(56320>codePoint){(units-=3)>-1&&bytes.push(239,191,189),leadSurrogate=codePoint;continue}codePoint=(leadSurrogate-55296<<10|codePoint-56320)+65536}else leadSurrogate&&(units-=3)>-1&&bytes.push(239,191,189);if(leadSurrogate=null,128>codePoint){if((units-=1)<0)break;bytes.push(codePoint)}else if(2048>codePoint){if((units-=2)<0)break;bytes.push(codePoint>>6|192,63&codePoint|128)}else if(65536>codePoint){if((units-=3)<0)break;bytes.push(codePoint>>12|224,codePoint>>6&63|128,63&codePoint|128)}else{if(!(1114112>codePoint))throw new Error("Invalid code point");if((units-=4)<0)break;bytes.push(codePoint>>18|240,codePoint>>12&63|128,codePoint>>6&63|128,63&codePoint|128)}}return bytes}function asciiToBytes(str){for(var byteArray=[],i=0;i<str.length;++i)byteArray.push(255&str.charCodeAt(i));return byteArray}function utf16leToBytes(str,units){for(var c,hi,lo,byteArray=[],i=0;i<str.length&&!((units-=2)<0);++i)c=str.charCodeAt(i),hi=c>>8,lo=c%256,byteArray.push(lo),byteArray.push(hi);return byteArray}function base64ToBytes(str){return base64.toByteArray(base64clean(str))}function blitBuffer(src,dst,offset,length){for(var i=0;length>i&&!(i+offset>=dst.length||i>=src.length);++i)dst[i+offset]=src[i];return i}function isInstance(obj,type){return obj instanceof type||null!=obj&&null!=obj.constructor&&null!=obj.constructor.name&&obj.constructor.name===type.name}function numberIsNaN(obj){return obj!==obj}var base64=require("base64-js"),ieee754=require("ieee754");exports.Buffer=Buffer,exports.SlowBuffer=SlowBuffer,exports.INSPECT_MAX_BYTES=50;var K_MAX_LENGTH=2147483647;exports.kMaxLength=K_MAX_LENGTH,Buffer.TYPED_ARRAY_SUPPORT=typedArraySupport(),Buffer.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(Buffer.prototype,"parent",{enumerable:!0,get:function(){return Buffer.isBuffer(this)?this.buffer:void 0}}),Object.defineProperty(Buffer.prototype,"offset",{enumerable:!0,get:function(){return Buffer.isBuffer(this)?this.byteOffset:void 0}}),"undefined"!=typeof Symbol&&null!=Symbol.species&&Buffer[Symbol.species]===Buffer&&Object.defineProperty(Buffer,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),Buffer.poolSize=8192,Buffer.from=function(value,encodingOrOffset,length){return from(value,encodingOrOffset,length)},Buffer.prototype.__proto__=Uint8Array.prototype,Buffer.__proto__=Uint8Array,Buffer.alloc=function(size,fill,encoding){return alloc(size,fill,encoding)},Buffer.allocUnsafe=function(size){return allocUnsafe(size)},Buffer.allocUnsafeSlow=function(size){return allocUnsafe(size)},Buffer.isBuffer=function(b){return null!=b&&b._isBuffer===!0&&b!==Buffer.prototype},Buffer.compare=function(a,b){if(isInstance(a,Uint8Array)&&(a=Buffer.from(a,a.offset,a.byteLength)),isInstance(b,Uint8Array)&&(b=Buffer.from(b,b.offset,b.byteLength)),!Buffer.isBuffer(a)||!Buffer.isBuffer(b))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(a===b)return 0;for(var x=a.length,y=b.length,i=0,len=Math.min(x,y);len>i;++i)if(a[i]!==b[i]){x=a[i],y=b[i];break}return y>x?-1:x>y?1:0},Buffer.isEncoding=function(encoding){switch(String(encoding).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Buffer.concat=function(list,length){if(!Array.isArray(list))throw new TypeError('"list" argument must be an Array of Buffers');if(0===list.length)return Buffer.alloc(0);var i;if(void 0===length)for(length=0,i=0;i<list.length;++i)length+=list[i].length;var buffer=Buffer.allocUnsafe(length),pos=0;for(i=0;i<list.length;++i){var buf=list[i];if(isInstance(buf,Uint8Array)&&(buf=Buffer.from(buf)),!Buffer.isBuffer(buf))throw new TypeError('"list" argument must be an Array of Buffers');buf.copy(buffer,pos),pos+=buf.length}return buffer},Buffer.byteLength=byteLength,Buffer.prototype._isBuffer=!0,Buffer.prototype.swap16=function(){var len=this.length;if(len%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var i=0;len>i;i+=2)swap(this,i,i+1);return this},Buffer.prototype.swap32=function(){var len=this.length;if(len%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var i=0;len>i;i+=4)swap(this,i,i+3),swap(this,i+1,i+2);return this},Buffer.prototype.swap64=function(){var len=this.length;if(len%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var i=0;len>i;i+=8)swap(this,i,i+7),swap(this,i+1,i+6),swap(this,i+2,i+5),swap(this,i+3,i+4);return this},Buffer.prototype.toString=function(){var length=this.length;return 0===length?"":0===arguments.length?utf8Slice(this,0,length):slowToString.apply(this,arguments)},Buffer.prototype.toLocaleString=Buffer.prototype.toString,Buffer.prototype.equals=function(b){if(!Buffer.isBuffer(b))throw new TypeError("Argument must be a Buffer");return this===b?!0:0===Buffer.compare(this,b)},Buffer.prototype.inspect=function(){var str="",max=exports.INSPECT_MAX_BYTES;return str=this.toString("hex",0,max).replace(/(.{2})/g,"$1 ").trim(),this.length>max&&(str+=" ... "),"<Buffer "+str+">"},Buffer.prototype.compare=function(target,start,end,thisStart,thisEnd){if(isInstance(target,Uint8Array)&&(target=Buffer.from(target,target.offset,target.byteLength)),!Buffer.isBuffer(target))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof target);if(void 0===start&&(start=0),void 0===end&&(end=target?target.length:0),void 0===thisStart&&(thisStart=0),void 0===thisEnd&&(thisEnd=this.length),0>start||end>target.length||0>thisStart||thisEnd>this.length)throw new RangeError("out of range index");if(thisStart>=thisEnd&&start>=end)return 0;if(thisStart>=thisEnd)return-1;if(start>=end)return 1;if(start>>>=0,end>>>=0,thisStart>>>=0,thisEnd>>>=0,this===target)return 0;for(var x=thisEnd-thisStart,y=end-start,len=Math.min(x,y),thisCopy=this.slice(thisStart,thisEnd),targetCopy=target.slice(start,end),i=0;len>i;++i)if(thisCopy[i]!==targetCopy[i]){x=thisCopy[i],y=targetCopy[i];break}return y>x?-1:x>y?1:0},Buffer.prototype.includes=function(val,byteOffset,encoding){return-1!==this.indexOf(val,byteOffset,encoding)},Buffer.prototype.indexOf=function(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,!0)},Buffer.prototype.lastIndexOf=function(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,!1)},Buffer.prototype.write=function(string,offset,length,encoding){if(void 0===offset)encoding="utf8",length=this.length,offset=0;else if(void 0===length&&"string"==typeof offset)encoding=offset,length=this.length,offset=0;else{if(!isFinite(offset))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");offset>>>=0,isFinite(length)?(length>>>=0,void 0===encoding&&(encoding="utf8")):(encoding=length,length=void 0)}var remaining=this.length-offset;if((void 0===length||length>remaining)&&(length=remaining),string.length>0&&(0>length||0>offset)||offset>this.length)throw new RangeError("Attempt to write outside buffer bounds");encoding||(encoding="utf8");for(var loweredCase=!1;;)switch(encoding){case"hex":return hexWrite(this,string,offset,length);case"utf8":case"utf-8":return utf8Write(this,string,offset,length);case"ascii":return asciiWrite(this,string,offset,length);case"latin1":case"binary":return latin1Write(this,string,offset,length);case"base64":return base64Write(this,string,offset,length);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,string,offset,length);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(""+encoding).toLowerCase(),loweredCase=!0}},Buffer.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var MAX_ARGUMENTS_LENGTH=4096;Buffer.prototype.slice=function(start,end){var len=this.length;start=~~start,end=void 0===end?len:~~end,0>start?(start+=len,0>start&&(start=0)):start>len&&(start=len),0>end?(end+=len,0>end&&(end=0)):end>len&&(end=len),start>end&&(end=start);var newBuf=this.subarray(start,end);return newBuf.__proto__=Buffer.prototype,newBuf},Buffer.prototype.readUIntLE=function(offset,byteLength,noAssert){offset>>>=0,byteLength>>>=0,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset],mul=1,i=0;++i<byteLength&&(mul*=256);)val+=this[offset+i]*mul;return val},Buffer.prototype.readUIntBE=function(offset,byteLength,noAssert){offset>>>=0,byteLength>>>=0,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset+--byteLength],mul=1;byteLength>0&&(mul*=256);)val+=this[offset+--byteLength]*mul;return val},Buffer.prototype.readUInt8=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,1,this.length),this[offset]},Buffer.prototype.readUInt16LE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,2,this.length),this[offset]|this[offset+1]<<8},Buffer.prototype.readUInt16BE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,2,this.length),this[offset]<<8|this[offset+1]},Buffer.prototype.readUInt32LE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),(this[offset]|this[offset+1]<<8|this[offset+2]<<16)+16777216*this[offset+3]},Buffer.prototype.readUInt32BE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),16777216*this[offset]+(this[offset+1]<<16|this[offset+2]<<8|this[offset+3])},Buffer.prototype.readIntLE=function(offset,byteLength,noAssert){offset>>>=0,byteLength>>>=0,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset],mul=1,i=0;++i<byteLength&&(mul*=256);)val+=this[offset+i]*mul;return mul*=128,val>=mul&&(val-=Math.pow(2,8*byteLength)),val},Buffer.prototype.readIntBE=function(offset,byteLength,noAssert){offset>>>=0,byteLength>>>=0,noAssert||checkOffset(offset,byteLength,this.length);for(var i=byteLength,mul=1,val=this[offset+--i];i>0&&(mul*=256);)val+=this[offset+--i]*mul;return mul*=128,val>=mul&&(val-=Math.pow(2,8*byteLength)),val},Buffer.prototype.readInt8=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,1,this.length),128&this[offset]?-1*(255-this[offset]+1):this[offset]},Buffer.prototype.readInt16LE=function(offset,noAssert){offset>>>=0,noAssert||checkOffset(offset,2,this.length);var val=this[offset]|this[offset+1]<<8;return 32768&val?4294901760|val:val},Buffer.prototype.readInt16BE=function(offset,noAssert){offset>>>=0,noAssert||checkOffset(offset,2,this.length);var val=this[offset+1]|this[offset]<<8;return 32768&val?4294901760|val:val},Buffer.prototype.readInt32LE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),this[offset]|this[offset+1]<<8|this[offset+2]<<16|this[offset+3]<<24},Buffer.prototype.readInt32BE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),this[offset]<<24|this[offset+1]<<16|this[offset+2]<<8|this[offset+3]},Buffer.prototype.readFloatLE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),ieee754.read(this,offset,!0,23,4)},Buffer.prototype.readFloatBE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),ieee754.read(this,offset,!1,23,4)},Buffer.prototype.readDoubleLE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,8,this.length),ieee754.read(this,offset,!0,52,8)},Buffer.prototype.readDoubleBE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,8,this.length),ieee754.read(this,offset,!1,52,8)},Buffer.prototype.writeUIntLE=function(value,offset,byteLength,noAssert){if(value=+value,offset>>>=0,byteLength>>>=0,!noAssert){var maxBytes=Math.pow(2,8*byteLength)-1;checkInt(this,value,offset,byteLength,maxBytes,0)}var mul=1,i=0;for(this[offset]=255&value;++i<byteLength&&(mul*=256);)this[offset+i]=value/mul&255;return offset+byteLength},Buffer.prototype.writeUIntBE=function(value,offset,byteLength,noAssert){if(value=+value,offset>>>=0,byteLength>>>=0,!noAssert){var maxBytes=Math.pow(2,8*byteLength)-1;checkInt(this,value,offset,byteLength,maxBytes,0)}var i=byteLength-1,mul=1;for(this[offset+i]=255&value;--i>=0&&(mul*=256);)this[offset+i]=value/mul&255;return offset+byteLength},Buffer.prototype.writeUInt8=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,1,255,0),this[offset]=255&value,offset+1},Buffer.prototype.writeUInt16LE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,2,65535,0),this[offset]=255&value,this[offset+1]=value>>>8,offset+2},Buffer.prototype.writeUInt16BE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,2,65535,0),this[offset]=value>>>8,this[offset+1]=255&value,offset+2},Buffer.prototype.writeUInt32LE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,4,4294967295,0),this[offset+3]=value>>>24,this[offset+2]=value>>>16,this[offset+1]=value>>>8,this[offset]=255&value,offset+4},Buffer.prototype.writeUInt32BE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,4,4294967295,0),this[offset]=value>>>24,this[offset+1]=value>>>16,this[offset+2]=value>>>8,this[offset+3]=255&value,offset+4},Buffer.prototype.writeIntLE=function(value,offset,byteLength,noAssert){if(value=+value,offset>>>=0,!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=0,mul=1,sub=0;for(this[offset]=255&value;++i<byteLength&&(mul*=256);)0>value&&0===sub&&0!==this[offset+i-1]&&(sub=1),this[offset+i]=(value/mul>>0)-sub&255;return offset+byteLength},Buffer.prototype.writeIntBE=function(value,offset,byteLength,noAssert){if(value=+value,offset>>>=0,!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=byteLength-1,mul=1,sub=0;for(this[offset+i]=255&value;--i>=0&&(mul*=256);)0>value&&0===sub&&0!==this[offset+i+1]&&(sub=1),this[offset+i]=(value/mul>>0)-sub&255;return offset+byteLength},Buffer.prototype.writeInt8=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,1,127,-128),0>value&&(value=255+value+1),this[offset]=255&value,offset+1},Buffer.prototype.writeInt16LE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,2,32767,-32768),this[offset]=255&value,this[offset+1]=value>>>8,offset+2},Buffer.prototype.writeInt16BE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,2,32767,-32768),this[offset]=value>>>8,this[offset+1]=255&value,offset+2},Buffer.prototype.writeInt32LE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,4,2147483647,-2147483648),this[offset]=255&value,this[offset+1]=value>>>8,this[offset+2]=value>>>16,this[offset+3]=value>>>24,offset+4},Buffer.prototype.writeInt32BE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,4,2147483647,-2147483648),0>value&&(value=4294967295+value+1),this[offset]=value>>>24,this[offset+1]=value>>>16,this[offset+2]=value>>>8,this[offset+3]=255&value,offset+4},Buffer.prototype.writeFloatLE=function(value,offset,noAssert){return writeFloat(this,value,offset,!0,noAssert)},Buffer.prototype.writeFloatBE=function(value,offset,noAssert){return writeFloat(this,value,offset,!1,noAssert)},Buffer.prototype.writeDoubleLE=function(value,offset,noAssert){return writeDouble(this,value,offset,!0,noAssert)},Buffer.prototype.writeDoubleBE=function(value,offset,noAssert){return writeDouble(this,value,offset,!1,noAssert)},Buffer.prototype.copy=function(target,targetStart,start,end){if(!Buffer.isBuffer(target))throw new TypeError("argument should be a Buffer");if(start||(start=0),end||0===end||(end=this.length),targetStart>=target.length&&(targetStart=target.length),targetStart||(targetStart=0),end>0&&start>end&&(end=start),end===start)return 0;if(0===target.length||0===this.length)return 0;if(0>targetStart)throw new RangeError("targetStart out of bounds");if(0>start||start>=this.length)throw new RangeError("Index out of range");if(0>end)throw new RangeError("sourceEnd out of bounds");end>this.length&&(end=this.length),target.length-targetStart<end-start&&(end=target.length-targetStart+start);var len=end-start;if(this===target&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(targetStart,start,end);else if(this===target&&targetStart>start&&end>targetStart)for(var i=len-1;i>=0;--i)target[i+targetStart]=this[i+start];else Uint8Array.prototype.set.call(target,this.subarray(start,end),targetStart);return len},Buffer.prototype.fill=function(val,start,end,encoding){if("string"==typeof val){if("string"==typeof start?(encoding=start,start=0,end=this.length):"string"==typeof end&&(encoding=end,end=this.length),void 0!==encoding&&"string"!=typeof encoding)throw new TypeError("encoding must be a string");if("string"==typeof encoding&&!Buffer.isEncoding(encoding))throw new TypeError("Unknown encoding: "+encoding);
if(1===val.length){var code=val.charCodeAt(0);("utf8"===encoding&&128>code||"latin1"===encoding)&&(val=code)}}else"number"==typeof val&&(val=255&val);if(0>start||this.length<start||this.length<end)throw new RangeError("Out of range index");if(start>=end)return this;start>>>=0,end=void 0===end?this.length:end>>>0,val||(val=0);var i;if("number"==typeof val)for(i=start;end>i;++i)this[i]=val;else{var bytes=Buffer.isBuffer(val)?val:Buffer.from(val,encoding),len=bytes.length;if(0===len)throw new TypeError('The value "'+val+'" is invalid for argument "value"');for(i=0;end-start>i;++i)this[i+start]=bytes[i%len]}return this};var INVALID_BASE64_RE=/[^+/0-9A-Za-z-_]/g}).call(this,require("buffer").Buffer)},{"base64-js":5,buffer:6,ieee754:8}],7:[function(require,module,exports){function EventEmitter(){this._events&&Object.prototype.hasOwnProperty.call(this,"_events")||(this._events=objectCreate(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0}function $getMaxListeners(that){return void 0===that._maxListeners?EventEmitter.defaultMaxListeners:that._maxListeners}function emitNone(handler,isFn,self){if(isFn)handler.call(self);else for(var len=handler.length,listeners=arrayClone(handler,len),i=0;len>i;++i)listeners[i].call(self)}function emitOne(handler,isFn,self,arg1){if(isFn)handler.call(self,arg1);else for(var len=handler.length,listeners=arrayClone(handler,len),i=0;len>i;++i)listeners[i].call(self,arg1)}function emitTwo(handler,isFn,self,arg1,arg2){if(isFn)handler.call(self,arg1,arg2);else for(var len=handler.length,listeners=arrayClone(handler,len),i=0;len>i;++i)listeners[i].call(self,arg1,arg2)}function emitThree(handler,isFn,self,arg1,arg2,arg3){if(isFn)handler.call(self,arg1,arg2,arg3);else for(var len=handler.length,listeners=arrayClone(handler,len),i=0;len>i;++i)listeners[i].call(self,arg1,arg2,arg3)}function emitMany(handler,isFn,self,args){if(isFn)handler.apply(self,args);else for(var len=handler.length,listeners=arrayClone(handler,len),i=0;len>i;++i)listeners[i].apply(self,args)}function _addListener(target,type,listener,prepend){var m,events,existing;if("function"!=typeof listener)throw new TypeError('"listener" argument must be a function');if(events=target._events,events?(events.newListener&&(target.emit("newListener",type,listener.listener?listener.listener:listener),events=target._events),existing=events[type]):(events=target._events=objectCreate(null),target._eventsCount=0),existing){if("function"==typeof existing?existing=events[type]=prepend?[listener,existing]:[existing,listener]:prepend?existing.unshift(listener):existing.push(listener),!existing.warned&&(m=$getMaxListeners(target),m&&m>0&&existing.length>m)){existing.warned=!0;var w=new Error("Possible EventEmitter memory leak detected. "+existing.length+' "'+String(type)+'" listeners added. Use emitter.setMaxListeners() to increase limit.');w.name="MaxListenersExceededWarning",w.emitter=target,w.type=type,w.count=existing.length,"object"==typeof console&&console.warn&&console.warn("%s: %s",w.name,w.message)}}else existing=events[type]=listener,++target._eventsCount;return target}function onceWrapper(){if(!this.fired)switch(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var args=new Array(arguments.length),i=0;i<args.length;++i)args[i]=arguments[i];this.listener.apply(this.target,args)}}function _onceWrap(target,type,listener){var state={fired:!1,wrapFn:void 0,target:target,type:type,listener:listener},wrapped=bind.call(onceWrapper,state);return wrapped.listener=listener,state.wrapFn=wrapped,wrapped}function _listeners(target,type,unwrap){var events=target._events;if(!events)return[];var evlistener=events[type];return evlistener?"function"==typeof evlistener?unwrap?[evlistener.listener||evlistener]:[evlistener]:unwrap?unwrapListeners(evlistener):arrayClone(evlistener,evlistener.length):[]}function listenerCount(type){var events=this._events;if(events){var evlistener=events[type];if("function"==typeof evlistener)return 1;if(evlistener)return evlistener.length}return 0}function spliceOne(list,index){for(var i=index,k=i+1,n=list.length;n>k;i+=1,k+=1)list[i]=list[k];list.pop()}function arrayClone(arr,n){for(var copy=new Array(n),i=0;n>i;++i)copy[i]=arr[i];return copy}function unwrapListeners(arr){for(var ret=new Array(arr.length),i=0;i<ret.length;++i)ret[i]=arr[i].listener||arr[i];return ret}function objectCreatePolyfill(proto){var F=function(){};return F.prototype=proto,new F}function objectKeysPolyfill(obj){var keys=[];for(var k in obj)Object.prototype.hasOwnProperty.call(obj,k)&&keys.push(k);return k}function functionBindPolyfill(context){var fn=this;return function(){return fn.apply(context,arguments)}}var objectCreate=Object.create||objectCreatePolyfill,objectKeys=Object.keys||objectKeysPolyfill,bind=Function.prototype.bind||functionBindPolyfill;module.exports=EventEmitter,EventEmitter.EventEmitter=EventEmitter,EventEmitter.prototype._events=void 0,EventEmitter.prototype._maxListeners=void 0;var hasDefineProperty,defaultMaxListeners=10;try{var o={};Object.defineProperty&&Object.defineProperty(o,"x",{value:0}),hasDefineProperty=0===o.x}catch(err){hasDefineProperty=!1}hasDefineProperty?Object.defineProperty(EventEmitter,"defaultMaxListeners",{enumerable:!0,get:function(){return defaultMaxListeners},set:function(arg){if("number"!=typeof arg||0>arg||arg!==arg)throw new TypeError('"defaultMaxListeners" must be a positive number');defaultMaxListeners=arg}}):EventEmitter.defaultMaxListeners=defaultMaxListeners,EventEmitter.prototype.setMaxListeners=function(n){if("number"!=typeof n||0>n||isNaN(n))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=n,this},EventEmitter.prototype.getMaxListeners=function(){return $getMaxListeners(this)},EventEmitter.prototype.emit=function(type){var er,handler,len,args,i,events,doError="error"===type;if(events=this._events)doError=doError&&null==events.error;else if(!doError)return!1;if(doError){if(arguments.length>1&&(er=arguments[1]),er instanceof Error)throw er;var err=new Error('Unhandled "error" event. ('+er+")");throw err.context=er,err}if(handler=events[type],!handler)return!1;var isFn="function"==typeof handler;switch(len=arguments.length){case 1:emitNone(handler,isFn,this);break;case 2:emitOne(handler,isFn,this,arguments[1]);break;case 3:emitTwo(handler,isFn,this,arguments[1],arguments[2]);break;case 4:emitThree(handler,isFn,this,arguments[1],arguments[2],arguments[3]);break;default:for(args=new Array(len-1),i=1;len>i;i++)args[i-1]=arguments[i];emitMany(handler,isFn,this,args)}return!0},EventEmitter.prototype.addListener=function(type,listener){return _addListener(this,type,listener,!1)},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.prependListener=function(type,listener){return _addListener(this,type,listener,!0)},EventEmitter.prototype.once=function(type,listener){if("function"!=typeof listener)throw new TypeError('"listener" argument must be a function');return this.on(type,_onceWrap(this,type,listener)),this},EventEmitter.prototype.prependOnceListener=function(type,listener){if("function"!=typeof listener)throw new TypeError('"listener" argument must be a function');return this.prependListener(type,_onceWrap(this,type,listener)),this},EventEmitter.prototype.removeListener=function(type,listener){var list,events,position,i,originalListener;if("function"!=typeof listener)throw new TypeError('"listener" argument must be a function');if(events=this._events,!events)return this;if(list=events[type],!list)return this;if(list===listener||list.listener===listener)0===--this._eventsCount?this._events=objectCreate(null):(delete events[type],events.removeListener&&this.emit("removeListener",type,list.listener||listener));else if("function"!=typeof list){for(position=-1,i=list.length-1;i>=0;i--)if(list[i]===listener||list[i].listener===listener){originalListener=list[i].listener,position=i;break}if(0>position)return this;0===position?list.shift():spliceOne(list,position),1===list.length&&(events[type]=list[0]),events.removeListener&&this.emit("removeListener",type,originalListener||listener)}return this},EventEmitter.prototype.removeAllListeners=function(type){var listeners,events,i;if(events=this._events,!events)return this;if(!events.removeListener)return 0===arguments.length?(this._events=objectCreate(null),this._eventsCount=0):events[type]&&(0===--this._eventsCount?this._events=objectCreate(null):delete events[type]),this;if(0===arguments.length){var key,keys=objectKeys(events);for(i=0;i<keys.length;++i)key=keys[i],"removeListener"!==key&&this.removeAllListeners(key);return this.removeAllListeners("removeListener"),this._events=objectCreate(null),this._eventsCount=0,this}if(listeners=events[type],"function"==typeof listeners)this.removeListener(type,listeners);else if(listeners)for(i=listeners.length-1;i>=0;i--)this.removeListener(type,listeners[i]);return this},EventEmitter.prototype.listeners=function(type){return _listeners(this,type,!0)},EventEmitter.prototype.rawListeners=function(type){return _listeners(this,type,!1)},EventEmitter.listenerCount=function(emitter,type){return"function"==typeof emitter.listenerCount?emitter.listenerCount(type):listenerCount.call(emitter,type)},EventEmitter.prototype.listenerCount=listenerCount,EventEmitter.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]}},{}],8:[function(require,module,exports){exports.read=function(buffer,offset,isLE,mLen,nBytes){var e,m,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,nBits=-7,i=isLE?nBytes-1:0,d=isLE?-1:1,s=buffer[offset+i];for(i+=d,e=s&(1<<-nBits)-1,s>>=-nBits,nBits+=eLen;nBits>0;e=256*e+buffer[offset+i],i+=d,nBits-=8);for(m=e&(1<<-nBits)-1,e>>=-nBits,nBits+=mLen;nBits>0;m=256*m+buffer[offset+i],i+=d,nBits-=8);if(0===e)e=1-eBias;else{if(e===eMax)return m?NaN:(s?-1:1)*(1/0);m+=Math.pow(2,mLen),e-=eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)},exports.write=function(buffer,value,offset,isLE,mLen,nBytes){var e,m,c,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,rt=23===mLen?Math.pow(2,-24)-Math.pow(2,-77):0,i=isLE?0:nBytes-1,d=isLE?1:-1,s=0>value||0===value&&0>1/value?1:0;for(value=Math.abs(value),isNaN(value)||value===1/0?(m=isNaN(value)?1:0,e=eMax):(e=Math.floor(Math.log(value)/Math.LN2),value*(c=Math.pow(2,-e))<1&&(e--,c*=2),value+=e+eBias>=1?rt/c:rt*Math.pow(2,1-eBias),value*c>=2&&(e++,c/=2),e+eBias>=eMax?(m=0,e=eMax):e+eBias>=1?(m=(value*c-1)*Math.pow(2,mLen),e+=eBias):(m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen),e=0));mLen>=8;buffer[offset+i]=255&m,i+=d,m/=256,mLen-=8);for(e=e<<mLen|m,eLen+=mLen;eLen>0;buffer[offset+i]=255&e,i+=d,e/=256,eLen-=8);buffer[offset+i-d]|=128*s}},{}],9:[function(require,module,exports){function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}function runTimeout(fun){if(cachedSetTimeout===setTimeout)return setTimeout(fun,0);if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout)return cachedSetTimeout=setTimeout,setTimeout(fun,0);try{return cachedSetTimeout(fun,0)}catch(e){try{return cachedSetTimeout.call(null,fun,0)}catch(e){return cachedSetTimeout.call(this,fun,0)}}}function runClearTimeout(marker){if(cachedClearTimeout===clearTimeout)return clearTimeout(marker);if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout)return cachedClearTimeout=clearTimeout,clearTimeout(marker);try{return cachedClearTimeout(marker)}catch(e){try{return cachedClearTimeout.call(null,marker)}catch(e){return cachedClearTimeout.call(this,marker)}}}function cleanUpNextTick(){draining&&currentQueue&&(draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue())}function drainQueue(){if(!draining){var timeout=runTimeout(cleanUpNextTick);draining=!0;for(var len=queue.length;len;){for(currentQueue=queue,queue=[];++queueIndex<len;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,len=queue.length}currentQueue=null,draining=!1,runClearTimeout(timeout)}}function Item(fun,array){this.fun=fun,this.array=array}function noop(){}var cachedSetTimeout,cachedClearTimeout,process=module.exports={};!function(){try{cachedSetTimeout="function"==typeof setTimeout?setTimeout:defaultSetTimout}catch(e){cachedSetTimeout=defaultSetTimout}try{cachedClearTimeout="function"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(e){cachedClearTimeout=defaultClearTimeout}}();var currentQueue,queue=[],draining=!1,queueIndex=-1;process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)args[i-1]=arguments[i];queue.push(new Item(fun,args)),1!==queue.length||draining||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},process.title="browser",process.browser=!0,process.env={},process.argv=[],process.version="",process.versions={},process.on=noop,process.addListener=noop,process.once=noop,process.off=noop,process.removeListener=noop,process.removeAllListeners=noop,process.emit=noop,process.prependListener=noop,process.prependOnceListener=noop,process.listeners=function(name){return[]},process.binding=function(name){throw new Error("process.binding is not supported")},process.cwd=function(){return"/"},process.chdir=function(dir){throw new Error("process.chdir is not supported")},process.umask=function(){return 0}},{}],10:[function(require,module,exports){(function(global){!function(root){function error(type){throw new RangeError(errors[type])}function map(array,fn){for(var length=array.length,result=[];length--;)result[length]=fn(array[length]);return result}function mapDomain(string,fn){var parts=string.split("@"),result="";parts.length>1&&(result=parts[0]+"@",string=parts[1]),string=string.replace(regexSeparators,".");var labels=string.split("."),encoded=map(labels,fn).join(".");return result+encoded}function ucs2decode(string){for(var value,extra,output=[],counter=0,length=string.length;length>counter;)value=string.charCodeAt(counter++),value>=55296&&56319>=value&&length>counter?(extra=string.charCodeAt(counter++),56320==(64512&extra)?output.push(((1023&value)<<10)+(1023&extra)+65536):(output.push(value),counter--)):output.push(value);return output}function ucs2encode(array){return map(array,function(value){var output="";return value>65535&&(value-=65536,output+=stringFromCharCode(value>>>10&1023|55296),value=56320|1023&value),output+=stringFromCharCode(value)}).join("")}function basicToDigit(codePoint){return 10>codePoint-48?codePoint-22:26>codePoint-65?codePoint-65:26>codePoint-97?codePoint-97:base}function digitToBasic(digit,flag){return digit+22+75*(26>digit)-((0!=flag)<<5)}function adapt(delta,numPoints,firstTime){var k=0;for(delta=firstTime?floor(delta/damp):delta>>1,delta+=floor(delta/numPoints);delta>baseMinusTMin*tMax>>1;k+=base)delta=floor(delta/baseMinusTMin);return floor(k+(baseMinusTMin+1)*delta/(delta+skew))}function decode(input){var out,basic,j,index,oldi,w,k,digit,t,baseMinusT,output=[],inputLength=input.length,i=0,n=initialN,bias=initialBias;for(basic=input.lastIndexOf(delimiter),0>basic&&(basic=0),j=0;basic>j;++j)input.charCodeAt(j)>=128&&error("not-basic"),output.push(input.charCodeAt(j));for(index=basic>0?basic+1:0;inputLength>index;){for(oldi=i,w=1,k=base;index>=inputLength&&error("invalid-input"),digit=basicToDigit(input.charCodeAt(index++)),(digit>=base||digit>floor((maxInt-i)/w))&&error("overflow"),i+=digit*w,t=bias>=k?tMin:k>=bias+tMax?tMax:k-bias,!(t>digit);k+=base)baseMinusT=base-t,w>floor(maxInt/baseMinusT)&&error("overflow"),w*=baseMinusT;out=output.length+1,bias=adapt(i-oldi,out,0==oldi),floor(i/out)>maxInt-n&&error("overflow"),n+=floor(i/out),i%=out,output.splice(i++,0,n)}return ucs2encode(output)}function encode(input){var n,delta,handledCPCount,basicLength,bias,j,m,q,k,t,currentValue,inputLength,handledCPCountPlusOne,baseMinusT,qMinusT,output=[];for(input=ucs2decode(input),inputLength=input.length,n=initialN,delta=0,bias=initialBias,j=0;inputLength>j;++j)currentValue=input[j],128>currentValue&&output.push(stringFromCharCode(currentValue));for(handledCPCount=basicLength=output.length,basicLength&&output.push(delimiter);inputLength>handledCPCount;){for(m=maxInt,j=0;inputLength>j;++j)currentValue=input[j],currentValue>=n&&m>currentValue&&(m=currentValue);for(handledCPCountPlusOne=handledCPCount+1,m-n>floor((maxInt-delta)/handledCPCountPlusOne)&&error("overflow"),delta+=(m-n)*handledCPCountPlusOne,n=m,j=0;inputLength>j;++j)if(currentValue=input[j],n>currentValue&&++delta>maxInt&&error("overflow"),currentValue==n){for(q=delta,k=base;t=bias>=k?tMin:k>=bias+tMax?tMax:k-bias,!(t>q);k+=base)qMinusT=q-t,baseMinusT=base-t,output.push(stringFromCharCode(digitToBasic(t+qMinusT%baseMinusT,0))),q=floor(qMinusT/baseMinusT);output.push(stringFromCharCode(digitToBasic(q,0))),bias=adapt(delta,handledCPCountPlusOne,handledCPCount==basicLength),delta=0,++handledCPCount}++delta,++n}return output.join("")}function toUnicode(input){return mapDomain(input,function(string){return regexPunycode.test(string)?decode(string.slice(4).toLowerCase()):string})}function toASCII(input){return mapDomain(input,function(string){return regexNonASCII.test(string)?"xn--"+encode(string):string})}var freeExports="object"==typeof exports&&exports&&!exports.nodeType&&exports,freeModule="object"==typeof module&&module&&!module.nodeType&&module,freeGlobal="object"==typeof global&&global;(freeGlobal.global===freeGlobal||freeGlobal.window===freeGlobal||freeGlobal.self===freeGlobal)&&(root=freeGlobal);var punycode,key,maxInt=2147483647,base=36,tMin=1,tMax=26,skew=38,damp=700,initialBias=72,initialN=128,delimiter="-",regexPunycode=/^xn--/,regexNonASCII=/[^\x20-\x7E]/,regexSeparators=/[\x2E\u3002\uFF0E\uFF61]/g,errors={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},baseMinusTMin=base-tMin,floor=Math.floor,stringFromCharCode=String.fromCharCode;if(punycode={version:"1.4.1",ucs2:{decode:ucs2decode,encode:ucs2encode},decode:decode,encode:encode,toASCII:toASCII,toUnicode:toUnicode},"function"==typeof define&&"object"==typeof define.amd&&define.amd)define("punycode",function(){return punycode});else if(freeExports&&freeModule)if(module.exports==freeExports)freeModule.exports=punycode;else for(key in punycode)punycode.hasOwnProperty(key)&&(freeExports[key]=punycode[key]);else root.punycode=punycode}(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],11:[function(require,module,exports){function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}module.exports=function(qs,sep,eq,options){sep=sep||"&",eq=eq||"=";var obj={};if("string"!=typeof qs||0===qs.length)return obj;var regexp=/\+/g;qs=qs.split(sep);var maxKeys=1e3;options&&"number"==typeof options.maxKeys&&(maxKeys=options.maxKeys);var len=qs.length;maxKeys>0&&len>maxKeys&&(len=maxKeys);for(var i=0;len>i;++i){var kstr,vstr,k,v,x=qs[i].replace(regexp,"%20"),idx=x.indexOf(eq);idx>=0?(kstr=x.substr(0,idx),vstr=x.substr(idx+1)):(kstr=x,vstr=""),k=decodeURIComponent(kstr),v=decodeURIComponent(vstr),hasOwnProperty(obj,k)?isArray(obj[k])?obj[k].push(v):obj[k]=[obj[k],v]:obj[k]=v}return obj};var isArray=Array.isArray||function(xs){return"[object Array]"===Object.prototype.toString.call(xs)}},{}],12:[function(require,module,exports){function map(xs,f){if(xs.map)return xs.map(f);for(var res=[],i=0;i<xs.length;i++)res.push(f(xs[i],i));return res}var stringifyPrimitive=function(v){switch(typeof v){case"string":return v;case"boolean":return v?"true":"false";case"number":return isFinite(v)?v:"";default:return""}};module.exports=function(obj,sep,eq,name){return sep=sep||"&",eq=eq||"=",null===obj&&(obj=void 0),"object"==typeof obj?map(objectKeys(obj),function(k){var ks=encodeURIComponent(stringifyPrimitive(k))+eq;return isArray(obj[k])?map(obj[k],function(v){return ks+encodeURIComponent(stringifyPrimitive(v))}).join(sep):ks+encodeURIComponent(stringifyPrimitive(obj[k]))}).join(sep):name?encodeURIComponent(stringifyPrimitive(name))+eq+encodeURIComponent(stringifyPrimitive(obj)):""};var isArray=Array.isArray||function(xs){return"[object Array]"===Object.prototype.toString.call(xs)},objectKeys=Object.keys||function(obj){var res=[];for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&res.push(key);return res}},{}],13:[function(require,module,exports){exports.decode=exports.parse=require("./decode"),exports.encode=exports.stringify=require("./encode")},{"./decode":11,"./encode":12}],14:[function(require,module,exports){function Url(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}function urlParse(url,parseQueryString,slashesDenoteHost){if(url&&util.isObject(url)&&url instanceof Url)return url;var u=new Url;return u.parse(url,parseQueryString,slashesDenoteHost),u}function urlFormat(obj){return util.isString(obj)&&(obj=urlParse(obj)),obj instanceof Url?obj.format():Url.prototype.format.call(obj)}function urlResolve(source,relative){return urlParse(source,!1,!0).resolve(relative)}function urlResolveObject(source,relative){return source?urlParse(source,!1,!0).resolveObject(relative):relative}var punycode=require("punycode"),util=require("./util");exports.parse=urlParse,exports.resolve=urlResolve,exports.resolveObject=urlResolveObject,exports.format=urlFormat,exports.Url=Url;var protocolPattern=/^([a-z0-9.+-]+:)/i,portPattern=/:[0-9]*$/,simplePathPattern=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,delims=["<",">",'"',"`"," ","\r","\n","	"],unwise=["{","}","|","\\","^","`"].concat(delims),autoEscape=["'"].concat(unwise),nonHostChars=["%","/","?",";","#"].concat(autoEscape),hostEndingChars=["/","?","#"],hostnameMaxLen=255,hostnamePartPattern=/^[+a-z0-9A-Z_-]{0,63}$/,hostnamePartStart=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,unsafeProtocol={javascript:!0,"javascript:":!0},hostlessProtocol={javascript:!0,"javascript:":!0},slashedProtocol={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},querystring=require("querystring");Url.prototype.parse=function(url,parseQueryString,slashesDenoteHost){if(!util.isString(url))throw new TypeError("Parameter 'url' must be a string, not "+typeof url);var queryIndex=url.indexOf("?"),splitter=-1!==queryIndex&&queryIndex<url.indexOf("#")?"?":"#",uSplit=url.split(splitter),slashRegex=/\\/g;uSplit[0]=uSplit[0].replace(slashRegex,"/"),url=uSplit.join(splitter);var rest=url;if(rest=rest.trim(),!slashesDenoteHost&&1===url.split("#").length){var simplePath=simplePathPattern.exec(rest);if(simplePath)return this.path=rest,this.href=rest,this.pathname=simplePath[1],simplePath[2]?(this.search=simplePath[2],parseQueryString?this.query=querystring.parse(this.search.substr(1)):this.query=this.search.substr(1)):parseQueryString&&(this.search="",this.query={}),this}var proto=protocolPattern.exec(rest);if(proto){proto=proto[0];var lowerProto=proto.toLowerCase();this.protocol=lowerProto,rest=rest.substr(proto.length)}if(slashesDenoteHost||proto||rest.match(/^\/\/[^@\/]+@[^@\/]+/)){var slashes="//"===rest.substr(0,2);!slashes||proto&&hostlessProtocol[proto]||(rest=rest.substr(2),this.slashes=!0)}if(!hostlessProtocol[proto]&&(slashes||proto&&!slashedProtocol[proto])){for(var hostEnd=-1,i=0;i<hostEndingChars.length;i++){var hec=rest.indexOf(hostEndingChars[i]);-1!==hec&&(-1===hostEnd||hostEnd>hec)&&(hostEnd=hec)}var auth,atSign;atSign=-1===hostEnd?rest.lastIndexOf("@"):rest.lastIndexOf("@",hostEnd),-1!==atSign&&(auth=rest.slice(0,atSign),rest=rest.slice(atSign+1),this.auth=decodeURIComponent(auth)),hostEnd=-1;for(var i=0;i<nonHostChars.length;i++){var hec=rest.indexOf(nonHostChars[i]);-1!==hec&&(-1===hostEnd||hostEnd>hec)&&(hostEnd=hec)}-1===hostEnd&&(hostEnd=rest.length),this.host=rest.slice(0,hostEnd),rest=rest.slice(hostEnd),this.parseHost(),this.hostname=this.hostname||"";var ipv6Hostname="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!ipv6Hostname)for(var hostparts=this.hostname.split(/\./),i=0,l=hostparts.length;l>i;i++){var part=hostparts[i];if(part&&!part.match(hostnamePartPattern)){for(var newpart="",j=0,k=part.length;k>j;j++)newpart+=part.charCodeAt(j)>127?"x":part[j];if(!newpart.match(hostnamePartPattern)){var validParts=hostparts.slice(0,i),notHost=hostparts.slice(i+1),bit=part.match(hostnamePartStart);bit&&(validParts.push(bit[1]),notHost.unshift(bit[2])),notHost.length&&(rest="/"+notHost.join(".")+rest),this.hostname=validParts.join(".");break}}}this.hostname.length>hostnameMaxLen?this.hostname="":this.hostname=this.hostname.toLowerCase(),ipv6Hostname||(this.hostname=punycode.toASCII(this.hostname));var p=this.port?":"+this.port:"",h=this.hostname||"";this.host=h+p,this.href+=this.host,ipv6Hostname&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==rest[0]&&(rest="/"+rest))}if(!unsafeProtocol[lowerProto])for(var i=0,l=autoEscape.length;l>i;i++){var ae=autoEscape[i];if(-1!==rest.indexOf(ae)){var esc=encodeURIComponent(ae);esc===ae&&(esc=escape(ae)),rest=rest.split(ae).join(esc)}}var hash=rest.indexOf("#");-1!==hash&&(this.hash=rest.substr(hash),rest=rest.slice(0,hash));var qm=rest.indexOf("?");if(-1!==qm?(this.search=rest.substr(qm),this.query=rest.substr(qm+1),parseQueryString&&(this.query=querystring.parse(this.query)),rest=rest.slice(0,qm)):parseQueryString&&(this.search="",this.query={}),rest&&(this.pathname=rest),slashedProtocol[lowerProto]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var p=this.pathname||"",s=this.search||"";this.path=p+s}return this.href=this.format(),this},Url.prototype.format=function(){var auth=this.auth||"";auth&&(auth=encodeURIComponent(auth),auth=auth.replace(/%3A/i,":"),auth+="@");var protocol=this.protocol||"",pathname=this.pathname||"",hash=this.hash||"",host=!1,query="";this.host?host=auth+this.host:this.hostname&&(host=auth+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(host+=":"+this.port)),this.query&&util.isObject(this.query)&&Object.keys(this.query).length&&(query=querystring.stringify(this.query));var search=this.search||query&&"?"+query||"";return protocol&&":"!==protocol.substr(-1)&&(protocol+=":"),this.slashes||(!protocol||slashedProtocol[protocol])&&host!==!1?(host="//"+(host||""),pathname&&"/"!==pathname.charAt(0)&&(pathname="/"+pathname)):host||(host=""),hash&&"#"!==hash.charAt(0)&&(hash="#"+hash),search&&"?"!==search.charAt(0)&&(search="?"+search),pathname=pathname.replace(/[?#]/g,function(match){return encodeURIComponent(match)}),search=search.replace("#","%23"),protocol+host+pathname+search+hash},Url.prototype.resolve=function(relative){return this.resolveObject(urlParse(relative,!1,!0)).format()},Url.prototype.resolveObject=function(relative){if(util.isString(relative)){var rel=new Url;rel.parse(relative,!1,!0),relative=rel}for(var result=new Url,tkeys=Object.keys(this),tk=0;tk<tkeys.length;tk++){var tkey=tkeys[tk];result[tkey]=this[tkey]}if(result.hash=relative.hash,""===relative.href)return result.href=result.format(),result;if(relative.slashes&&!relative.protocol){for(var rkeys=Object.keys(relative),rk=0;rk<rkeys.length;rk++){var rkey=rkeys[rk];"protocol"!==rkey&&(result[rkey]=relative[rkey])}return slashedProtocol[result.protocol]&&result.hostname&&!result.pathname&&(result.path=result.pathname="/"),result.href=result.format(),result}if(relative.protocol&&relative.protocol!==result.protocol){if(!slashedProtocol[relative.protocol]){for(var keys=Object.keys(relative),v=0;v<keys.length;v++){var k=keys[v];result[k]=relative[k]}return result.href=result.format(),result}if(result.protocol=relative.protocol,relative.host||hostlessProtocol[relative.protocol])result.pathname=relative.pathname;else{for(var relPath=(relative.pathname||"").split("/");relPath.length&&!(relative.host=relPath.shift()););relative.host||(relative.host=""),relative.hostname||(relative.hostname=""),""!==relPath[0]&&relPath.unshift(""),relPath.length<2&&relPath.unshift(""),result.pathname=relPath.join("/")}if(result.search=relative.search,result.query=relative.query,result.host=relative.host||"",result.auth=relative.auth,result.hostname=relative.hostname||relative.host,result.port=relative.port,result.pathname||result.search){var p=result.pathname||"",s=result.search||"";result.path=p+s}return result.slashes=result.slashes||relative.slashes,result.href=result.format(),result}var isSourceAbs=result.pathname&&"/"===result.pathname.charAt(0),isRelAbs=relative.host||relative.pathname&&"/"===relative.pathname.charAt(0),mustEndAbs=isRelAbs||isSourceAbs||result.host&&relative.pathname,removeAllDots=mustEndAbs,srcPath=result.pathname&&result.pathname.split("/")||[],relPath=relative.pathname&&relative.pathname.split("/")||[],psychotic=result.protocol&&!slashedProtocol[result.protocol];if(psychotic&&(result.hostname="",result.port=null,result.host&&(""===srcPath[0]?srcPath[0]=result.host:srcPath.unshift(result.host)),result.host="",relative.protocol&&(relative.hostname=null,relative.port=null,relative.host&&(""===relPath[0]?relPath[0]=relative.host:relPath.unshift(relative.host)),relative.host=null),mustEndAbs=mustEndAbs&&(""===relPath[0]||""===srcPath[0])),isRelAbs)result.host=relative.host||""===relative.host?relative.host:result.host,result.hostname=relative.hostname||""===relative.hostname?relative.hostname:result.hostname,result.search=relative.search,result.query=relative.query,srcPath=relPath;else if(relPath.length)srcPath||(srcPath=[]),srcPath.pop(),srcPath=srcPath.concat(relPath),result.search=relative.search,result.query=relative.query;else if(!util.isNullOrUndefined(relative.search)){if(psychotic){result.hostname=result.host=srcPath.shift();var authInHost=result.host&&result.host.indexOf("@")>0?result.host.split("@"):!1;authInHost&&(result.auth=authInHost.shift(),result.host=result.hostname=authInHost.shift())}return result.search=relative.search,result.query=relative.query,util.isNull(result.pathname)&&util.isNull(result.search)||(result.path=(result.pathname?result.pathname:"")+(result.search?result.search:"")),result.href=result.format(),result}if(!srcPath.length)return result.pathname=null,result.search?result.path="/"+result.search:result.path=null,result.href=result.format(),result;for(var last=srcPath.slice(-1)[0],hasTrailingSlash=(result.host||relative.host||srcPath.length>1)&&("."===last||".."===last)||""===last,up=0,i=srcPath.length;i>=0;i--)last=srcPath[i],"."===last?srcPath.splice(i,1):".."===last?(srcPath.splice(i,1),up++):up&&(srcPath.splice(i,1),up--);if(!mustEndAbs&&!removeAllDots)for(;up--;up)srcPath.unshift("..");!mustEndAbs||""===srcPath[0]||srcPath[0]&&"/"===srcPath[0].charAt(0)||srcPath.unshift(""),hasTrailingSlash&&"/"!==srcPath.join("/").substr(-1)&&srcPath.push("");var isAbsolute=""===srcPath[0]||srcPath[0]&&"/"===srcPath[0].charAt(0);if(psychotic){result.hostname=result.host=isAbsolute?"":srcPath.length?srcPath.shift():"";var authInHost=result.host&&result.host.indexOf("@")>0?result.host.split("@"):!1;authInHost&&(result.auth=authInHost.shift(),result.host=result.hostname=authInHost.shift())}return mustEndAbs=mustEndAbs||result.host&&srcPath.length,mustEndAbs&&!isAbsolute&&srcPath.unshift(""),srcPath.length?result.pathname=srcPath.join("/"):(result.pathname=null,result.path=null),util.isNull(result.pathname)&&util.isNull(result.search)||(result.path=(result.pathname?result.pathname:"")+(result.search?result.search:"")),result.auth=relative.auth||result.auth,
result.slashes=result.slashes||relative.slashes,result.href=result.format(),result},Url.prototype.parseHost=function(){var host=this.host,port=portPattern.exec(host);port&&(port=port[0],":"!==port&&(this.port=port.substr(1)),host=host.substr(0,host.length-port.length)),host&&(this.hostname=host)}},{"./util":15,punycode:10,querystring:13}],15:[function(require,module,exports){module.exports={isString:function(arg){return"string"==typeof arg},isObject:function(arg){return"object"==typeof arg&&null!==arg},isNull:function(arg){return null===arg},isNullOrUndefined:function(arg){return null==arg}}},{}],16:[function(require,module,exports){"function"==typeof Object.create?module.exports=function(ctor,superCtor){ctor.super_=superCtor,ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:!1,writable:!0,configurable:!0}})}:module.exports=function(ctor,superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype,ctor.prototype=new TempCtor,ctor.prototype.constructor=ctor}},{}],17:[function(require,module,exports){module.exports=function(arg){return arg&&"object"==typeof arg&&"function"==typeof arg.copy&&"function"==typeof arg.fill&&"function"==typeof arg.readUInt8}},{}],18:[function(require,module,exports){(function(process,global){function inspect(obj,opts){var ctx={seen:[],stylize:stylizeNoColor};return arguments.length>=3&&(ctx.depth=arguments[2]),arguments.length>=4&&(ctx.colors=arguments[3]),isBoolean(opts)?ctx.showHidden=opts:opts&&exports._extend(ctx,opts),isUndefined(ctx.showHidden)&&(ctx.showHidden=!1),isUndefined(ctx.depth)&&(ctx.depth=2),isUndefined(ctx.colors)&&(ctx.colors=!1),isUndefined(ctx.customInspect)&&(ctx.customInspect=!0),ctx.colors&&(ctx.stylize=stylizeWithColor),formatValue(ctx,obj,ctx.depth)}function stylizeWithColor(str,styleType){var style=inspect.styles[styleType];return style?"["+inspect.colors[style][0]+"m"+str+"["+inspect.colors[style][1]+"m":str}function stylizeNoColor(str,styleType){return str}function arrayToHash(array){var hash={};return array.forEach(function(val,idx){hash[val]=!0}),hash}function formatValue(ctx,value,recurseTimes){if(ctx.customInspect&&value&&isFunction(value.inspect)&&value.inspect!==exports.inspect&&(!value.constructor||value.constructor.prototype!==value)){var ret=value.inspect(recurseTimes,ctx);return isString(ret)||(ret=formatValue(ctx,ret,recurseTimes)),ret}var primitive=formatPrimitive(ctx,value);if(primitive)return primitive;var keys=Object.keys(value),visibleKeys=arrayToHash(keys);if(ctx.showHidden&&(keys=Object.getOwnPropertyNames(value)),isError(value)&&(keys.indexOf("message")>=0||keys.indexOf("description")>=0))return formatError(value);if(0===keys.length){if(isFunction(value)){var name=value.name?": "+value.name:"";return ctx.stylize("[Function"+name+"]","special")}if(isRegExp(value))return ctx.stylize(RegExp.prototype.toString.call(value),"regexp");if(isDate(value))return ctx.stylize(Date.prototype.toString.call(value),"date");if(isError(value))return formatError(value)}var base="",array=!1,braces=["{","}"];if(isArray(value)&&(array=!0,braces=["[","]"]),isFunction(value)){var n=value.name?": "+value.name:"";base=" [Function"+n+"]"}if(isRegExp(value)&&(base=" "+RegExp.prototype.toString.call(value)),isDate(value)&&(base=" "+Date.prototype.toUTCString.call(value)),isError(value)&&(base=" "+formatError(value)),0===keys.length&&(!array||0==value.length))return braces[0]+base+braces[1];if(0>recurseTimes)return isRegExp(value)?ctx.stylize(RegExp.prototype.toString.call(value),"regexp"):ctx.stylize("[Object]","special");ctx.seen.push(value);var output;return output=array?formatArray(ctx,value,recurseTimes,visibleKeys,keys):keys.map(function(key){return formatProperty(ctx,value,recurseTimes,visibleKeys,key,array)}),ctx.seen.pop(),reduceToSingleString(output,base,braces)}function formatPrimitive(ctx,value){if(isUndefined(value))return ctx.stylize("undefined","undefined");if(isString(value)){var simple="'"+JSON.stringify(value).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return ctx.stylize(simple,"string")}return isNumber(value)?ctx.stylize(""+value,"number"):isBoolean(value)?ctx.stylize(""+value,"boolean"):isNull(value)?ctx.stylize("null","null"):void 0}function formatError(value){return"["+Error.prototype.toString.call(value)+"]"}function formatArray(ctx,value,recurseTimes,visibleKeys,keys){for(var output=[],i=0,l=value.length;l>i;++i)hasOwnProperty(value,String(i))?output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,String(i),!0)):output.push("");return keys.forEach(function(key){key.match(/^\d+$/)||output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,key,!0))}),output}function formatProperty(ctx,value,recurseTimes,visibleKeys,key,array){var name,str,desc;if(desc=Object.getOwnPropertyDescriptor(value,key)||{value:value[key]},desc.get?str=desc.set?ctx.stylize("[Getter/Setter]","special"):ctx.stylize("[Getter]","special"):desc.set&&(str=ctx.stylize("[Setter]","special")),hasOwnProperty(visibleKeys,key)||(name="["+key+"]"),str||(ctx.seen.indexOf(desc.value)<0?(str=isNull(recurseTimes)?formatValue(ctx,desc.value,null):formatValue(ctx,desc.value,recurseTimes-1),str.indexOf("\n")>-1&&(str=array?str.split("\n").map(function(line){return"  "+line}).join("\n").substr(2):"\n"+str.split("\n").map(function(line){return"   "+line}).join("\n"))):str=ctx.stylize("[Circular]","special")),isUndefined(name)){if(array&&key.match(/^\d+$/))return str;name=JSON.stringify(""+key),name.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(name=name.substr(1,name.length-2),name=ctx.stylize(name,"name")):(name=name.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),name=ctx.stylize(name,"string"))}return name+": "+str}function reduceToSingleString(output,base,braces){var numLinesEst=0,length=output.reduce(function(prev,cur){return numLinesEst++,cur.indexOf("\n")>=0&&numLinesEst++,prev+cur.replace(/\u001b\[\d\d?m/g,"").length+1},0);return length>60?braces[0]+(""===base?"":base+"\n ")+" "+output.join(",\n  ")+" "+braces[1]:braces[0]+base+" "+output.join(", ")+" "+braces[1]}function isArray(ar){return Array.isArray(ar)}function isBoolean(arg){return"boolean"==typeof arg}function isNull(arg){return null===arg}function isNullOrUndefined(arg){return null==arg}function isNumber(arg){return"number"==typeof arg}function isString(arg){return"string"==typeof arg}function isSymbol(arg){return"symbol"==typeof arg}function isUndefined(arg){return void 0===arg}function isRegExp(re){return isObject(re)&&"[object RegExp]"===objectToString(re)}function isObject(arg){return"object"==typeof arg&&null!==arg}function isDate(d){return isObject(d)&&"[object Date]"===objectToString(d)}function isError(e){return isObject(e)&&("[object Error]"===objectToString(e)||e instanceof Error)}function isFunction(arg){return"function"==typeof arg}function isPrimitive(arg){return null===arg||"boolean"==typeof arg||"number"==typeof arg||"string"==typeof arg||"symbol"==typeof arg||"undefined"==typeof arg}function objectToString(o){return Object.prototype.toString.call(o)}function pad(n){return 10>n?"0"+n.toString(10):n.toString(10)}function timestamp(){var d=new Date,time=[pad(d.getHours()),pad(d.getMinutes()),pad(d.getSeconds())].join(":");return[d.getDate(),months[d.getMonth()],time].join(" ")}function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}var formatRegExp=/%[sdj%]/g;exports.format=function(f){if(!isString(f)){for(var objects=[],i=0;i<arguments.length;i++)objects.push(inspect(arguments[i]));return objects.join(" ")}for(var i=1,args=arguments,len=args.length,str=String(f).replace(formatRegExp,function(x){if("%%"===x)return"%";if(i>=len)return x;switch(x){case"%s":return String(args[i++]);case"%d":return Number(args[i++]);case"%j":try{return JSON.stringify(args[i++])}catch(_){return"[Circular]"}default:return x}}),x=args[i];len>i;x=args[++i])str+=isNull(x)||!isObject(x)?" "+x:" "+inspect(x);return str},exports.deprecate=function(fn,msg){function deprecated(){if(!warned){if(process.throwDeprecation)throw new Error(msg);process.traceDeprecation?console.trace(msg):console.error(msg),warned=!0}return fn.apply(this,arguments)}if(isUndefined(global.process))return function(){return exports.deprecate(fn,msg).apply(this,arguments)};if(process.noDeprecation===!0)return fn;var warned=!1;return deprecated};var debugEnviron,debugs={};exports.debuglog=function(set){if(isUndefined(debugEnviron)&&(debugEnviron=process.env.NODE_DEBUG||""),set=set.toUpperCase(),!debugs[set])if(new RegExp("\\b"+set+"\\b","i").test(debugEnviron)){var pid=process.pid;debugs[set]=function(){var msg=exports.format.apply(exports,arguments);console.error("%s %d: %s",set,pid,msg)}}else debugs[set]=function(){};return debugs[set]},exports.inspect=inspect,inspect.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},inspect.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"},exports.isArray=isArray,exports.isBoolean=isBoolean,exports.isNull=isNull,exports.isNullOrUndefined=isNullOrUndefined,exports.isNumber=isNumber,exports.isString=isString,exports.isSymbol=isSymbol,exports.isUndefined=isUndefined,exports.isRegExp=isRegExp,exports.isObject=isObject,exports.isDate=isDate,exports.isError=isError,exports.isFunction=isFunction,exports.isPrimitive=isPrimitive,exports.isBuffer=require("./support/isBuffer");var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];exports.log=function(){console.log("%s - %s",timestamp(),exports.format.apply(exports,arguments))},exports.inherits=require("inherits"),exports._extend=function(origin,add){if(!add||!isObject(add))return origin;for(var keys=Object.keys(add),i=keys.length;i--;)origin[keys[i]]=add[keys[i]];return origin}}).call(this,require("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":17,_process:9,inherits:16}]},{},[2]),function(){angular.module("appetizeApp").service("navigation",["$rootScope","$location",function($rootScope,$location){this.handleRouteChange=function(){$rootScope.$on("$routeChangeSuccess",function(event,current,previous){current.$$route&&($rootScope.isOnprem?($rootScope.pageTitle="",$rootScope.pageDescription="",$rootScope.pageCanonical=""):($rootScope.pageTitle=current.$$route.pageTitle,$rootScope.pageDescription=current.$$route.pageDescription,$rootScope.pageCanonical=current.$$route.pageCanonical),$rootScope.path=$location.path(),$rootScope.app=null),$("#navbar-collapse-1").collapse("hide"),toastr.remove()})}}])}();